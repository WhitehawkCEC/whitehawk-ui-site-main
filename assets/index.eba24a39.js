import{r as H,u as G,a as K,b as N,c as Y,d as j,e as z,s as W,_ as pe,f as fe,g as me,h as ie,R as ce,i as le,j as ue,Q as he,k as ye,v as xe}from"./QuestionnaireSidebar.15583d59.js";import{h as _e}from"./_baseIteratee.405b9e7b.js";import{aY as M,b$ as de,c as i,cE as L,r as P,az as X,n as Z,a$ as Se,ac as ge,aU as we,c5 as ee,cz as Ce,cA as Ie,cF as te,bK as qe,aj as se}from"./index.868c2263.js";import{B as Ae}from"./BitsightProgressBar.302e97e1.js";import"./keys.4ef884a1.js";import"./_Uint8Array.1c57db2a.js";import"./_isIterateeCall.a828cb59.js";import"./_baseAssignValue.62e9ca70.js";import"./_baseUniq.e6e6c173.js";import"./_baseIsEqual.5e7bcbba.js";import"./_baseEach.29bfc75d.js";import"./cloneDeep.c9c7dac0.js";import"./_copyArray.56331c81.js";import"./_arrayMap.dcea68f3.js";import"./isEqual.980c433c.js";import"./values.a54cac90.js";const ke=M({props:{...H()},setup(e){const o=G(K(e)),t=de.list(),r=i(()=>{var s,v,w;return(w=(v=(s=t.data.value)==null?void 0:s[0])==null?void 0:v.id)==null?void 0:w.value}),d=N(),x=i(()=>d.data),q=i(()=>_e(x.value,e.path)),y=i(()=>q.value.questionType),_=i(()=>{const n="questions.";return parseInt(e.path.substring(e.path.indexOf(n)+n.length))}),f=i(()=>q.value),S=i(()=>y.value==="TEXTAREA"),R=i(()=>y.value==="CHECKBOX"),m=d.takenId,B=L.list(m,!!m),$=i(()=>B),g=i(()=>{var n;return(n=$.value.data.value)==null?void 0:n.questionAnswers}),c=i(()=>{if(g.value){const n=g.value.filter(s=>{var v,w,b;return((v=s.questionId)==null?void 0:v.value)===((b=(w=f.value)==null?void 0:w.id)==null?void 0:b.value)});return n.length===1&&!R.value?n[0]:n}}),C=i(()=>{var n,s,v,w;if(Array.isArray(c.value)){const b=new Set;for(const Q of c.value)(n=Q.answerId)!=null&&n.value&&b.add((s=Q.answerId)==null?void 0:s.value);return[...b]}return(w=(v=c.value)==null?void 0:v.answerId)==null?void 0:w.value}),k=i({get(){return C.value},set(n){var v,w,b,Q,V;if(!n){if(!Array.isArray(c.value)){const T=(w=(v=c.value)==null?void 0:v.questionAnswerId)==null?void 0:w.value;T&&I(T)}return}if(Array.isArray(n)&&Array.isArray(c.value)&&!n[0]){for(const T of c.value)(b=T.questionAnswerId)!=null&&b.value&&I((Q=T.questionAnswerId)==null?void 0:Q.value);return}const s=c.value;if(typeof n!="string")for(const T of n){if(c.value&&Array.isArray(c.value))for(const D of c.value)D.answerId&&D.questionAnswerId&&(n.includes(D.answerId.value)||I(D.questionAnswerId.value));if(Array.isArray(n)){if(!Array.isArray(s))s!=null&&s.answerId&&(s.answerId.value=T,u(s));else if(Array.isArray(C.value)&&!C.value.includes(T)){const D=E(T);D&&a(D)}}return}if(!Array.isArray(s))((V=s==null?void 0:s.answerId)==null?void 0:V.value)&&typeof n=="string"&&(s.answerId.value=n,u(s));else if(typeof n=="string"){const T=E(n);T&&a(T)}}}),O=i(()=>{var n;if(!Array.isArray(c==null?void 0:c.value)){const s=(n=c==null?void 0:c.value)==null?void 0:n.answerText;if(s)return s}return""}),p=P(O.value),A=L.create(m);async function a(n){const s={questionAnswer:{...n}};await A.mutateAsync(s)}const l=L.update(m);async function u(n){const s={questionAnswer:{...n}};await l.mutateAsync(s)}const h=L.delete(m);async function I(n){await h.mutateAsync(n)}function F(n){var s,v,w;return(w=(v=(s=f.value)==null?void 0:s.answerSet)==null?void 0:v.answers)==null?void 0:w.filter(b=>{var Q;return((Q=b.id)==null?void 0:Q.value)===n})[0]}const E=function(n){var Q;if(!r.value||!m)return;let s;n!=null&&(s=F(n));const v=((Q=s==null?void 0:s.id)==null?void 0:Q.value)||f.value.id.value,w=(s==null?void 0:s.riskScore)||0;return{responseId:{value:m},questionnaireId:{value:r.value},questionId:{value:f.value.id.value},answerId:{value:v},riskScore:w,answerText:p.value}};return X(()=>p.value,n=>{const s=c.value;if(s)if(!Array.isArray(s))s.answerText=n,u(s);else if(s[0])for(const v of s)v.answerText=n,u(v);else{const v=E(void 0);v&&a(v)}else{const v=E(void 0);v&&a(v)}},{deep:!0}),{...o,selected:k,textAnswer:p,currentQuestion:f,currentAnswer:c,isTextarea:S,isMultiselect:R,currentQuestionIndex:_,questionType:y,questionnaireData:x,resolvedData:q,currentAnswerIds:C}},methods:{composePaths:Y,createDefaultValue:j,addButtonClick(){this.addItem(this.control.path,j(this.control.schema))()}}}),Te={renderer:ke,tester:z(1e3,W("answers"))},be=M({components:{ControlWrapper:pe},props:{...H()},setup(e){return fe(me(e))}}),Qe={renderer:be,tester:z(1e3,W("text"))},Re=M({props:{label:{required:!0,type:String,default:""},text:{required:!0,type:String,default:""},questionType:{required:!0,type:String,default:""}}});var Be=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"overflow-hidden rounded-lg bg-white p-5 md:shadow-lg"},[t("BaseOverline",{staticClass:"uppercase text-gray-500"},[e._v(" Select All That Apply ")]),e._t("default")],2)},$e=[];const ne={};var De=Z(Re,Be,$e,!1,Ee,null,null,null);function Ee(e){for(let o in ne)this[o]=ne[o]}const Pe=function(){return De.exports}(),je=M({components:{QuestionListElement:Pe,DispatchRenderer:ie},props:{...H()},setup(e){const o=G(K(e)),t=Se(o.control),r=N(),d=i(()=>r.data),x=i({get(){return r.questionIndex},set(g){r.setQuestionIndex(g)}}),q=i(()=>x.value>0),y=i(()=>x.value<t.data.length-1),_=i({get(){return r.sectionIndex},set(g){r.setSectionIndex(g)}}),f=i(()=>{var g,c;return((c=(g=d.value)==null?void 0:g.sections)==null?void 0:c.length)||0}),S=i(()=>_.value>0),R=i(()=>_.value<f.value-1),m=i(()=>{var g,c,C;return S.value?((C=(c=(g=d.value)==null?void 0:g.sections)==null?void 0:c[_.value-1])==null?void 0:C.questions.length)||0:null});function B(){m.value&&(x.value=m.value-1,_.value--)}const $=i(()=>!0);return{...o,data:d,questionIndex:x,hasPrevQuestion:q,hasNextQuestion:y,prevQuestionCount:m,sectionIndex:_,sectionCount:f,hasPrevSection:S,hasNextSection:R,toEndOfPrevSection:B,isSingle:$}},computed:{arraySchema(){return ce.schema(this.control.rootSchema,this.control.uischema.scope,this.control.rootSchema)},detailUiSchema(){const e=le(this.control.uischemas,this.control.schema,this.control.uischema.scope,this.control.path,"Group",this.control.uischema,this.control.rootSchema);return ue(this.control.path)?e.type="VerticalLayout":e.label=this.control.label,e}},methods:{composePaths:Y,createDefaultValue:j,addButtonClick(){this.addItem(this.control.path,j(this.control.schema))()}}}),Me={renderer:je,tester:z(1e3,W("questions"))},U={};U.setup=(e,o)=>{const t=N(),r=i(()=>t.data),d=i(()=>t==null?void 0:t.riskScoreTotal),x=i(()=>t==null?void 0:t.riskScoreMax),q=i(()=>Math.round(d.value*100/x.value)),y=i(()=>{var a;return(a=r.value)==null?void 0:a.sections}),_=P(null),f=P(!1),S=P(-1),R=i(()=>t.sectionTotals),m=function(a){var u,h,I;const l=(I=(h=(u=y.value)==null?void 0:u[a])==null?void 0:h.id)==null?void 0:I.value;return l&&R.value.get(l)||0},B=function(a){var h,I;let l=0;const u=(I=(h=y==null?void 0:y.value)==null?void 0:h[a])==null?void 0:I.questions;if(u)for(const F of u)F.answerSet&&F.answerSet.answers.filter(n=>{l=l+n.riskScore});return l},$=function(a){const l=m(a),u=B(a);return l?Math.round(l*100/u):0},g=function(a){S.value===a?f.value=!f.value:f.value=!0,S.value=a},c=function(a){var l,u;return(u=(l=y.value)==null?void 0:l[a])==null?void 0:u.questions},C=i(()=>t==null?void 0:t.answers),k=function(a){if(a!=null&&a.value){let l=0;return C.value.filter(u=>{var h;((h=u.questionId)==null?void 0:h.value)===(a==null?void 0:a.value)&&(l=l+u.riskScore)}),l}},O=function(a){if(a!=null&&a.value){let l;return C.value.filter(u=>{var h;((h=u.questionId)==null?void 0:h.value)===(a==null?void 0:a.value)&&(l=u.answerText)}),l}},p=P(!1);return{riskScoreTotal:d,riskScoreMax:x,percentage:q,sections:y,sectionsCol:_,sectionsCollapsed:f,selectedSection:S,sectionRiskScoreTotal:m,sectionRiskScoreMax:B,sectionPercentage:$,selectSection:g,getSectionQuestions:c,getQuestionScore:k,getQuestionText:O,atBottom:p,handleScroll:function(a){const l=a.target,h=a.srcElement.offsetHeight,I=l.scrollTop;if(l.scrollHeight-I===h){p.value=!0;return}p.value=!1}}};U.components=Object.assign({BitsightProgressBar:Ae,ChevronRightSvg:ge},U.components);var Oe=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("section",{staticClass:"space-y-5 py-5"},[t("div",{staticClass:"relative flex flex-col items-center justify-center xl:grid xl:grid-cols-12"},[t("div",{staticClass:"-mb-36 xl:col-span-4 xl:col-start-1 xl:row-start-1 xl:mb-0"},[t("div",{staticClass:"px-6 md:px-8 lg:px-4 xl:pl-0"},[t("div",{staticClass:"relative flex w-full max-w-xs flex-col items-center justify-center overflow-hidden rounded-xl bg-white px-4 py-8 shadow-md sm:max-w-sm sm:rounded-3xl xl:max-w-none xl:p-12"},[t("div",{staticClass:"absolute flex flex-col items-center space-y-2"},[t("span",{staticClass:"whitespace-nowrap"},[t("BaseTypography",{attrs:{variant:"h2"}},[e._v(" "+e._s(e.percentage)+" "),t("sup",{staticClass:"text-gray-500"},[e._v("%")])])],1)]),t("div",{staticClass:"relative w-44 sm:w-56"},[t("BitsightProgressBar",{attrs:{"cyber-score":e.riskScoreTotal,max:e.riskScoreMax}})],1)])])]),t("BaseSimpleCard",{staticClass:"pt-32 xl:col-span-10 xl:col-start-3 xl:row-start-1 xl:h-fit xl:p-0"},[t("div",{staticClass:"grid items-center gap-6 px-6 py-10 sm:p-8 lg:grid-cols-10 xl:gap-0 xl:p-6"},[t("div",{staticClass:"grid gap-5 text-center lg:col-span-10 xl:col-span-6 xl:col-start-3 xl:text-left"},[t("BaseTypography",{staticClass:"text-prime-navy",attrs:{component:"h2",variant:"h5"}},[e._v(" Total Score / Overview ")]),t("BaseTypography",{staticClass:"text-gray-600",attrs:{component:"p",variant:"p1"}},[e._v(" Lorem ipsum dolor sit amet consectetur, adipisicing elit. Veritatis saepe ullam laborum accusantium itaque, enim commodi numquam incidunt, id autem pariatur sit ut qui libero eos amet molestias inventore ab! ")])],1)])])],1),t("div",{staticClass:"relative grid grid-cols-12 gap-4"},[t("div",{ref:"sectionsCol",staticClass:"h-120 space-y-4 overflow-y-scroll",class:[{"fade-bottom":!e.atBottom},e.sectionsCollapsed?"col-span-4":"col-span-12"],on:{scroll:function(r){return e.handleScroll(r)}}},e._l(e.sections,function(r,d){return t("div",{key:d,staticClass:"pointer-events-auto flex cursor-pointer justify-between rounded-xl bg-white px-4 py-8 shadow",on:{click:function(x){return e.selectSection(d)}}},[t("span",[t("BaseP1",{staticClass:"text-prime-indigo"},[e._v(" "+e._s(r.name)+" ")]),t("BaseP2",{staticClass:"text-gray-500"},[e._v(" "+e._s(r.questions.length)+" questions ")])],1),e._v(" "+e._s("Total score:"+e.sectionRiskScoreTotal(d))+" "+e._s("Max score:"+e.sectionRiskScoreMax(d))+" "+e._s("Section percentage: "+e.sectionPercentage(d))+" "),t("div",{staticClass:"flex justify-self-end"},[t("ChevronRightSvg",{staticClass:"m-auto h-5 w-5 text-gray-400",attrs:{"aria-hidden":"true"}})],1)])}),0),e.sectionsCollapsed?t("div",{staticClass:"col-span-8"},[t("BaseSimpleCard",{staticClass:"px-4 py-8"},[t("BaseH4",[e._v("Section Details")]),e.selectedSection!=null?t("span",[t("div",{staticClass:"relative flex w-full max-w-xs flex-col items-center justify-center overflow-hidden"},[t("div",{staticClass:"relative w-36"},[t("BitsightProgressBar",{attrs:{"cyber-score":e.sectionRiskScoreTotal(e.selectedSection),max:e.sectionRiskScoreMax(e.selectedSection)}})],1),t("div",{staticClass:"absolute flex flex-col items-center space-y-2"},[t("span",{staticClass:"whitespace-nowrap"},[t("BaseTypography",{attrs:{variant:"h4",component:"p"}},[e._v(" "+e._s(e.sectionPercentage(e.selectedSection))+" "),t("sup",{staticClass:"text-gray-500"},[e._v("%")])])],1)])]),t("ul",{staticClass:"divide-y divide-gray-200",attrs:{role:"list"}},e._l(e.getSectionQuestions(e.selectedSection),function(r,d){return t("li",{key:d,staticClass:"py-4"},[e.getQuestionScore(r.id)!==void 0?t("div",{staticClass:"mx-0 flex w-full flex-row"},[t("BaseLink",{attrs:{"display-type":"primary-prime",to:"#"}},[e._v(" "+e._s(`Question ${d+1}`)+" ")]),t("BaseTypography",{staticClass:"mt-1 ml-4 block text-gray-500",attrs:{component:"p",variant:"overline"}},[e._v(" "+e._s(r.questionType)+" ")]),t("div",{staticClass:"ml-auto"},[r.questionType!="TEXTAREA"?t("p",[e._v(" "+e._s("Score: "+e.getQuestionScore(r.id))+" ")]):e._e(),e.getQuestionText(r.id)?t("p",[e._v(" "+e._s("Text Response: "+e.getQuestionText(r.id))+" ")]):e._e()])],1):e._e()])}),0),t("BaseTypography",{staticClass:"float-right mb-4",attrs:{component:"p",variant:"p1"}},[e._v(" "+e._s("Total score:"+e.sectionRiskScoreTotal(e.selectedSection))+" ")])],1):e._e()],1)],1):e._e()]),t("div",{staticClass:"flex p-8"},[t("BaseH5",[e._v("Additional CTA / Bundles?")])],1)])},Fe=[];const ae={};var Le=Z(U,Oe,Fe,!1,Ue,"4eec88d0",null,null);function Ue(e){for(let o in ae)this[o]=ae[o]}const oe=function(){return Le.exports}(),Je=M({components:{QuestionnaireSidebar:he,DispatchRenderer:ie,QuestionnaireReview:oe},props:{...H()},setup(e){const o=G(K(e)),t=N(),r=i(()=>t.sectionIndex),d=i(()=>t.atResults);return{...o,sectionIndex:r,isAtResults:d,QuestionnaireReview:oe}},computed:{noData(){return!this.control.data||this.control.data.length===0},arraySchema(){return ce.schema(this.control.rootSchema,this.control.uischema.scope,this.control.rootSchema)},detailUiSchema(){const e=le(this.control.uischemas,this.control.schema,this.control.uischema.scope,this.control.path,"Group",this.control.uischema,this.control.rootSchema);return ue(this.control.path)?e.type="VerticalLayout":e.label=this.control.label,e},allSections(){const e=[];for(const o of this.control.data)e.push(o.name);return e}},methods:{composePaths:Y,createDefaultValue:j,addButtonClick(){this.addItem(this.control.path,j(this.control.schema))()}}}),He={renderer:Je,tester:z(1e3,W("sections"))},Ne=we("custom-questionnaire",{state:()=>({sectionIndex:0,questionIndex:0,schema:void 0,data:void 0,takenId:void 0,answers:[],atResults:!1}),getters:{currentSection({data:e,sectionIndex:o}){var t;return(t=e==null?void 0:e.sections)==null?void 0:t[o]},currentQuestion({data:e}){var o,t,r;return(r=(t=(o=e==null?void 0:e.sections)==null?void 0:o[this.sectionIndex])==null?void 0:t.questions)==null?void 0:r[this.questionIndex]},riskScoreTotal({answers:e}){let o=0;return e.filter(t=>{if(Array.isArray(t)){for(const r of t)r.riskScore&&(o=o+r.riskScore);return}o=o+t.riskScore}),o},riskScoreMax({data:e}){let o=0;return e==null||e.sections.filter(t=>{for(const r of t.questions)r.answerSet&&r.answerSet.answers.filter(x=>{o=o+x.riskScore})}),o},sectionRiskScoreTotals({data:e,answers:o}){const t={};return e==null||e.sections.filter((r,d)=>{var q;const x=[];for(const y of r.questions)(q=y.answerSet)!=null&&q.answers&&o.filter(_=>{var f,S;((f=_.questionId)==null?void 0:f.value)===((S=y.id)==null?void 0:S.value)&&x.push(_.riskScore)});if(r.id){const y=x.reduce(function(_,f){return _+f},0);t[r.id.value]=y}}),t}},actions:{setSectionIndex(e){this.sectionIndex=e},setQuestionIndex(e){this.questionIndex=e},setSchema(e){this.schema=e},setData(e){this.data=e},setTakenId(e){this.takenId=e},setAnswers(e){this.answers=e},setAtResults(e){this.atResults=e},clearAnswers(){this.answers=[],this.sectionIndex=0,this.questionIndex=0,this.takenId=void 0,this.atResults=!1},clearSchema(){this.schema=void 0},clearData(){this.data=void 0}}}),J=M({layout:"siteMain"});J.setup=(e,o)=>{const t=[...xe,Te,Me,Qe,He],r=ee("id"),d=ee("questionnaireId"),x=i(()=>[q,S,_,c,g]),q=Ce.get(),y=i(()=>{var A;const p=((A=q.data.value)==null?void 0:A.displayUischema)||"";return JSON.parse(p)}),_=Ie.get(),f=i(()=>{var A;const p=((A=_.data.value)==null?void 0:A.displaySchema)||void 0;if(p)return JSON.parse(p)}),S=te.list(r.value),R=P(""),m=i(()=>{var p,A,a,l;return((l=(a=(A=(p=S==null?void 0:S.data)==null?void 0:p.value)==null?void 0:A.taken.filter(u=>{var h;return((h=u.questionnaireId)==null?void 0:h.value)===d.value})[0])==null?void 0:a.id)==null?void 0:l.value)||R.value}),B=te.create();async function $(p){var l,u,h,I;const A={...p},{response:a}=await B.mutateAsync(A);a&&(u=(l=a.taken)==null?void 0:l.id)!=null&&u.value&&(R.value=(I=(h=a.taken)==null?void 0:h.id)==null?void 0:I.value)}const g=L.list(m.value,!!m.value),c=de.read(d),C=i(()=>c.data.value),k=Ne();function O(){f.value&&k.setSchema(f.value),C.value&&k.setData(C.value),m.value===""&&!S.isLoading.value&&$({userId:r.value,questionnaireId:{value:d.value}}),m.value&&k.setTakenId(m.value)}return O(),X(()=>C.value,p=>{!p||k.setData(p)}),X(()=>m.value,p=>{!p||k.setTakenId(p)}),qe(()=>{k.clearSchema(),k.clearData(),k.clearAnswers()}),{renderers:t,queries:x,uiSchemaData:y,schemaData:f,questionnaireData:C}};J.components=Object.assign({JsonForms:ye},J.components);var ze=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"min-h-screen bg-gray-100"},[t("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(){return[t("JsonForms",{attrs:{data:e.questionnaireData,renderers:e.renderers,schema:e.schemaData,uischema:e.uiSchemaData}})]},proxy:!0}])})],1)},We=[];const re={};var ve=Z(J,ze,We,!1,Xe,null,null,null);function Xe(e){for(let o in re)this[o]=re[o]}typeof se=="function"&&se(ve);const dt=function(){return ve.exports}();export{dt as default};
