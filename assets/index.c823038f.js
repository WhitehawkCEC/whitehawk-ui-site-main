import{L as F}from"./LicenseTypeMapQuantitiesInput.1f70e597.js";import{cc as L,cb as f,cd as O,ce as A,cf as N,cg as x,aT as H,aE as G,ch as R,bQ as Y,d as v,r as w,cI as z,aB as V,n as M,bZ as y,c6 as Z}from"./index.e7109a92.js";import{m as Q}from"./message_pb.215d3034.js";import{u as U}from"./useAccountSubscriptionProductLicenseBatches.d07b77e5.js";import{u as J,L as K}from"./LicenseBatchUsageDisplay.a48cd9f8.js";import{S as X}from"./SubscriptionProductIdHeader.70e952a6.js";import"./index.95b4fe73.js";import"./DynamicForm.488b4f2e.js";import"./calendar.aad8910e.js";import"./identification.8410fcc9.js";import"./AggregateLicenseDisplay.ad6cb4b6.js";import"./DateRangeDisplay.d9317b9f.js";import"./IsoDateTimeDisplay.a991298b.js";import"./BackButton.cde3c423.js";import"./chevron-left.0808b01b.js";import"./ToolTip.20a9df69.js";import"./exclamation-triangle.54812a62.js";import"./index.646d4180.js";import"./index.483774f4.js";var C={},P={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Service=e.CreateResponse=e.CreateRequest=void 0;const a=L,n=f,i=f,u=f,_=f,m=f,o=Q,d=O,l=A;class I extends m.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateRequest",[{no:1,name:"account_id",kind:"message",T:()=>l.Slug},{no:2,name:"subscription_id",kind:"message",T:()=>l.Slug},{no:3,name:"product_id",kind:"message",T:()=>d.Ulid},{no:4,name:"batch_id",kind:"message",T:()=>d.Ulid},{no:5,name:"quantities_diff",kind:"message",T:()=>o.LicenseTypeMapQuantities}])}create(t){const s={};return globalThis.Object.defineProperty(s,_.MESSAGE_TYPE,{enumerable:!1,value:this}),t!==void 0&&(0,u.reflectionMergePartial)(this,s,t),s}internalBinaryRead(t,s,r,c){let p=c!=null?c:this.create(),j=t.pos+s;for(;t.pos<j;){let[T,q]=t.tag();switch(T){case 1:p.accountId=l.Slug.internalBinaryRead(t,t.uint32(),r,p.accountId);break;case 2:p.subscriptionId=l.Slug.internalBinaryRead(t,t.uint32(),r,p.subscriptionId);break;case 3:p.productId=d.Ulid.internalBinaryRead(t,t.uint32(),r,p.productId);break;case 4:p.batchId=d.Ulid.internalBinaryRead(t,t.uint32(),r,p.batchId);break;case 5:p.quantitiesDiff=o.LicenseTypeMapQuantities.internalBinaryRead(t,t.uint32(),r,p.quantitiesDiff);break;default:let b=r.readUnknownField;if(b==="throw")throw new globalThis.Error(`Unknown field ${T} (wire type ${q}) for ${this.typeName}`);let E=t.skip(q);b!==!1&&(b===!0?i.UnknownFieldHandler.onRead:b)(this.typeName,p,T,q,E)}}return p}internalBinaryWrite(t,s,r){t.accountId&&l.Slug.internalBinaryWrite(t.accountId,s.tag(1,n.WireType.LengthDelimited).fork(),r).join(),t.subscriptionId&&l.Slug.internalBinaryWrite(t.subscriptionId,s.tag(2,n.WireType.LengthDelimited).fork(),r).join(),t.productId&&d.Ulid.internalBinaryWrite(t.productId,s.tag(3,n.WireType.LengthDelimited).fork(),r).join(),t.batchId&&d.Ulid.internalBinaryWrite(t.batchId,s.tag(4,n.WireType.LengthDelimited).fork(),r).join(),t.quantitiesDiff&&o.LicenseTypeMapQuantities.internalBinaryWrite(t.quantitiesDiff,s.tag(5,n.WireType.LengthDelimited).fork(),r).join();let c=r.writeUnknownFields;return c!==!1&&(c==!0?i.UnknownFieldHandler.onWrite:c)(this.typeName,t,s),s}}e.CreateRequest=new I;class S extends m.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateResponse",[])}create(t){const s={};return globalThis.Object.defineProperty(s,_.MESSAGE_TYPE,{enumerable:!1,value:this}),t!==void 0&&(0,u.reflectionMergePartial)(this,s,t),s}internalBinaryRead(t,s,r,c){return c!=null?c:this.create()}internalBinaryWrite(t,s,r){let c=r.writeUnknownFields;return c!==!1&&(c==!0?i.UnknownFieldHandler.onWrite:c)(this.typeName,t,s),s}}e.CreateResponse=new S,e.Service=new a.ServiceType("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.Service",[{name:"Create",options:{},I:e.CreateRequest,O:e.CreateResponse}])})(P);Object.defineProperty(C,"__esModule",{value:!0});var W=C.ServiceClient=void 0;const B=P,ee=L;class te{constructor(a){this._transport=a,this.typeName=B.Service.typeName,this.methods=B.Service.methods,this.options=B.Service.options}create(a,n){const i=this.methods[0],u=this._transport.mergeOptions(n);return(0,ee.stackIntercept)("unary",this._transport,i,u,a)}}W=C.ServiceClient=te;const ne=new W(N),ie={create(e,a,n,i){const u=x(),_=H();async function m(o){return await ne.create({accountId:{value:e.value},subscriptionId:{value:a.value},productId:{value:n.value},batchId:{value:i.value},...o},u.value)}return G(m,{onSuccess(){const o=[[R,"accounts",e,"subscriptions",a,"products",n,"license-batches"],[R,"accounts",e,"subscriptions",a,"products",n,"license-batches",i]];for(const d of o)_.invalidateQueries(d,{exact:!0})}})}},h={};h.props={accountId:{key:"accountId",required:!0,type:String},subscriptionId:{key:"subscriptionId",required:!0,type:String},productId:{key:"productId",required:!0,type:String},batchId:{key:"batchId",required:!0,type:String}};h.setup=(e,a)=>{const i=Y(e),u=ie.create(i.accountId,i.subscriptionId,i.productId,i.batchId),_=U.read(i.accountId,i.subscriptionId,i.productId,i.batchId),m=v(()=>{var t,s;return(s=(t=_.data.value)==null?void 0:t.value)==null?void 0:s.counts}),o=w(z.LicenseTypeMapQuantities.create()),d=w(!1);V(()=>m.value,t=>{var s,r;!t||d.value||(o.value={annual:((s=t.annual)==null?void 0:s.quantity)||0,oneTime:((r=t.oneTime)==null?void 0:r.quantity)||0},d.value=!0)},{immediate:!0});const l=J(m,o),I=v(()=>({quantitiesDiff:l.value})),S=v(()=>l.value.annual!==0||l.value.oneTime!==0);async function k(){await u.mutateAsync(I.value)}return{currentState:_,quantitiesDesired:o,canSubmit:S,submit:k}};h.components=Object.assign({LicenseTypeMapQuantitiesInput:F},h.components);var se=function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("BaseSimpleCard",{staticClass:"divide-y"},[n("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[e._v(" Edit Quantities ")]),n("form",{staticClass:"divide-y",on:{submit:function(i){return i.preventDefault(),e.submit.apply(null,arguments)}}},[n("BaseVueQuery",{attrs:{query:e.currentState},scopedSlots:e._u([{key:"success",fn:function(){return[n("LicenseTypeMapQuantitiesInput",{model:{value:e.quantitiesDesired,callback:function(i){e.quantitiesDesired=i},expression:"quantitiesDesired"}})]},proxy:!0}])}),n("div",{staticClass:"p-4"},[n("BaseButton",{staticClass:"w-full md:w-auto",attrs:{action:"primary",shape:"rectangle","display-type":"success",disabled:!e.canSubmit}},[e._v(" Change ")])],1)],1)],1)},ae=[];const $={};var re=M(h,se,ae,!1,ce,null,null,null);function ce(e){for(let a in $)this[a]=$[a]}const ue=function(){return re.exports}(),g={};g.setup=(e,a)=>{const n=y("id"),i=y("subscriptionId"),u=y("productId"),_=y("batchId"),m=Z.read(n,i,u),o=U.read(n,i,u,_),d=v(()=>{var l;return((l=o.data.value)==null?void 0:l.value)||Q.LicenseBatchUsage.create()});return{id:n,subscriptionId:i,productId:u,batchId:_,productRead:m,licenseBatch:o,usage:d}};g.components=Object.assign({SubscriptionProductIdHeader:X,LicenseBatchUsageDisplay:K,AccountSubscriptionBatchQuantitiesChange:ue},g.components);var oe=function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("section",{staticClass:"space-y-6"},[n("BaseVueQuery",{attrs:{query:e.productRead},scopedSlots:e._u([{key:"success",fn:function(i){var u=i.data;return[n("SubscriptionProductIdHeader",{attrs:{id:e.id,"subscription-id":e.subscriptionId,value:u}})]}}])}),n("BaseVueQuery",{attrs:{query:e.licenseBatch},scopedSlots:e._u([{key:"success",fn:function(){return[n("LicenseBatchUsageDisplay",{attrs:{value:e.usage}})]},proxy:!0}])}),n("AccountSubscriptionBatchQuantitiesChange",{attrs:{"account-id":e.id,"subscription-id":e.subscriptionId,"product-id":e.productId,"batch-id":e.batchId}})],1)},de=[];const D={};var le=M(g,oe,de,!1,pe,null,null,null);function pe(e){for(let a in D)this[a]=D[a]}const Le=function(){return le.exports}();export{Le as default};
