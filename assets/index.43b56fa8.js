import{P as S}from"./ProgressBar.06fc3fb6.js";import{c as I}from"./cloneDeep.f23e6ed8.js";import{i as Q}from"./isEqual.993af004.js";import{ai as R,aR as B,aS as $,aF as j,r as h,d,aC as x,n as k,c2 as A,aI as P,aK as D}from"./index.e75910c9.js";import{u as O}from"./useNewestQuestionnaireResponses.f27bf2cc.js";import"./_Uint8Array.834a53ff.js";import"./keys.99aaa819.js";import"./_baseAssignValue.8bbcaa02.js";import"./_copyArray.56331c81.js";import"./_baseIsEqual.501e78e0.js";const z={read(e){return R(["questionnaires",e],()=>B.get(`${$}/questionnaires/${e}`).then(n=>n.data))}},E={create(){async function e(n){return await B.post(`${$}/questionnaire-responses`,n).then(t=>t.data)}return j(e)}},f={};f.props={value:{key:"value",required:!1,type:Array},questionnaire:{key:"questionnaire",required:!0,type:null},latest:{key:"latest",required:!1,type:Array}};f.setup=(e,n)=>{const t=e,a=n.emit,l=h(),i=d(()=>{if(t.latest){if(t.latest.length===0)return{};const s={};for(const m of t.latest){const{questionId:p,value:u}=m;s[p]=u}return s}}),o=d(()=>{const s={};for(const m of t.questionnaire.questions){const{id:p,answerSchema:u}=m;if(u.type==="array")s[p]=u.default||[];else{const q=u.default||u.minimum;q&&(s[p]=q)}}return s}),r=d(()=>{if(i.value)return i.value;if(!t.value)return{};const s={};for(const m of t.value){const{questionId:p,value:u}=m;s[p]=u}return s}),_=d(()=>({...o.value,...r.value}));x(()=>_.value,s=>{s&&(l.value=I(s))},{immediate:!0}),x(()=>l.value,s=>{if(!Q(s,r.value)&&s){const m=Object.entries(s).map(([p,u])=>({questionId:p,value:u}));a("input",m)}},{deep:!0,immediate:!0});const c=h(0);function y(){c.value>0&&c.value--}function g(){c.value<t.questionnaire.questions.length-1&&c.value++}function b(s){return s.replace(/_/g," ")}return{changes:l,currentIndex:c,previous:y,next:g,subject:b}};f.components=Object.assign({ProgressBar:S},f.components);var F=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.changes?t("div",{staticClass:"overflow-hidden rounded-lg bg-white shadow"},[t("div",{staticClass:"flex h-132 flex-col"},[t("ProgressBar",{staticClass:"h-2 bg-gray-200",attrs:{current:e.currentIndex,max:e.questionnaire.questions.length}}),t("div",{staticClass:"px-4 py-5 sm:py-8 sm:px-6"},e._l(e.questionnaire.questions,function(a,l){var i=a.id,o=a.answerSchema;return t("span",{key:i},[l===e.currentIndex?t("span",[t("BaseOverline",{staticClass:"mb-3 block uppercase text-gray-500"},[e._v(" Question "+e._s(l+1)+" of "+e._s(e.questionnaire.questions.length)+" ")]),t("BaseH5",{staticClass:"mb-4 capitalize"},[e._v(" "+e._s(e.subject(i))+" ")]),t("BaseP1",{staticClass:"text-gray-500"},[e._v(" "+e._s(o.title)+" ")]),t("hr",{staticClass:"my-6 border-gray-300"}),o.type==="integer"?[t("BaseInput",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{type:"number",required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,e._n(r))},expression:"changes[id]"}})]:o.type==="string"?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:o.type==="array"&&o.items&&"enum"in o.items?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{multiple:"",size:o.items.enum?o.items.enum.length:0,required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.items.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:e._e()],2):e._e()])}),0),t("div",{staticClass:"mt-auto border-t border-gray-200 px-4 py-4 sm:px-6"},[e.currentIndex!=0?t("BaseButton",{attrs:{action:"secondary","display-type":"info"},on:{click:function(a){return a.preventDefault(),e.previous.apply(null,arguments)}}},[e._v(" Previous ")]):e._e(),e.currentIndex<e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"},on:{click:function(a){return a.preventDefault(),e.next.apply(null,arguments)}}},[e._v(" Next ")]):e._e(),e.currentIndex===e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"}},[e._v(" View Results ")]):e._e()],1)],1)]):e._e()},M=[];const w={};var N=k(f,F,M,!1,U,null,null,null);function U(e){for(let n in w)this[n]=w[n]}const H=function(){return N.exports}(),v={};v.setup=(e,n)=>{const t=A("id"),a=h(),l=O.get(t),i=d(()=>{var s;return(s=l.data.value)==null?void 0:s.answers}),o=z.read("main"),r=d(()=>o.data.value),_=P(),c=d(()=>_.company),y=D(),g=E.create();return{response:a,newest:i,main:r,submit:async()=>{if(c.value&&a.value){const s={questionnaireId:"main",company:{id:c.value.id,name:c.value.name},answers:a.value};await g.mutateAsync(s),y.push(`/client/companies/${encodeURIComponent(t.value)}/journey/cyber-risk-profile`)}}}};v.components=Object.assign({QuestionnaireSingleQuestion:H},v.components);var K=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("form",{staticClass:"pt-2",on:{submit:function(a){return a.preventDefault(),e.submit.apply(null,arguments)}}},[e.main?t("QuestionnaireSingleQuestion",{attrs:{questionnaire:e.main,latest:e.newest},model:{value:e.response,callback:function(a){e.response=a},expression:"response"}}):e._e()],1)])},G=[];const C={};var J=k(v,K,G,!1,L,null,null,null);function L(e){for(let n in C)this[n]=C[n]}const ae=function(){return J.exports}();export{ae as default};
