import{F as M}from"./FormButton.4c430bd9.js";import{aB as Q,n as C,ax as D,c as u,bt as U,c8 as L,r as q,bH as w,aK as N,aP as z,aQ as G}from"./index.e32706b8.js";import{B as H}from"./BatchCompanySelect.4587dca9.js";import{A as K}from"./AnalystSelect.a44f2faf.js";import{S as W}from"./StatusInput.f929d57b.js";import{e as l}from"./attributeValue.ea53a720.js";import{s as Y}from"./index.709acf2f.js";import{u as J}from"./useBitsightCompanies.f1c54ff0.js";import{u as X}from"./useBatchScorecards.2b02c364.js";import{u as Z}from"./useUsers.31bbb9ad.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";import"./ToolTip.87b48f96.js";import"./ObjectDisplay.b5975e3f.js";import"./DynamicForm.37b72884.js";const x={};x.props={value:{key:"value",required:!1,type:Array},options:{key:"options",required:!0,type:Array}};x.setup=(t,s)=>{const e=t,a=s.emit;return{proxy:Q(e,a)}};var tt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center lg:gap-1"},[e("span",{staticClass:"after:content-['*'] after:ml-0.5 after:text-red-700"},[t._v(" Companies ")]),e("BaseSelect",{staticClass:"lg:col-span-2",attrs:{multiple:"",required:""},model:{value:t.proxy,callback:function(a){t.proxy=a},expression:"proxy"}},t._l(t.options,function(a){return e("option",{key:a.id,domProps:{value:a}},[t._v(" "+t._s(a.name)+" ("+t._s(a.domain)+") ")])}),0)],1)},et=[];const A={};var at=C(x,tt,et,!1,st,null,null,null);function st(t){for(let s in A)this[s]=A[s]}const nt=function(){return at.exports}(),d={};d.props={value:{key:"value",required:!1,type:null},id:{key:"id",required:!0,type:String},users:{key:"users",required:!0,type:Array},companies:{key:"companies",required:!0,type:Array},bitsightCompanies:{key:"bitsightCompanies",required:!0,type:Array}};d.setup=(t,s)=>{const e=t,a=s.emit,c=D(e,a),m=u(()=>e.companies.filter(n=>n.status==="ACTIVE")),y=u(()=>e.users.filter(n=>l(n,"email").includes("@whitehawk")).map(n=>({id:l(n,"sub"),name:l(n,"name"),title:l(n,"custom:title"),phone:l(n,"phone_number"),email:l(n,"email")})).sort((n,r)=>n.email.localeCompare(r.email))),v=u(()=>e.bitsightCompanies.map(n=>({id:n.data.guid,name:n.data.name,domain:n.data.primary_domain}))),h=Y(u(()=>({year:c.value.status.year,quarter:c.value.status.quarter,state:c.value.status.state})));return{proxy:c,consumerOptions:m,analystOptions:y,bitsightCompanyOptions:v,status:h}};d.components=Object.assign({BatchCompanySelect:H,AnalystSelect:K,StatusInput:W,BatchBitsightCompaniesSelect:nt},d.components);var rt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"flex flex-col divide-y"},[e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Buyer Information ")]),e("BatchCompanySelect",{attrs:{options:t.consumerOptions},model:{value:t.proxy.buyerCompany,callback:function(a){t.$set(t.proxy,"buyerCompany",a)},expression:"proxy.buyerCompany"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Analyst Information ")]),e("AnalystSelect",{attrs:{options:t.analystOptions},model:{value:t.proxy.analystInfo,callback:function(a){t.$set(t.proxy,"analystInfo",a)},expression:"proxy.analystInfo"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Status ")]),e("StatusInput",{model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Select Companies ")]),e("BatchBitsightCompaniesSelect",{attrs:{options:t.bitsightCompanyOptions},model:{value:t.proxy.supplierInfos,callback:function(a){t.$set(t.proxy,"supplierInfos",a)},expression:"proxy.supplierInfos"}})],1)])},ot=[];const O={};var it=C(d,rt,ot,!1,lt,null,null,null);function lt(t){for(let s in O)this[s]=O[s]}const ct=function(){return it.exports}(),_={};_.setup=(t,s)=>{const e=L("id"),a=q(!1),c=[w.list(),J.list(e)],m=w.read(e),y=u(()=>m.data.value),v=Z.list(),h=u(()=>{var i;return(i=v.data.value)==null?void 0:i.map(o=>({id:l(o,"sub"),email:l(o,"email"),name:l(o,"name"),phone:l(o,"phone_number"),title:l(o,"custom:title")})).find(o=>o.email==="consultingservices@whitehawk.com")}),n=q(),r=u({get(){if(n.value)return n.value;const i=new Date,o=i.getUTCFullYear(),p=Math.ceil((i.getMonth()+1)/4);return{buyerCompany:y.value,analystInfo:h.value,yearQuarterValue:`${o}/${p}`,status:{year:o,quarter:"Q"+p,state:"IN_PROGRESS"},supplierInfos:[]}},set(i){n.value=i}}),R=u(()=>!!(r.value&&r.value.buyerCompany&&r.value.analystInfo&&r.value.status&&r.value.yearQuarterValue&&r.value.supplierInfos.length>0)),T=X.create(e);async function P(){var p,f,b,g,B,$,S,I,k;a.value=!0;const i={id:e.value,buyerCompany:(p=r.value)==null?void 0:p.buyerCompany,analystInfo:(f=r.value)==null?void 0:f.analystInfo,status:{year:(b=r.value)==null?void 0:b.status.year,quarter:(g=r.value)==null?void 0:g.status.quarter,state:(B=r.value)==null?void 0:B.status.state},includeCmmc:($=r.value)!=null&&$.includeCmmc?(S=r.value)==null?void 0:S.includeCmmc:!0,template:(I=r.value)==null?void 0:I.template,supplierInfos:(k=r.value)==null?void 0:k.supplierInfos},o=await T.mutateAsync(i);o&&V(o.id)}const j=N();async function V(i){await E(i),a.value=!1,j.push(`/admin/companies/${e.value}/scorecards/batch/rating-service-1/${i}`)}async function E(i){let o=!0;do(await z.get(`${G}/companies/${e.value}/scorecards/docx/${i}/status`)).data.length===0?o=!1:await new Promise(f=>setTimeout(f,2e3));while(o)}return{id:e,queries:c,users:v,batch:r,isValidForm:R,create:P}};_.components=Object.assign({BackButton:U,BatchScorecardInput:ct,FormButton:M},_.components);var ut=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[e("div",[e("BackButton",{attrs:{link:`/admin/companies/${t.id}/scorecards/batch/rating-service-1/`}})],1),e("BaseTypography",{attrs:{variant:"h5",component:"h2"}},[t._v(" Create New Batch ")])],1),e("BaseSimpleCard",[e("form",{staticClass:"divide-y",on:{submit:function(a){return a.preventDefault(),t.create.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:t.queries},scopedSlots:t._u([{key:"success",fn:function(a){var c=a[0],m=a[1];return[e("BatchScorecardInput",{attrs:{id:t.id,users:t.users.data.value||[],companies:c,"bitsight-companies":m},model:{value:t.batch,callback:function(y){t.batch=y},expression:"batch"}})]}}])}),e("FormButton",{attrs:{action:"create","is-valid-form":t.isValidForm}})],1)])],1)},pt=[];const F={};var mt=C(_,ut,pt,!1,yt,null,null,null);function yt(t){for(let s in F)this[s]=F[s]}const wt=function(){return mt.exports}();export{wt as default};
