import{P as S}from"./ProgressBar.f6522439.js";import{c as $}from"./cloneDeep.d7b84f00.js";import{_ as k}from"./_baseIsEqual.1080e018.js";import{ah as j,aP as B,aQ as I,aT as R,aD as A,b as h,d,az as x,n as Q,c7 as D,aG as E,aK as P}from"./index.805d8f35.js";import{u as z}from"./useNewestQuestionnaireResponses.fffd2521.js";import"./_Uint8Array.3822134f.js";import"./keys.62954a7f.js";import"./_baseAssignValue.ceb5beb7.js";import"./_copyArray.56331c81.js";const M={read(e){return j(["questionnaires",e],()=>B.get(`${I}/questionnaires/${e}`).then(n=>n.data))}},O={create(e){const n=R();async function t(a){if(e.value===void 0)throw new Error("Missing ID");return await B.post(`${I}/questionnaire-responses`,a).then(c=>c.data)}return A(t,{onSuccess(){n.invalidateQueries(["companies",e,"bundles"],{exact:!0})}})}};var F=k;function N(e,n){return F(e,n)}var U=N;const f={};f.props={value:{key:"value",required:!1,type:Array},questionnaire:{key:"questionnaire",required:!0,type:null},latest:{key:"latest",required:!1,type:Array}};f.setup=(e,n)=>{const t=e,a=n.emit,c=h(),u=d(()=>{if(t.latest){if(t.latest.length===0)return{};const s={};for(const i of t.latest){const{questionId:m,value:p}=i;s[m]=p}return s}}),o=d(()=>{const s={};for(const i of t.questionnaire.questions){const{id:m,answerSchema:p}=i;if(p.type==="array")s[m]=p.default||[];else{const q=p.default||p.minimum;q&&(s[m]=q)}}return s}),r=d(()=>{if(u.value)return u.value;if(!t.value)return{};const s={};for(const i of t.value){const{questionId:m,value:p}=i;s[m]=p}return s}),_=d(()=>({...o.value,...r.value}));x(()=>_.value,s=>{s&&(c.value=$(s))},{immediate:!0}),x(()=>c.value,s=>{if(!U(s,r.value)&&s){const i=Object.entries(s).map(([m,p])=>({questionId:m,value:p}));a("input",i)}},{deep:!0,immediate:!0});const l=h(0);function y(){l.value>0&&l.value--}function g(){l.value<t.questionnaire.questions.length-1&&l.value++}function b(s){return s.replace(/_/g," ")}return{changes:c,currentIndex:l,previous:y,next:g,subject:b}};f.components=Object.assign({ProgressBar:S},f.components);var G=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.changes?t("BaseSimpleCard",{staticClass:"overflow-hidden"},[t("div",{staticClass:"flex h-132 flex-col"},[t("ProgressBar",{staticClass:"h-2 bg-gray-200",attrs:{current:e.currentIndex,max:e.questionnaire.questions.length}}),t("div",{staticClass:"px-4 py-5 sm:py-8 sm:px-6"},e._l(e.questionnaire.questions,function(a,c){var u=a.id,o=a.answerSchema;return t("span",{key:u},[c===e.currentIndex?t("span",[t("BaseOverline",{staticClass:"mb-3 block uppercase text-gray-500"},[e._v(" Question "+e._s(c+1)+" of "+e._s(e.questionnaire.questions.length)+" ")]),t("BaseH5",{staticClass:"mb-4 capitalize"},[e._v(" "+e._s(e.subject(u))+" ")]),t("BaseP1",{staticClass:"text-gray-500"},[e._v(" "+e._s(o.title)+" ")]),t("hr",{staticClass:"my-6 border-gray-300"}),o.type==="integer"?[t("BaseInput",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{type:"number",required:""},model:{value:e.changes[u],callback:function(r){e.$set(e.changes,u,e._n(r))},expression:"changes[id]"}})]:o.type==="string"?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{required:""},model:{value:e.changes[u],callback:function(r){e.$set(e.changes,u,r)},expression:"changes[id]"}},e._l(o.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:o.type==="array"&&o.items&&"enum"in o.items?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{multiple:"",size:o.items.enum?o.items.enum.length:0,required:""},model:{value:e.changes[u],callback:function(r){e.$set(e.changes,u,r)},expression:"changes[id]"}},e._l(o.items.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:e._e()],2):e._e()])}),0),t("div",{staticClass:"mt-auto border-t border-gray-200 px-4 py-4 sm:px-6"},[e.currentIndex!=0?t("BaseButton",{attrs:{action:"secondary","display-type":"info"},on:{click:function(a){return a.preventDefault(),e.previous.apply(null,arguments)}}},[e._v(" Previous ")]):e._e(),e.currentIndex<e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"},on:{click:function(a){return a.preventDefault(),e.next.apply(null,arguments)}}},[e._v(" Next ")]):e._e(),e.currentIndex===e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"}},[e._v(" View Results ")]):e._e()],1)],1)]):e._e()},H=[];const w={};var K=Q(f,G,H,!1,T,null,null,null);function T(e){for(let n in w)this[n]=w[n]}const J=function(){return K.exports}(),v={};v.setup=(e,n)=>{const t=D("id"),a=h(),c=z.get(t),u=d(()=>{var i;return(i=c.data.value)==null?void 0:i.answers}),o=M.read("main"),r=d(()=>o.data.value),_=E(),l=d(()=>_.company),y=d(()=>{var i;return(i=l.value)==null?void 0:i.id}),g=P(),b=O.create(y);return{response:a,newest:u,main:r,submit:async()=>{if(l.value&&a.value){const i={questionnaireId:"main",company:{id:l.value.id,name:l.value.name},answers:a.value};await b.mutateAsync(i),g.push(`/client/companies/${encodeURIComponent(t.value)}/journey/cyber-risk-profile`)}}}};v.components=Object.assign({QuestionnaireSingleQuestion:J},v.components);var L=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("form",{staticClass:"pt-2",on:{submit:function(a){return a.preventDefault(),e.submit.apply(null,arguments)}}},[e.main?t("QuestionnaireSingleQuestion",{attrs:{questionnaire:e.main,latest:e.newest},model:{value:e.response,callback:function(a){e.response=a},expression:"response"}}):e._e()],1)])},W=[];const C={};var X=Q(v,L,W,!1,Y,null,null,null);function Y(e){for(let n in C)this[n]=C[n]}const oe=function(){return X.exports}();export{oe as default};
