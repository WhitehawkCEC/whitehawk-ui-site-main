import{F as q}from"./FormButton.811f9150.js";import{aB as B,c as d,b0 as y,n as A,bs as C,c1 as $,bG as k,r as R,aA as D,aI as F}from"./index.77543f41.js";import{D as I}from"./DynamicForm.384793f5.js";import{l as M}from"./lodash.7ac3408f.js";import{e as _}from"./attributeValue.ea53a720.js";import{u as f}from"./useCompanyAccess.c45ae021.js";import{u as S}from"./useUsers.9800e2ab.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";const m={};m.props={value:{key:"value",required:!1,type:null},users:{key:"users",required:!0,type:Array},companyAccess:{key:"companyAccess",required:!0,type:Array}};m.setup=(s,a)=>{const e=s,n=a.emit,c=B(e,n),t=[{text:"Read",value:"READ"},{text:"Write",value:"WRITE"},{text:"Admin",value:"ADMIN"}],u=d(()=>e.companyAccess.map(({user:i})=>i)),p=d(()=>e.users.map(i=>({id:_(i,"sub"),email:_(i,"email")}))),v=d(()=>M.exports.differenceBy(p.value,u.value,o=>o.id).map(o=>({text:o.email,value:o})).sort((o,h)=>o.text.localeCompare(h.text))),r=[{name:"user",label:"User",component:{is:y,attrs:{required:!0,options:[{text:"",value:void 0},...v.value]}}},{name:"permission",label:"Permission",component:{is:y,attrs:{required:!0,options:[{text:"",value:void 0},...t]}}}];return{proxy:c,schema:r}};m.components=Object.assign({DynamicForm:I},m.components);var U=function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("DynamicForm",{attrs:{schema:s.schema},model:{value:s.proxy,callback:function(n){s.proxy=n},expression:"proxy"}})},E=[];const x={};var g=A(m,U,E,!1,j,null,null,null);function j(s){for(let a in x)this[a]=x[a]}const w=function(){return g.exports}(),l={};l.setup=(s,a)=>{const e=$("id"),n=[S.list(),f.list(e)],c=k.read(e),t=R();D(()=>c.data.value,r=>{r&&(t.value={...t.value,company:{id:e.value,name:r.name}})},{immediate:!0});const u=F(),p=f.create();async function v(){if(t.value&&t.value.company&&t.value.user&&t.value.permission){const r={company:t.value.company,user:t.value.user,permission:t.value.permission};await p.mutateAsync({id:e.value,body:r}),u.push(`/admin/companies/${encodeURIComponent(e.value)}/members`)}else throw new Error("Invalid request.")}return{queries:n,access:t,addMember:v}};l.components=Object.assign({BackButton:C,UserAccessInput:w,FormButton:q},l.components);var O=function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"space-y-6"},[e("BackButton"),e("BaseSimpleCard",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[s._v(" Add Member ")]),e("form",{staticClass:"divide-y",on:{submit:function(n){return n.preventDefault(),s.addMember.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:s.queries},scopedSlots:s._u([{key:"success",fn:function(n){var c=n[0],t=n[1];return[e("UserAccessInput",{attrs:{users:c,"company-access":t},model:{value:s.access,callback:function(u){s.access=u},expression:"access"}})]}}])}),e("FormButton",{attrs:{action:"create"}})],1)],1)],1)},P=[];const b={};var Q=A(l,O,P,!1,T,null,null,null);function T(s){for(let a in b)this[a]=b[a]}const X=function(){return Q.exports}();export{X as default};
