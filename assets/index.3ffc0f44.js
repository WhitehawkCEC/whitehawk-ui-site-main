import{F as E}from"./FormButton.3a5ad7a3.js";import{L as O}from"./LicenseTypeMapQuantitiesInput.2747d932.js";import{ch as L,cg as f,ci as A,cj as N,ck as x,cl as H,aT as G,aD as Y,cm as R,bR as z,c as v,r as $,cQ as J,aA as K,n as M,c0 as b}from"./index.36ccbbe7.js";import{m as Q}from"./message_pb.4bcfd9b8.js";import{u as U}from"./useAccountSubscriptionProductLicenseBatches.ac661c20.js";import{u as V,L as X}from"./LicenseBatchUsageDisplay.29be1467.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";import"./index.b3b7ed44.js";import"./DynamicForm.7a76db33.js";import"./calendar.aad8910e.js";import"./identification.8410fcc9.js";import"./AggregateLicenseDisplay.ce83111c.js";import"./DateRangeDisplay.1d5f1515.js";import"./IsoDateTimeDisplay.577dbaf1.js";var C={},j={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Service=t.CreateResponse=t.CreateRequest=void 0;const a=L,n=f,s=f,d=f,p=f,_=f,o=Q,u=A,m=N;class I extends _.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateRequest",[{no:1,name:"account_id",kind:"message",T:()=>m.Slug},{no:2,name:"subscription_id",kind:"message",T:()=>m.Slug},{no:3,name:"product_id",kind:"message",T:()=>u.Ulid},{no:4,name:"batch_id",kind:"message",T:()=>u.Ulid},{no:5,name:"quantities_diff",kind:"message",T:()=>o.LicenseTypeMapQuantities}])}create(e){const i={};return globalThis.Object.defineProperty(i,p.MESSAGE_TYPE,{enumerable:!1,value:this}),e!==void 0&&(0,d.reflectionMergePartial)(this,i,e),i}internalBinaryRead(e,i,r,c){let l=c!=null?c:this.create(),F=e.pos+i;for(;e.pos<F;){let[T,q]=e.tag();switch(T){case 1:l.accountId=m.Slug.internalBinaryRead(e,e.uint32(),r,l.accountId);break;case 2:l.subscriptionId=m.Slug.internalBinaryRead(e,e.uint32(),r,l.subscriptionId);break;case 3:l.productId=u.Ulid.internalBinaryRead(e,e.uint32(),r,l.productId);break;case 4:l.batchId=u.Ulid.internalBinaryRead(e,e.uint32(),r,l.batchId);break;case 5:l.quantitiesDiff=o.LicenseTypeMapQuantities.internalBinaryRead(e,e.uint32(),r,l.quantitiesDiff);break;default:let y=r.readUnknownField;if(y==="throw")throw new globalThis.Error(`Unknown field ${T} (wire type ${q}) for ${this.typeName}`);let P=e.skip(q);y!==!1&&(y===!0?s.UnknownFieldHandler.onRead:y)(this.typeName,l,T,q,P)}}return l}internalBinaryWrite(e,i,r){e.accountId&&m.Slug.internalBinaryWrite(e.accountId,i.tag(1,n.WireType.LengthDelimited).fork(),r).join(),e.subscriptionId&&m.Slug.internalBinaryWrite(e.subscriptionId,i.tag(2,n.WireType.LengthDelimited).fork(),r).join(),e.productId&&u.Ulid.internalBinaryWrite(e.productId,i.tag(3,n.WireType.LengthDelimited).fork(),r).join(),e.batchId&&u.Ulid.internalBinaryWrite(e.batchId,i.tag(4,n.WireType.LengthDelimited).fork(),r).join(),e.quantitiesDiff&&o.LicenseTypeMapQuantities.internalBinaryWrite(e.quantitiesDiff,i.tag(5,n.WireType.LengthDelimited).fork(),r).join();let c=r.writeUnknownFields;return c!==!1&&(c==!0?s.UnknownFieldHandler.onWrite:c)(this.typeName,e,i),i}}t.CreateRequest=new I;class S extends _.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateResponse",[])}create(e){const i={};return globalThis.Object.defineProperty(i,p.MESSAGE_TYPE,{enumerable:!1,value:this}),e!==void 0&&(0,d.reflectionMergePartial)(this,i,e),i}internalBinaryRead(e,i,r,c){return c!=null?c:this.create()}internalBinaryWrite(e,i,r){let c=r.writeUnknownFields;return c!==!1&&(c==!0?s.UnknownFieldHandler.onWrite:c)(this.typeName,e,i),i}}t.CreateResponse=new S,t.Service=new a.ServiceType("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.Service",[{name:"Create",options:{},I:t.CreateRequest,O:t.CreateResponse}])})(j);Object.defineProperty(C,"__esModule",{value:!0});var W=C.ServiceClient=void 0;const B=j,Z=L;class ee{constructor(a){this._transport=a,this.typeName=B.Service.typeName,this.methods=B.Service.methods,this.options=B.Service.options}create(a,n){const s=this.methods[0],d=this._transport.mergeOptions(n);return(0,Z.stackIntercept)("unary",this._transport,s,d,a)}}W=C.ServiceClient=ee;const te=new W(x),ne={create(t,a,n,s){const d=H(),p=G();async function _(o){return await te.create({accountId:{value:t.value},subscriptionId:{value:a.value},productId:{value:n.value},batchId:{value:s.value},...o},d.value)}return Y(_,{onSuccess(){const o=[[R,"accounts",t,"subscriptions",a,"products",n,"license-batches"],[R,"accounts",t,"subscriptions",a,"products",n,"license-batches",s]];for(const u of o)p.invalidateQueries(u,{exact:!0})}})}},h={};h.props={accountId:{key:"accountId",required:!0,type:String},subscriptionId:{key:"subscriptionId",required:!0,type:String},productId:{key:"productId",required:!0,type:String},batchId:{key:"batchId",required:!0,type:String}};h.setup=(t,a)=>{const s=z(t),d=ne.create(s.accountId,s.subscriptionId,s.productId,s.batchId),p=U.read(s.accountId,s.subscriptionId,s.productId,s.batchId),_=v(()=>{var e,i;return(i=(e=p.data.value)==null?void 0:e.value)==null?void 0:i.counts}),o=$(J.LicenseTypeMapQuantities.create()),u=$(!1);K(()=>_.value,e=>{var i,r;!e||u.value||(o.value={annual:((i=e.annual)==null?void 0:i.quantity)||0,oneTime:((r=e.oneTime)==null?void 0:r.quantity)||0},u.value=!0)},{immediate:!0});const m=V(_,o),I=v(()=>({quantitiesDiff:m.value})),S=v(()=>m.value.annual!==0||m.value.oneTime!==0);async function k(){await d.mutateAsync(I.value)}return{currentState:p,quantitiesDesired:o,canSubmit:S,submit:k}};h.components=Object.assign({LicenseTypeMapQuantitiesInput:O,FormButton:E},h.components);var ie=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("BaseSimpleCard",{staticClass:"divide-y"},[n("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[t._v(" Edit Quantities ")]),n("form",{staticClass:"divide-y",on:{submit:function(s){return s.preventDefault(),t.submit.apply(null,arguments)}}},[n("BaseVueQuery",{attrs:{query:t.currentState},scopedSlots:t._u([{key:"success",fn:function(){return[n("LicenseTypeMapQuantitiesInput",{model:{value:t.quantitiesDesired,callback:function(s){t.quantitiesDesired=s},expression:"quantitiesDesired"}})]},proxy:!0}])}),n("FormButton",{attrs:{action:"update","is-valid-form":t.canSubmit}})],1)],1)},se=[];const w={};var ae=M(h,ie,se,!1,re,null,null,null);function re(t){for(let a in w)this[a]=w[a]}const ce=function(){return ae.exports}(),g={};g.setup=(t,a)=>{const n=b("id"),s=b("subscriptionId"),d=b("productId"),p=b("batchId"),_=U.read(n,s,d,p),o=v(()=>{var u;return((u=_.data.value)==null?void 0:u.value)||Q.LicenseBatchUsage.create()});return{id:n,subscriptionId:s,productId:d,batchId:p,licenseBatch:_,usage:o}};g.components=Object.assign({LicenseBatchUsageDisplay:X,AccountSubscriptionBatchQuantitiesChange:ce},g.components);var ue=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("section",{staticClass:"space-y-6"},[n("BaseVueQuery",{attrs:{query:t.licenseBatch},scopedSlots:t._u([{key:"success",fn:function(){return[n("LicenseBatchUsageDisplay",{attrs:{value:t.usage}})]},proxy:!0}])}),n("AccountSubscriptionBatchQuantitiesChange",{attrs:{"account-id":t.id,"subscription-id":t.subscriptionId,"product-id":t.productId,"batch-id":t.batchId}})],1)},oe=[];const D={};var le=M(g,ue,oe,!1,de,null,null,null);function de(t){for(let a in D)this[a]=D[a]}const Ce=function(){return le.exports}();export{Ce as default};
