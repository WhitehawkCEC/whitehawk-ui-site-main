import{P as S}from"./ProgressBar.2cc5d377.js";import{c as I}from"./cloneDeep.13d04cb3.js";import{_ as Q}from"./_baseIsEqual.40e7c438.js";import{ag as j,aP as B,aQ as $,aD as R,r as b,c as f,az as x,n as k,c8 as A,aG as P,aK as D}from"./index.4e266144.js";import{u as E}from"./useNewestQuestionnaireResponses.c0e8613e.js";import"./_Uint8Array.4cdd38e5.js";import"./keys.cbce256c.js";import"./_baseAssignValue.c9876be9.js";import"./_copyArray.56331c81.js";const z={read(e){return j(["questionnaires",e],()=>B.get(`${$}/questionnaires/${e}`).then(n=>n.data))}},O={create(){async function e(n){return await B.post(`${$}/questionnaire-responses`,n).then(t=>t.data)}return R(e)}};var M=Q;function F(e,n){return M(e,n)}var N=F;const d={};d.props={value:{key:"value",required:!1,type:Array},questionnaire:{key:"questionnaire",required:!0,type:null},latest:{key:"latest",required:!1,type:Array}};d.setup=(e,n)=>{const t=e,a=n.emit,l=b(),i=f(()=>{if(t.latest){if(t.latest.length===0)return{};const s={};for(const m of t.latest){const{questionId:p,value:u}=m;s[p]=u}return s}}),o=f(()=>{const s={};for(const m of t.questionnaire.questions){const{id:p,answerSchema:u}=m;if(u.type==="array")s[p]=u.default||[];else{const q=u.default||u.minimum;q&&(s[p]=q)}}return s}),r=f(()=>{if(i.value)return i.value;if(!t.value)return{};const s={};for(const m of t.value){const{questionId:p,value:u}=m;s[p]=u}return s}),_=f(()=>({...o.value,...r.value}));x(()=>_.value,s=>{s&&(l.value=I(s))},{immediate:!0}),x(()=>l.value,s=>{if(!N(s,r.value)&&s){const m=Object.entries(s).map(([p,u])=>({questionId:p,value:u}));a("input",m)}},{deep:!0,immediate:!0});const c=b(0);function y(){c.value>0&&c.value--}function g(){c.value<t.questionnaire.questions.length-1&&c.value++}function h(s){return s.replace(/_/g," ")}return{changes:l,currentIndex:c,previous:y,next:g,subject:h}};d.components=Object.assign({ProgressBar:S},d.components);var U=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.changes?t("BaseSimpleCard",{staticClass:"overflow-hidden"},[t("div",{staticClass:"flex h-132 flex-col"},[t("ProgressBar",{staticClass:"h-2 bg-gray-200",attrs:{current:e.currentIndex,max:e.questionnaire.questions.length}}),t("div",{staticClass:"px-4 py-5 sm:py-8 sm:px-6"},e._l(e.questionnaire.questions,function(a,l){var i=a.id,o=a.answerSchema;return t("span",{key:i},[l===e.currentIndex?t("span",[t("BaseOverline",{staticClass:"mb-3 block uppercase text-gray-500"},[e._v(" Question "+e._s(l+1)+" of "+e._s(e.questionnaire.questions.length)+" ")]),t("BaseH5",{staticClass:"mb-4 capitalize"},[e._v(" "+e._s(e.subject(i))+" ")]),t("BaseP1",{staticClass:"text-gray-500"},[e._v(" "+e._s(o.title)+" ")]),t("hr",{staticClass:"my-6 border-gray-300"}),o.type==="integer"?[t("BaseInput",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{type:"number",required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,e._n(r))},expression:"changes[id]"}})]:o.type==="string"?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:o.type==="array"&&o.items&&"enum"in o.items?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{multiple:"",size:o.items.enum?o.items.enum.length:0,required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.items.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:e._e()],2):e._e()])}),0),t("div",{staticClass:"mt-auto border-t border-gray-200 px-4 py-4 sm:px-6"},[e.currentIndex!=0?t("BaseButton",{attrs:{action:"secondary","display-type":"info"},on:{click:function(a){return a.preventDefault(),e.previous.apply(null,arguments)}}},[e._v(" Previous ")]):e._e(),e.currentIndex<e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"},on:{click:function(a){return a.preventDefault(),e.next.apply(null,arguments)}}},[e._v(" Next ")]):e._e(),e.currentIndex===e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"}},[e._v(" View Results ")]):e._e()],1)],1)]):e._e()},G=[];const w={};var H=k(d,U,G,!1,K,null,null,null);function K(e){for(let n in w)this[n]=w[n]}const J=function(){return H.exports}(),v={};v.setup=(e,n)=>{const t=A("id"),a=b(),l=E.get(t),i=f(()=>{var s;return(s=l.data.value)==null?void 0:s.answers}),o=z.read("main"),r=f(()=>o.data.value),_=P(),c=f(()=>_.company),y=D(),g=O.create();return{response:a,newest:i,main:r,submit:async()=>{if(c.value&&a.value){const s={questionnaireId:"main",company:{id:c.value.id,name:c.value.name},answers:a.value};await g.mutateAsync(s),y.push(`/client/companies/${encodeURIComponent(t.value)}/journey/cyber-risk-profile`)}}}};v.components=Object.assign({QuestionnaireSingleQuestion:J},v.components);var L=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("form",{staticClass:"pt-2",on:{submit:function(a){return a.preventDefault(),e.submit.apply(null,arguments)}}},[e.main?t("QuestionnaireSingleQuestion",{attrs:{questionnaire:e.main,latest:e.newest},model:{value:e.response,callback:function(a){e.response=a},expression:"response"}}):e._e()],1)])},T=[];const C={};var W=k(v,L,T,!1,X,null,null,null);function X(e){for(let n in C)this[n]=C[n]}const oe=function(){return W.exports}();export{oe as default};
