import{F as A}from"./FormButton.3b9a38bc.js";import{D as h}from"./DynamicForm.83babd5d.js";import{aB as b,c as m,b0 as d,n as x,b$ as q,bG as $,cC as B,r as D,aI as F}from"./index.35989fb8.js";import{l as R}from"./lodash.07884320.js";import{u as k}from"./useCompanyAccess.b1b885c5.js";import{u as I}from"./useUsers.1100e409.js";import{e as S}from"./attributeValue.ea53a720.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";const i={};i.props={value:{key:"value",required:!1,type:null},companies:{key:"companies",required:!0,type:Array},companyAccess:{key:"companyAccess",required:!0,type:Array}};i.setup=(e,t)=>{const s=e,n=t.emit,c=b(s,n),u=[{text:"Read",value:"READ"},{text:"Write",value:"WRITE"},{text:"Admin",value:"ADMIN"}],a=m(()=>s.companyAccess.map(r=>r.company)),l=m(()=>s.companies.map(({id:r,name:o})=>({id:r,name:o}))),v=m(()=>R.exports.differenceBy(l.value,a.value,o=>o.id).map(o=>({text:o.name,value:o}))),y=[{name:"company",label:"Company",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...v.value]}}},{name:"permission",label:"Permission",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...u]}}}];return{proxy:c,schema:y}};i.components=Object.assign({DynamicForm:h},i.components);var E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DynamicForm",{attrs:{schema:e.schema},model:{value:e.proxy,callback:function(n){e.proxy=n},expression:"proxy"}})},g=[];const _={};var j=x(i,E,g,!1,w,null,null,null);function w(e){for(let t in _)this[t]=_[t]}const M=function(){return j.exports}(),p={};p.setup=(e,t)=>{const s=q("username"),n=[$.list(),B.list(s)],c=I.read(s),u=m(()=>c.data.value?{id:s.value,email:S(c.data.value,"email")}:void 0),a=D({company:void 0,user:u.value,permission:void 0}),l=F(),v=k.create();async function y(){var r,o;if(a.value&&a.value.company&&a.value.user&&a.value.permission){const C={company:a.value.company,user:a.value.user,permission:a.value.permission};await v.mutateAsync({id:(o=(r=a.value)==null?void 0:r.company)==null?void 0:o.id,body:C}),l.push(`/admin/users/${s.value}/companies`)}else throw new Error("Invalid request.")}return{queries:n,access:a,addCompany:y}};p.components=Object.assign({CompanyAccessInput:M,FormButton:A},p.components);var O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseSimpleCard",{staticClass:"divide-y"},[s("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[e._v(" Add Company ")]),s("form",{staticClass:"divide-y",on:{submit:function(n){return n.preventDefault(),e.addCompany.apply(null,arguments)}}},[s("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(n){var c=n[0],u=n[1];return[s("CompanyAccessInput",{attrs:{companies:c,"company-access":u},model:{value:e.access,callback:function(a){e.access=a},expression:"access"}})]}}])}),s("FormButton",{attrs:{action:"create"}})],1)],1)},P=[];const f={};var Q=x(p,O,P,!1,T,null,null,null);function T(e){for(let t in f)this[t]=f[t]}const L=function(){return Q.exports}();export{L as default};
