import{ap as x,bE as E,d as F,ab as I,aS as V,bs as j,aZ as p,n as O,bF as G,bi as N,bG as P}from"./index.0bcb67f9.js";import{B as z}from"./BackButton.aab9b380.js";import{S as H}from"./StatisticDisplayCard.5870e7c7.js";import{C as W}from"./CognitoUserStatusDisplay.ce306ccd.js";import{A as Q}from"./AppTanStackTable.4db2b760.js";import{u as Z,c as J,i as g,r as K,h as X,g as Y,a as ee,f as te,e as se,d as ae,b as ne}from"./createOnChangeFn.dfed352b.js";import{a as re}from"./attributeListToMap.bea9f70d.js";import{a as oe}from"./index.047c2e4f.js";import{t as y}from"./index.02bda646.js";import{m as k}from"./multiSet.dcd15b85.js";import{u as ie}from"./useAllCompanyAccess.95250f7a.js";import{u as le}from"./useUsers.66be00ad.js";import"./chevron-left.0808b01b.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.b65b2409.js";import"./chevron-up.736f4142.js";function B(e,n){x(2,arguments);var s=y(e),l=y(n);return s.getTime()>l.getTime()}function U(e,n){x(2,arguments);var s=y(e),l=y(n);return s.getTime()<l.getTime()}function v(e,n){x(2,arguments);var s=E(n);return oe(e,-s)}const _=new Date,ce=[{text:"Within Last 30 Days",isValid(e){const n=v(_,30);return B(e,n)}},{text:"Within Last 60 Days",isValid(e){const n=v(_,60),s=v(_,30);return B(e,n)&&U(e,s)}},{text:"Longer than 90 Days",isValid(e){const n=v(_,90);return U(e,n)}}],d={};d.props={companies:{key:"companies",required:!0,type:Array},users:{key:"users",required:!0,type:Array},access:{key:"access",required:!0,type:Array}};d.setup=(e,n)=>{const s=e,l=F(()=>{const t=Array();return s.users.map(({UserStatus:a,Attributes:o})=>{const r=re(o||[]);t.push({userStatus:a||"",attributes:r})}),t.sort((a,o)=>{var r,i,m,f;return((i=(r=a.attributes)==null?void 0:r.email)!=null?i:"").localeCompare((f=(m=o.attributes)==null?void 0:m.email)!=null?f:"")})}),u=F(()=>{const t=new Map;for(const{company:a,user:o}of s.access){const r=o.id,i=t.get(r);i?i.push(a):t.set(r,[a])}for(const a of t.values())a.sort((o,r)=>o.name.localeCompare(r.name));return t}),h=F(()=>l.value.map(({userStatus:t,attributes:a})=>{var D;const o=a.sub||"",r=a.name||"",i=a.email||"",m=a["dev:custom:last_login"]||"",f=((D=u.value.get(o))==null?void 0:D.map(({name:w})=>w))||[],S=ce.find(w=>w.isValid(I(m)));return{id:o,name:r,status:t||"",email:i,lastLogin:m,companies:f,dateGroup:S==null?void 0:S.text}}).sort((t,a)=>t.name.localeCompare(a.name))),c=J(),$=[c.accessor("name",{header:()=>"Name",cell:t=>t.getValue()}),c.accessor("status",{header:()=>"Status",cell:t=>V(W,{props:{value:t.getValue()}})}),c.accessor("email",{header:()=>"Email",cell:t=>t.getValue()}),c.accessor("lastLogin",{header:()=>"Last Login",cell:t=>V(j,{props:{value:t.getValue()}}),filterFn(t,a,o){return t.original.dateGroup===o}}),c.accessor("companies",{header:()=>"Companies",cell:t=>t.getValue().join(", "),filterFn:"arrIncludes"})],b=p([]),R=p({pageIndex:0,pageSize:10}),T=p(""),M=p([]),A=p({});return{instance:Z({get data(){return h.value},columns:$,state:{get sorting(){return b.value},get pagination(){return R.value},get globalFilter(){return T.value},get columnFilters(){return M.value},get rowSelection(){return A.value}},onSortingChange:g(b),onPaginationChange:g(R),onColumnFiltersChange:g(M),onGlobalFilterChange:g(T),globalFilterFn:(t,a,o,r)=>{const i=K(t.getValue(a),o,{threshold:X.CONTAINS});return r(i),i.passed},onRowSelectionChange:g(A),getCoreRowModel:Y(),getFacetedRowModel:ee(),getSortedRowModel:te(),getFacetedUniqueValues(t,a){const o=ne();return a==="lastLogin"?()=>{const r=t.getColumn(a).getFacetedRowModel();return k(r.flatRows.flatMap(i=>i.original.dateGroup?[i.original.dateGroup]:[]))}:a==="companies"?()=>{const r=t.getColumn(a).getFacetedRowModel();return k(r.flatRows.flatMap(i=>i.original.companies?i.original.companies:[]))}:o(t,a)},getPaginationRowModel:se(),getFilteredRowModel:ae()})}};d.components=Object.assign({AppTanStackTable:Q},d.components);var ue=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("AppTanStackTable",{attrs:{table:e.instance}})},me=[];const L={};var pe=O(d,ue,me,!1,ge,null,null,null);function ge(e){for(let n in L)this[n]=L[n]}const de=function(){return pe.exports}(),C={};C.setup=(e,n)=>{const s={title:"Total Companies",component:N},l={title:"Total Users",component:P},u=[le.list(),ie.list(),G.list()];return{companySummary:s,usersSummary:l,queries:u}};C.components=Object.assign({BackButton:z,StatisticDisplayCard:H,AdminCannedUsersTable:de},C.components);var fe=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("section",{staticClass:"space-y-8"},[s("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-x-4 sm:space-y-0"},[s("BackButton",{attrs:{link:"/admin/reports"}}),s("div",{staticClass:"flex flex-col"},[s("BaseTypography",{attrs:{component:"h2",variant:"h5"}},[e._v("Users")]),s("BaseTypography",{staticClass:"uppercase text-gray-600",attrs:{variant:"overline"}},[e._v(" Canned Report ")])],1)],1),s("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(l){var u=l[0],h=l[1],c=l[2];return[s("div",{staticClass:"space-y-6"},[s("div",{staticClass:"grid gap-6 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4"},[s("StatisticDisplayCard",{attrs:{value:e.companySummary,number:c.length}}),s("StatisticDisplayCard",{attrs:{value:e.usersSummary,number:u.length}})],1),s("AdminCannedUsersTable",{attrs:{users:u,access:h,companies:c}})],1)]}}])})],1)},ve=[];const q={};var _e=O(C,fe,ve,!1,ye,null,null,null);function ye(e){for(let n in q)this[n]=q[n]}const qe=function(){return _e.exports}();export{qe as default};
