import{P as k}from"./ProgressBar.2c267c06.js";import{c as S}from"./cloneDeep.43779cd3.js";import{_ as I}from"./_baseIsEqual.8fc02d5f.js";import{ah as j,aP as B,aQ as Q,aT as R,aD as A,b,d,az as x,n as $,c7 as P,aG as D,aK as E}from"./index.679e6820.js";import{u as z}from"./useNewestQuestionnaireResponses.e8dc221c.js";import"./_Uint8Array.02384b73.js";import"./keys.5ad61491.js";import"./_baseAssignValue.3db6f2c8.js";import"./_copyArray.56331c81.js";const O={read(e){return j(["questionnaires",e],()=>B.get(`${Q}/questionnaires/${e}`).then(n=>n.data))}},M={create(){const e=R();async function n(t){const a=await B.post(`${Q}/questionnaire-responses`,t).then(i=>i.data),u=t.company.id;return e.invalidateQueries(["companies",u,"bundles"],{exact:!0}),a}return A(n)}};var F=I;function N(e,n){return F(e,n)}var U=N;const f={};f.props={value:{key:"value",required:!1,type:Array},questionnaire:{key:"questionnaire",required:!0,type:null},latest:{key:"latest",required:!1,type:Array}};f.setup=(e,n)=>{const t=e,a=n.emit,u=b(),i=d(()=>{if(t.latest){if(t.latest.length===0)return{};const s={};for(const m of t.latest){const{questionId:p,value:c}=m;s[p]=c}return s}}),o=d(()=>{const s={};for(const m of t.questionnaire.questions){const{id:p,answerSchema:c}=m;if(c.type==="array")s[p]=c.default||[];else{const q=c.default||c.minimum;q&&(s[p]=q)}}return s}),r=d(()=>{if(i.value)return i.value;if(!t.value)return{};const s={};for(const m of t.value){const{questionId:p,value:c}=m;s[p]=c}return s}),_=d(()=>({...o.value,...r.value}));x(()=>_.value,s=>{s&&(u.value=S(s))},{immediate:!0}),x(()=>u.value,s=>{if(!U(s,r.value)&&s){const m=Object.entries(s).map(([p,c])=>({questionId:p,value:c}));a("input",m)}},{deep:!0,immediate:!0});const l=b(0);function y(){l.value>0&&l.value--}function g(){l.value<t.questionnaire.questions.length-1&&l.value++}function h(s){return s.replace(/_/g," ")}return{changes:u,currentIndex:l,previous:y,next:g,subject:h}};f.components=Object.assign({ProgressBar:k},f.components);var G=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.changes?t("BaseSimpleCard",{staticClass:"overflow-hidden"},[t("div",{staticClass:"flex h-132 flex-col"},[t("ProgressBar",{staticClass:"h-2 bg-gray-200",attrs:{current:e.currentIndex,max:e.questionnaire.questions.length}}),t("div",{staticClass:"px-4 py-5 sm:py-8 sm:px-6"},e._l(e.questionnaire.questions,function(a,u){var i=a.id,o=a.answerSchema;return t("span",{key:i},[u===e.currentIndex?t("span",[t("BaseOverline",{staticClass:"mb-3 block uppercase text-gray-500"},[e._v(" Question "+e._s(u+1)+" of "+e._s(e.questionnaire.questions.length)+" ")]),t("BaseH5",{staticClass:"mb-4 capitalize"},[e._v(" "+e._s(e.subject(i))+" ")]),t("BaseP1",{staticClass:"text-gray-500"},[e._v(" "+e._s(o.title)+" ")]),t("hr",{staticClass:"my-6 border-gray-300"}),o.type==="integer"?[t("BaseInput",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{type:"number",required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,e._n(r))},expression:"changes[id]"}})]:o.type==="string"?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:o.type==="array"&&o.items&&"enum"in o.items?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{multiple:"",size:o.items.enum?o.items.enum.length:0,required:""},model:{value:e.changes[i],callback:function(r){e.$set(e.changes,i,r)},expression:"changes[id]"}},e._l(o.items.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:e._e()],2):e._e()])}),0),t("div",{staticClass:"mt-auto border-t border-gray-200 px-4 py-4 sm:px-6"},[e.currentIndex!=0?t("BaseButton",{attrs:{action:"secondary","display-type":"info"},on:{click:function(a){return a.preventDefault(),e.previous.apply(null,arguments)}}},[e._v(" Previous ")]):e._e(),e.currentIndex<e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"},on:{click:function(a){return a.preventDefault(),e.next.apply(null,arguments)}}},[e._v(" Next ")]):e._e(),e.currentIndex===e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"}},[e._v(" View Results ")]):e._e()],1)],1)]):e._e()},H=[];const w={};var K=$(f,G,H,!1,T,null,null,null);function T(e){for(let n in w)this[n]=w[n]}const J=function(){return K.exports}(),v={};v.setup=(e,n)=>{const t=P("id"),a=b(),u=z.get(t),i=d(()=>{var s;return(s=u.data.value)==null?void 0:s.answers}),o=O.read("main"),r=d(()=>o.data.value),_=D(),l=d(()=>_.company),y=E(),g=M.create();return{response:a,newest:i,main:r,submit:async()=>{if(l.value&&a.value){const s={questionnaireId:"main",company:{id:l.value.id,name:l.value.name},answers:a.value};await g.mutateAsync(s),y.push(`/client/companies/${encodeURIComponent(t.value)}/journey/cyber-risk-profile`)}}}};v.components=Object.assign({QuestionnaireSingleQuestion:J},v.components);var L=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("form",{staticClass:"pt-2",on:{submit:function(a){return a.preventDefault(),e.submit.apply(null,arguments)}}},[e.main?t("QuestionnaireSingleQuestion",{attrs:{questionnaire:e.main,latest:e.newest},model:{value:e.response,callback:function(a){e.response=a},expression:"response"}}):e._e()],1)])},W=[];const C={};var X=$(v,L,W,!1,Y,null,null,null);function Y(e){for(let n in C)this[n]=C[n]}const oe=function(){return X.exports}();export{oe as default};
