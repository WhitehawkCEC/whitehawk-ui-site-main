import{an as F,bG as O,c as x,a9 as j,aT as V,bs as E,a_ as p,n as $,bt as G,bH as H,bj as N,bI as P}from"./index.680c0774.js";import{S as z}from"./StatisticDisplayCard.c1bd9b1f.js";import{C as W}from"./CognitoUserStatusDisplay.7e29595b.js";import{A as Q}from"./AppTanStackTable.e22039c8.js";import{u as J,c as K,i as g,r as X,h as Y,g as Z,a as ee,f as te,e as ae,d as se,b as ne}from"./createOnChangeFn.5d8dc238.js";import{a as re}from"./attributeListToMap.bea9f70d.js";import{a as oe}from"./index.e54b98ab.js";import{t as y}from"./index.a5e02e34.js";import{m as k}from"./multiSet.dcd15b85.js";import{u as ie}from"./useAllCompanyAccess.0eadbfe2.js";import{u as le}from"./useUsers.ccebbba8.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.95bfc930.js";import"./chevron-up.736f4142.js";function B(e,n){F(2,arguments);var a=y(e),l=y(n);return a.getTime()>l.getTime()}function L(e,n){F(2,arguments);var a=y(e),l=y(n);return a.getTime()<l.getTime()}function v(e,n){F(2,arguments);var a=O(n);return oe(e,-a)}const _=new Date,ce=[{text:"Within Last 30 Days",isValid(e){const n=v(_,30);return B(e,n)}},{text:"Within Last 60 Days",isValid(e){const n=v(_,60),a=v(_,30);return B(e,n)&&L(e,a)}},{text:"Longer than 90 Days",isValid(e){const n=v(_,90);return L(e,n)}}],d={};d.props={companies:{key:"companies",required:!0,type:Array},users:{key:"users",required:!0,type:Array},access:{key:"access",required:!0,type:Array}};d.setup=(e,n)=>{const a=e,l=x(()=>{const t=Array();return a.users.map(({UserStatus:s,Attributes:o})=>{const r=re(o||[]);t.push({userStatus:s||"",attributes:r})}),t.sort((s,o)=>{var r,i,m,f;return((i=(r=s.attributes)==null?void 0:r.email)!=null?i:"").localeCompare((f=(m=o.attributes)==null?void 0:m.email)!=null?f:"")})}),u=x(()=>{const t=new Map;for(const{company:s,user:o}of a.access){const r=o.id,i=t.get(r);i?i.push(s):t.set(r,[s])}for(const s of t.values())s.sort((o,r)=>o.name.localeCompare(r.name));return t}),h=x(()=>l.value.map(({userStatus:t,attributes:s})=>{var D;const o=s.sub||"",r=s.name||"",i=s.email||"",m=s["dev:custom:last_login"]||"",f=((D=u.value.get(o))==null?void 0:D.map(({name:w})=>w))||[],S=ce.find(w=>w.isValid(j(m)));return{id:o,name:r,status:t||"",email:i,lastLogin:m,companies:f,dateGroup:S==null?void 0:S.text}}).sort((t,s)=>t.name.localeCompare(s.name))),c=K(),I=[c.accessor("name",{header:()=>"Name",cell:t=>t.getValue()}),c.accessor("status",{header:()=>"Status",cell:t=>V(W,{props:{value:t.getValue()}})}),c.accessor("email",{header:()=>"Email",cell:t=>t.getValue()}),c.accessor("lastLogin",{header:()=>"Last Login",cell:t=>V(E,{props:{value:t.getValue()}}),filterFn(t,s,o){return t.original.dateGroup===o}}),c.accessor("companies",{header:()=>"Companies",cell:t=>t.getValue().join(", "),filterFn:"arrIncludes"})],T=p([]),b=p({pageIndex:0,pageSize:10}),R=p(""),M=p([]),A=p({});return{instance:J({get data(){return h.value},columns:I,state:{get sorting(){return T.value},get pagination(){return b.value},get globalFilter(){return R.value},get columnFilters(){return M.value},get rowSelection(){return A.value}},onSortingChange:g(T),onPaginationChange:g(b),onColumnFiltersChange:g(M),onGlobalFilterChange:g(R),globalFilterFn:(t,s,o,r)=>{const i=X(t.getValue(s),o,{threshold:Y.CONTAINS});return r(i),i.passed},onRowSelectionChange:g(A),getCoreRowModel:Z(),getFacetedRowModel:ee(),getSortedRowModel:te(),getFacetedUniqueValues(t,s){const o=ne();return s==="lastLogin"?()=>{const r=t.getColumn(s).getFacetedRowModel();return k(r.flatRows.flatMap(i=>i.original.dateGroup?[i.original.dateGroup]:[]))}:s==="companies"?()=>{const r=t.getColumn(s).getFacetedRowModel();return k(r.flatRows.flatMap(i=>i.original.companies?i.original.companies:[]))}:o(t,s)},getPaginationRowModel:ae(),getFilteredRowModel:se()})}};d.components=Object.assign({AppTanStackTable:Q},d.components);var ue=function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("AppTanStackTable",{attrs:{table:e.instance}})},me=[];const U={};var pe=$(d,ue,me,!1,ge,null,null,null);function ge(e){for(let n in U)this[n]=U[n]}const de=function(){return pe.exports}(),C={};C.setup=(e,n)=>{const a={title:"Total Companies",component:N},l={title:"Total Users",component:P},u=[le.list(),ie.list(),H.list()];return{companySummary:a,usersSummary:l,queries:u}};C.components=Object.assign({BackButton:G,StatisticDisplayCard:z,AdminCannedUsersTable:de},C.components);var fe=function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("section",{staticClass:"space-y-8"},[a("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-x-4 sm:space-y-0"},[a("BackButton",{attrs:{link:"/admin/reports"}}),a("div",{staticClass:"flex flex-col"},[a("BaseTypography",{attrs:{component:"h2",variant:"h5"}},[e._v("Users")]),a("BaseTypography",{staticClass:"uppercase text-gray-600",attrs:{variant:"overline"}},[e._v(" Canned Report ")])],1)],1),a("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(l){var u=l[0],h=l[1],c=l[2];return[a("div",{staticClass:"space-y-6"},[a("div",{staticClass:"grid gap-6 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4"},[a("StatisticDisplayCard",{attrs:{value:e.companySummary,number:c.length}}),a("StatisticDisplayCard",{attrs:{value:e.usersSummary,number:u.length}})],1),a("AdminCannedUsersTable",{attrs:{users:u,access:h,companies:c}})],1)]}}])})],1)},ve=[];const q={};var _e=$(C,fe,ve,!1,ye,null,null,null);function ye(e){for(let n in q)this[n]=q[n]}const Le=function(){return _e.exports}();export{Le as default};
