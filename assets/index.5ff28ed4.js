import{R as q}from"./arrow-path.24b87f73.js";import{c as a,aS as E,n as $,L as N,aZ as V,cF as T,cG as K,aF as M,cH as G,cI as H,cJ as J,b$ as Y,cK as z,cL as P,cM as U}from"./index.8f31c2ce.js";import{A as Z}from"./AppTanStackTable.3c2610f1.js";import{S as O,V as Q,t as x,p as R,i as W,a as X,b as ee}from"./SyncStatusDisplay.fe50fea9.js";import{c as te}from"./createOnChangeFn.84d47f54.js";import{u as se}from"./createSimpleTable.6b29fe3a.js";import{l as ne}from"./lodash.f500fb59.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.eefbe282.js";import"./check-circle.48e4a9f5.js";import"./chevron-up.736f4142.js";const b={};b.props={value:{key:"value",required:!0,type:Array}};b.setup=(e,n)=>{const s=e,i=a(()=>s.value),o=te(),l=[o.accessor("toBeSynced",{header:()=>"To Be Synced",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1}),o.group({id:"supplier",header:()=>"Supplier",columns:[o.accessor(c=>c.supplier.name,{id:"name",header:()=>"Name",enableColumnFilter:!1}),o.accessor(c=>c.supplier.domain,{id:"domain",header:()=>"Domain",enableColumnFilter:!1})]}),o.accessor("syncedFromBlackKite",{header:()=>"Synced From Black Kite?",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1}),o.accessor("syncedFromCyberOne",{header:()=>"Synced From CyberOne?",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1})];return{instance:se(i,l)}};b.components=Object.assign({AppTanStackTable:Z},b.components);var ae=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("AppTanStackTable",{attrs:{table:e.instance}})},ce=[];const F={};var oe=$(b,ae,ce,!1,re,null,null,null);function re(e){for(let n in F)this[n]=F[n]}const ie=function(){return oe.exports}(),g={};g.props={accountId:{key:"accountId",required:!0,type:String},assets:{key:"assets",required:!0,type:Array},entities:{key:"entities",required:!0,type:Array}};g.setup=(e,n)=>{const s=e,i=a(()=>s.accountId),o=V(),l=T.read(i,o),d=a(()=>l.data.value||K.SyncJob.create()),c=a(()=>{const t=s.entities.filter(r=>r.domain);return x(t,W)}),m=a(()=>c.value.map(({domain:t})=>R(t))),u=a(()=>c.value.map(t=>({id:t.id.toString(),name:t.name,domain:R(t.domain)}))),A=a(()=>{const t=s.assets.filter(r=>r.domain);return x(t,X)}),p=a(()=>A.value.map(t=>R(t.domain))),v=a(()=>A.value.map(t=>({id:t.referenceId,name:t.name,domain:R(t.domain)}))),k=a(()=>ne.exports.uniqBy([...u.value,...v.value],"domain")),S=a(()=>k.value.map(t=>{var r,y;return{supplier:{blackKiteId:(r=u.value.find(_=>_.domain===t.domain))==null?void 0:r.id,cyberOneId:(y=v.value.find(_=>_.domain===t.domain))==null?void 0:y.id,name:t.name,domain:t.domain},syncedFromBlackKite:m.value.includes(t.domain),syncedFromCyberOne:p.value.includes(t.domain),toBeSynced:m.value.includes(t.domain)&&p.value.includes(t.domain)}}).sort((t,r)=>Number(r.toBeSynced)-Number(t.toBeSynced))),f=a(()=>{const t=[];return S.value.forEach(r=>{if(r.toBeSynced){const{blackKiteId:y,cyberOneId:_}=r.supplier;y&&_&&t.push({target:{oneofKind:"cyberOneAssetId",cyberOneAssetId:_},source:{oneofKind:"blackKiteEntityId",blackKiteEntityId:parseInt(y)}})}}),t}),I=M(),B=T.create(i);async function w(){var y;const t={syncType:K.SyncType.BLACK_KITE_TO_CYBER_ONE,entries:f.value},r=await B.mutateAsync(t);r&&(o.value=(y=r.response.syncId)==null?void 0:y.value,I.success(`Sync ID: ${o.value}`))}return{sync:d,rows:S,mappings:f,syncCreate:B,createSync:w}};g.components=Object.assign({VrmSyncStatusDisplay:Q,LoadingSpinner:N,SyncSvg:q,CyberRiskRatingSyncTable:ie},g.components);var le=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("section",{staticClass:"space-y-6"},[s("div",{staticClass:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0"},[s("VrmSyncStatusDisplay",{attrs:{header:"Cyber Risk Rating Sync","sync-job":e.sync}}),s("BaseButton",{staticClass:"space-x-1",attrs:{disabled:e.mappings.length===0,shape:"rectangle"},on:{click:e.createSync}},[e.syncCreate.isLoading.value?s("LoadingSpinner"):s("SyncSvg",{staticClass:"w-4 xl:w-5"}),s("span",[e._v("Sync")])],1)],1),s("CyberRiskRatingSyncTable",{attrs:{value:e.rows}})],1)},ue=[];const D={};var pe=$(g,le,ue,!1,ye,null,null,null);function ye(e){for(let n in D)this[n]=D[n]}const de=function(){return pe.exports}(),C={};C.props={accountId:{key:"accountId",required:!0,type:String},syncType:{key:"syncType",required:!0,type:null},mappedEcosystem:{key:"mappedEcosystem",required:!1,type:Number}};C.setup=(e,n)=>{const s=e,i=a(()=>s.accountId),o=G.get(i),l=a(()=>o.data.value),d=H.get(i),c=a(()=>{var p;return(p=d.data.value)==null?void 0:p.mappedAssetId}),m=J.get(i),u=a(()=>m.data.value);return{syncStatus:a(()=>{var p,v,k,S,f,I;return{source:{mappedSource:s.mappedEcosystem,syncDate:(v=(p=l.value)==null?void 0:p.lastSynced)==null?void 0:v.value,syncedReports:(k=l.value)==null?void 0:k.reportsSynced},target:{mappedTarget:c.value,syncDate:(f=(S=u.value)==null?void 0:S.lastSynced)==null?void 0:f.value,syncedReports:(I=u.value)==null?void 0:I.reportsSynced}}})}};C.components=Object.assign({SyncStatusDisplay:ee},C.components);var me=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("SyncStatusDisplay",{attrs:{"sync-status":e.syncStatus,"sync-type":e.syncType}})},_e=[];const L={};var ve=$(C,me,_e,!1,Se,null,null,null);function Se(e){for(let n in L)this[n]=L[n]}const fe=function(){return ve.exports}(),h={};h.setup=(e,n)=>{const s=Y("id"),i=z.get(s),o=a(()=>{var u;return(u=i.data.value)==null?void 0:u.mappedEcosystemId}),l=P.list(s),d=a(()=>l.data.value||[]),c=U.list(s),m=a(()=>c.data.value||[]);return{SyncType:K.SyncType,id:s,mappedEcosystem:o,entities:d,assets:m}};h.components=Object.assign({CyberRiskRatingSyncStatusDisplay:fe,CyberRiskRatingSyncDisplay:de},h.components);var be=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("main",{staticClass:"space-y-6"},[s("CyberRiskRatingSyncStatusDisplay",{attrs:{"account-id":e.id,"sync-type":e.SyncType.BLACK_KITE_TO_CYBER_ONE,"mapped-ecosystem":e.mappedEcosystem}}),s("CyberRiskRatingSyncDisplay",{attrs:{"account-id":e.id,entities:e.entities,assets:e.assets}})],1)},ge=[];const j={};var Ce=$(h,be,ge,!1,ke,null,null,null);function ke(e){for(let n in j)this[n]=j[n]}const Fe=function(){return Ce.exports}();export{Fe as default};
