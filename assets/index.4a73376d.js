import{F as E}from"./FormButton.3cc3fcc2.js";import{B as Q}from"./BackButton.aa9060de.js";import{W as D,n as C,_ as U,c as y,r as h,w as L,bH as N,a1 as A,I as z,g as G,h as H}from"./index.2de808b0.js";import{B as W}from"./BatchCompanySelect.37898043.js";import{A as Y}from"./AnalystSelect.0c998418.js";import{S as J}from"./StatusInput.4c2a84ff.js";import{e as u}from"./attributeValue.ea53a720.js";import{u as K}from"./useBitsightCompanies.deb7ced1.js";import{u as X}from"./useBatchScorecards.be97f0d4.js";import{u as Z}from"./useUsers.636fdf8c.js";import"./arrow-down-on-square.6f2806b6.js";import"./trash.687d612e.js";import"./chevron-left.0808b01b.js";import"./ToolTip.211fedef.js";import"./exclamation-triangle.54812a62.js";import"./ObjectDisplay.9b58f32e.js";import"./DynamicForm.ede41704.js";const x={};x.props={value:{key:"value",required:!1,type:Array},options:{key:"options",required:!0,type:Array}};x.setup=(t,s)=>{const e=t,a=s.emit;return{proxy:D(e,a)}};var tt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center lg:gap-1"},[e("span",{staticClass:"space-x-1"},[t._v(" Companies "),e("span",{staticClass:"text-red-500"},[t._v("*")])]),e("BaseSelect",{staticClass:"lg:col-span-2",attrs:{multiple:""},model:{value:t.proxy,callback:function(a){t.proxy=a},expression:"proxy"}},[e("option",{domProps:{value:null}}),t._l(t.options,function(a){return e("option",{key:a.id,domProps:{value:a}},[e("div",{staticClass:"flex space-x-2"},[e("span",{staticClass:"text-semibold"},[t._v(" "+t._s(a.name)+" ")]),e("span",{staticClass:"text-sm text-gray-500"},[t._v("("+t._s(a.domain)+")")])])])})],2)],1)},et=[];const F={};var at=C(x,tt,et,!1,st,null,null,null);function st(t){for(let s in F)this[s]=F[s]}const nt=function(){return at.exports}(),f={};f.props={value:{key:"value",required:!1,type:null},id:{key:"id",required:!0,type:String},users:{key:"users",required:!0,type:Array},companies:{key:"companies",required:!0,type:Array},bitsightCompanies:{key:"bitsightCompanies",required:!0,type:Array}};f.setup=(t,s)=>{const e=t,a=s.emit,l=U(e,a),v=y(()=>e.users.filter(r=>u(r,"email").includes("@whitehawk")).map(r=>({id:u(r,"sub"),name:u(r,"name"),title:u(r,"custom:title"),phone:u(r,"phone_number"),email:u(r,"email")})).sort((r,m)=>r.email.localeCompare(m.email))),d=y(()=>e.bitsightCompanies.map(r=>({id:r.data.guid,name:r.data.name,domain:r.data.primary_domain}))),c=h({year:l.value.status.year,quarter:l.value.status.quarter,state:l.value.status.state});return L(c,r=>{r&&(l.value.status.state=c.value.state,l.value.status.year=c.value.year,l.value.status.quarter=c.value.quarter)},{immediate:!0}),{proxy:l,analystOptions:v,bitsightCompanyOptions:d,status:c}};f.components=Object.assign({BatchCompanySelect:W,AnalystSelect:Y,StatusInput:J,BatchBitsightCompaniesSelect:nt},f.components);var rt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"flex flex-col divide-y"},[e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Buyer Information ")]),e("BatchCompanySelect",{attrs:{options:t.companies},model:{value:t.proxy.buyerCompany,callback:function(a){t.$set(t.proxy,"buyerCompany",a)},expression:"proxy.buyerCompany"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Analyst Information ")]),e("AnalystSelect",{attrs:{options:t.analystOptions},model:{value:t.proxy.analystInfo,callback:function(a){t.$set(t.proxy,"analystInfo",a)},expression:"proxy.analystInfo"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Status ")]),e("StatusInput",{model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Select Companies ")]),e("BatchBitsightCompaniesSelect",{attrs:{options:t.bitsightCompanyOptions},model:{value:t.proxy.supplierInfos,callback:function(a){t.$set(t.proxy,"supplierInfos",a)},expression:"proxy.supplierInfos"}})],1)])},ot=[];const O={};var it=C(f,rt,ot,!1,lt,null,null,null);function lt(t){for(let s in O)this[s]=O[s]}const ut=function(){return it.exports}(),_={};_.setup=(t,s)=>{const e=N("id"),a=h(!1),l=[A.list(),K.list(e)],v=A.read(e),d=y(()=>v.data.value),c=Z.list(),r=y(()=>{var i;return(i=c.data.value)==null?void 0:i.map(o=>({id:u(o,"sub"),email:u(o,"email"),name:u(o,"name"),phone:u(o,"phone_number"),title:u(o,"custom:title")})).find(o=>o.email==="consultingservices@whitehawk.com")}),m=h(),n=y({get(){if(m.value)return m.value;const i=new Date,o=i.getUTCFullYear(),p=Math.ceil((i.getMonth()+1)/4);return{buyerCompany:d.value,analystInfo:r.value,yearQuarterValue:`${o}/${p}`,status:{year:o,quarter:"Q"+p,state:"IN_PROGRESS"},supplierInfos:[]}},set(i){m.value=i}}),R=y(()=>!!(n.value&&n.value.buyerCompany&&n.value.analystInfo&&n.value.status&&n.value.yearQuarterValue&&n.value.supplierInfos.length>0)),T=X.create(e);async function j(){var p,g,B,$,S,I,k,q,w;a.value=!0;const i={id:e.value,buyerCompany:(p=n.value)==null?void 0:p.buyerCompany,analystInfo:(g=n.value)==null?void 0:g.analystInfo,status:{year:(B=n.value)==null?void 0:B.status.year,quarter:($=n.value)==null?void 0:$.status.quarter,state:(S=n.value)==null?void 0:S.status.state},includeCmmc:(I=n.value)!=null&&I.includeCmmc?(k=n.value)==null?void 0:k.includeCmmc:!0,template:(q=n.value)==null?void 0:q.template,supplierInfos:(w=n.value)==null?void 0:w.supplierInfos},{data:o}=await T.mutateAsync(i);o&&b(o.id)}const M=z();async function b(i){await V(i)?(a.value=!1,M.push(`/admin/companies/${e.value}/scorecards/batch/rating-service-1/${i}`)):(await new Promise(p=>setTimeout(p,n.value&&n.value.supplierInfos.length<=10?2e3:4e3)),b(i))}async function V(i){const{data:o}=await G.get(`${H}/companies/${e.value}/batch/scorecards/status/${i}`);return o?o.isComplete:!1}return{id:e,queries:l,users:c,batch:n,isValidForm:R,create:j}};_.components=Object.assign({BackButton:Q,BatchScorecardInput:ut,FormButton:E},_.components);var ct=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[e("div",[e("BackButton",{attrs:{link:`/admin/companies/${t.id}/scorecards/batch/rating-service-1/`}})],1),e("BaseTypography",{attrs:{variant:"h5",component:"h2"}},[t._v(" Create New Batch ")])],1),e("BaseSimpleCard",[e("form",{staticClass:"divide-y",on:{submit:function(a){return a.preventDefault(),t.create.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:t.queries},scopedSlots:t._u([{key:"success",fn:function(a){var l=a[0],v=a[1];return[e("BatchScorecardInput",{attrs:{id:t.id,users:t.users.data.value||[],companies:l,"bitsight-companies":v},model:{value:t.batch,callback:function(d){t.batch=d},expression:"batch"}})]}}])}),e("FormButton",{attrs:{action:"create","is-valid-form":t.isValidForm}})],1)])],1)},pt=[];const P={};var mt=C(_,ct,pt,!1,yt,null,null,null);function yt(t){for(let s in P)this[s]=P[s]}const Ft=function(){return mt.exports}();export{Ft as default};
