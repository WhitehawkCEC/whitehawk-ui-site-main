import{F as M}from"./FormButton.3674c13d.js";import{aA as Q,n as x,aw as D,c as p,r as C,ay as U,bs as G,c7 as L,bG as w,aJ as N,aO as z,aP as J}from"./index.aa055da4.js";import{B as Y}from"./BatchCompanySelect.986c9895.js";import{A as H}from"./AnalystSelect.5b561499.js";import{S as K}from"./StatusInput.2b0e237a.js";import{e as u}from"./attributeValue.ea53a720.js";import{u as W}from"./useBitsightCompanies.b6bf372b.js";import{u as X}from"./useBatchScorecards.69a59d8b.js";import{u as Z}from"./useUsers.ffba7cab.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";import"./ToolTip.dc1a37a0.js";import"./ObjectDisplay.d13ad828.js";import"./DynamicForm.9f779045.js";const b={};b.props={value:{key:"value",required:!1,type:Array},options:{key:"options",required:!0,type:Array}};b.setup=(t,n)=>{const e=t,a=n.emit;return{proxy:Q(e,a)}};var tt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center lg:gap-1"},[e("span",{staticClass:"space-x-1"},[t._v(" Companies "),e("span",{staticClass:"text-red-500"},[t._v("*")])]),e("BaseSelect",{staticClass:"lg:col-span-2",attrs:{multiple:""},model:{value:t.proxy,callback:function(a){t.proxy=a},expression:"proxy"}},[e("option",{domProps:{value:null}}),t._l(t.options,function(a){return e("option",{key:a.id,domProps:{value:a}},[e("div",{staticClass:"flex space-x-2"},[e("span",{staticClass:"text-semibold"},[t._v(" "+t._s(a.name)+" ")]),e("span",{staticClass:"text-sm text-gray-500"},[t._v("("+t._s(a.domain)+")")])])])})],2)],1)},et=[];const A={};var at=x(b,tt,et,!1,st,null,null,null);function st(t){for(let n in A)this[n]=A[n]}const nt=function(){return at.exports}(),d={};d.props={value:{key:"value",required:!1,type:null},id:{key:"id",required:!0,type:String},users:{key:"users",required:!0,type:Array},companies:{key:"companies",required:!0,type:Array},bitsightCompanies:{key:"bitsightCompanies",required:!0,type:Array}};d.setup=(t,n)=>{const e=t,a=n.emit,l=D(e,a),y=p(()=>e.companies.filter(s=>s.status==="ACTIVE")),v=p(()=>e.users.filter(s=>u(s,"email").includes("@whitehawk")).map(s=>({id:u(s,"sub"),name:u(s,"name"),title:u(s,"custom:title"),phone:u(s,"phone_number"),email:u(s,"email")})).sort((s,r)=>s.email.localeCompare(r.email))),f=p(()=>e.bitsightCompanies.map(s=>({id:s.data.guid,name:s.data.name,domain:s.data.primary_domain}))),c=C({year:l.value.status.year,quarter:l.value.status.quarter,state:l.value.status.state});return U(c,s=>{s&&(l.value.status.state=c.value.state,l.value.status.year=c.value.year,l.value.status.quarter=c.value.quarter)},{immediate:!0}),{proxy:l,consumerOptions:y,analystOptions:v,bitsightCompanyOptions:f,status:c}};d.components=Object.assign({BatchCompanySelect:Y,AnalystSelect:H,StatusInput:K,BatchBitsightCompaniesSelect:nt},d.components);var rt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("section",{staticClass:"flex flex-col divide-y"},[e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Buyer Information ")]),e("BatchCompanySelect",{attrs:{options:t.consumerOptions},model:{value:t.proxy.buyerCompany,callback:function(a){t.$set(t.proxy,"buyerCompany",a)},expression:"proxy.buyerCompany"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Analyst Information ")]),e("AnalystSelect",{attrs:{options:t.analystOptions},model:{value:t.proxy.analystInfo,callback:function(a){t.$set(t.proxy,"analystInfo",a)},expression:"proxy.analystInfo"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Status ")]),e("StatusInput",{model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Select Companies ")]),e("BatchBitsightCompaniesSelect",{attrs:{options:t.bitsightCompanyOptions},model:{value:t.proxy.supplierInfos,callback:function(a){t.$set(t.proxy,"supplierInfos",a)},expression:"proxy.supplierInfos"}})],1)])},ot=[];const O={};var it=x(d,rt,ot,!1,lt,null,null,null);function lt(t){for(let n in O)this[n]=O[n]}const ut=function(){return it.exports}(),h={};h.setup=(t,n)=>{const e=L("id"),a=C(!1),l=[w.list(),W.list(e)],y=w.read(e),v=p(()=>y.data.value),f=Z.list(),c=p(()=>{var i;return(i=f.data.value)==null?void 0:i.map(o=>({id:u(o,"sub"),email:u(o,"email"),name:u(o,"name"),phone:u(o,"phone_number"),title:u(o,"custom:title")})).find(o=>o.email==="consultingservices@whitehawk.com")}),s=C(),r=p({get(){if(s.value)return s.value;const i=new Date,o=i.getUTCFullYear(),m=Math.ceil((i.getMonth()+1)/4);return{buyerCompany:v.value,analystInfo:c.value,yearQuarterValue:`${o}/${m}`,status:{year:o,quarter:"Q"+m,state:"IN_PROGRESS"},supplierInfos:[]}},set(i){s.value=i}}),P=p(()=>!!(r.value&&r.value.buyerCompany&&r.value.analystInfo&&r.value.status&&r.value.yearQuarterValue&&r.value.supplierInfos.length>0)),T=X.create(e);async function R(){var m,_,g,B,$,S,I,k,q;a.value=!0;const i={id:e.value,buyerCompany:(m=r.value)==null?void 0:m.buyerCompany,analystInfo:(_=r.value)==null?void 0:_.analystInfo,status:{year:(g=r.value)==null?void 0:g.status.year,quarter:(B=r.value)==null?void 0:B.status.quarter,state:($=r.value)==null?void 0:$.status.state},includeCmmc:(S=r.value)!=null&&S.includeCmmc?(I=r.value)==null?void 0:I.includeCmmc:!0,template:(k=r.value)==null?void 0:k.template,supplierInfos:(q=r.value)==null?void 0:q.supplierInfos},o=await T.mutateAsync(i);o&&V(o.id)}const j=N();async function V(i){await E(i),a.value=!1,j.push(`/admin/companies/${e.value}/scorecards/batch/rating-service-1/${i}`)}async function E(i){let o=!0;do(await z.get(`${J}/companies/${e.value}/scorecards/docx/${i}/status`)).data.length===0?o=!1:await new Promise(_=>setTimeout(_,2e3));while(o)}return{id:e,queries:l,users:f,batch:r,isValidForm:P,create:R}};h.components=Object.assign({BackButton:G,BatchScorecardInput:ut,FormButton:M},h.components);var ct=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[e("div",[e("BackButton",{attrs:{link:`/admin/companies/${t.id}/scorecards/batch/rating-service-1/`}})],1),e("BaseTypography",{attrs:{variant:"h5",component:"h2"}},[t._v(" Create New Batch ")])],1),e("BaseSimpleCard",[e("form",{staticClass:"divide-y",on:{submit:function(a){return a.preventDefault(),t.create.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:t.queries},scopedSlots:t._u([{key:"success",fn:function(a){var l=a[0],y=a[1];return[e("BatchScorecardInput",{attrs:{id:t.id,users:t.users.data.value||[],companies:l,"bitsight-companies":y},model:{value:t.batch,callback:function(v){t.batch=v},expression:"batch"}})]}}])}),e("FormButton",{attrs:{action:"create","is-valid-form":t.isValidForm}})],1)])],1)},pt=[];const F={};var mt=x(h,ct,pt,!1,yt,null,null,null);function yt(t){for(let n in F)this[n]=F[n]}const qt=function(){return mt.exports}();export{qt as default};
