import{F as A}from"./FormButton.cef7a800.js";import{D as h}from"./DynamicForm.59f8356f.js";import{V as q,c as m,i as d,n as x,bG as b,a0 as $,cN as D,r as F,I as R}from"./index.56631f10.js";import{l as k}from"./lodash.657dc0bb.js";import{u as B}from"./useCompanyAccess.ead260af.js";import{u as I}from"./useUsers.d4b6b690.js";import{e as S}from"./attributeValue.ea53a720.js";import"./arrow-down-on-square.6f2806b6.js";import"./trash.687d612e.js";const i={};i.props={value:{key:"value",required:!1,type:null},companies:{key:"companies",required:!0,type:Array},companyAccess:{key:"companyAccess",required:!0,type:Array}};i.setup=(e,a)=>{const s=e,n=a.emit,c=q(s,n),u=[{text:"Read",value:"READ"},{text:"Write",value:"WRITE"},{text:"Admin",value:"ADMIN"}],t=m(()=>s.companyAccess.map(r=>r.company)),l=m(()=>s.companies.map(({id:r,name:o})=>({id:r,name:o}))),v=m(()=>k.exports.differenceBy(l.value,t.value,o=>o.id).map(o=>({text:o.name,value:o}))),y=[{name:"company",label:"Company",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...v.value]}}},{name:"permission",label:"Permission",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...u]}}}];return{proxy:c,schema:y}};i.components=Object.assign({DynamicForm:h},i.components);var E=function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("DynamicForm",{attrs:{schema:e.schema},model:{value:e.proxy,callback:function(n){e.proxy=n},expression:"proxy"}})},g=[];const _={};var j=x(i,E,g,!1,w,null,null,null);function w(e){for(let a in _)this[a]=_[a]}const M=function(){return j.exports}(),p={};p.setup=(e,a)=>{const s=b("username"),n=[$.list(),D.list(s)],c=I.read(s),u=m(()=>c.data.value?{id:s.value,email:S(c.data.value,"email")}:void 0),t=F({company:void 0,user:u.value,permission:void 0}),l=R(),v=B.create();async function y(){var r,o;if(t.value&&t.value.company&&t.value.user&&t.value.permission){const C={company:t.value.company,user:t.value.user,permission:t.value.permission};await v.mutateAsync({id:(o=(r=t.value)==null?void 0:r.company)==null?void 0:o.id,body:C}),l.push(`/admin/users/${s.value}/companies`)}else throw new Error("Invalid request.")}return{queries:n,access:t,addCompany:y}};p.components=Object.assign({CompanyAccessInput:M,FormButton:A},p.components);var O=function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("BaseSimpleCard",{staticClass:"divide-y"},[s("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[e._v(" Add Company ")]),s("form",{staticClass:"divide-y",on:{submit:function(n){return n.preventDefault(),e.addCompany.apply(null,arguments)}}},[s("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(n){var c=n[0],u=n[1];return[s("CompanyAccessInput",{attrs:{companies:c,"company-access":u},model:{value:e.access,callback:function(t){e.access=t},expression:"access"}})]}}])}),s("FormButton",{attrs:{action:"create"}})],1)],1)},P=[];const f={};var N=x(p,O,P,!1,Q,null,null,null);function Q(e){for(let a in f)this[a]=f[a]}const L=function(){return N.exports}();export{L as default};
