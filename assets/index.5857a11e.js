import{D as M}from"./document-arrow-down.8787241b.js";import{aB as N,d as b,aS as g,br as q,a_ as _,az as I,n as w,ax as T,bs as V,L as j,c7 as L,b as B,aK as O,aP as P,aQ as Q}from"./index.9cfe40e7.js";import{A as U,R as E}from"./RowSelectionInput.fad0a0aa.js";import{A as Z,T as z}from"./AppTanStackTable.2b38426d.js";import{S as H}from"./ScorecardStatusBadge.50eb9847.js";import{u as Y,c as G,i as y,r as K,h as J,g as W,f as X,b as ee,e as ae,d as te}from"./createOnChangeFn.41a7ff2c.js";import{u as se}from"./useInDepthScorecards.728d9d20.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.75bc9db2.js";import"./chevron-up.736f4142.js";const f={};f.props={id:{key:"id",required:!0,type:String},value:{key:"value",required:!1,type:Array},scorecards:{key:"scorecards",required:!0,type:Array}};f.setup=(e,s)=>{const a=e,r=s.emit,o=N(a,r),i=b(()=>a.scorecards.map(t=>{var m,F;const l=new Date,c=((m=t.yearQuarterValue.split("/")[0])==null?void 0:m.trim())||l.getUTCFullYear().toString(),S=((F=t.yearQuarterValue.split("/")[1])==null?void 0:F.trim())||`Q${Math.ceil((l.getMonth()+1)/3)}`;return{id:t.id,supplier:t.data["Supplier Name"]||"",status:t.status,year:c,quarter:S,updatedAt:t.data.updatedAt||"N/A"}})),h=b(()=>i.value.filter(t=>t.supplier!=="")),n=G(),C=[n.display({id:"select",header:({table:t})=>g(U,{props:{table:t}}),cell:({row:t})=>g(E,{props:{row:t}})}),n.accessor(t=>t.supplier,{id:"supplier",header:()=>"Supplier",cell:t=>t.getValue(),enableColumnFilter:!1}),n.accessor("status",{header:()=>"Status",cell:t=>g(H,{props:{value:t.getValue()}}),enableColumnFilter:!1}),n.accessor("quarter",{header:()=>"Quarter",cell:t=>t.getValue(),enableColumnFilter:!1}),n.accessor("year",{header:()=>"Year",cell:t=>t.getValue(),enableColumnFilter:!1}),n.accessor("updatedAt",{header:()=>"Last Updated",cell:t=>g(q,{props:{value:t.getValue(),format:"date"}}),enableColumnFilter:!1}),n.display({id:"actions",header:"Actions",cell:({row:t})=>g(z,{props:{actions:[{id:"edit",to:`/admin/companies/${encodeURIComponent(a.id)}/scorecards/in-depth/rating-service-2/${t.original.id}`}]}})})],u=_([]),d=_({pageIndex:0,pageSize:10}),p=_(""),$=_({}),R=Y({get data(){return h.value},columns:C,state:{get sorting(){return u.value},get pagination(){return d.value},get globalFilter(){return p.value},get rowSelection(){return $.value}},onSortingChange:y(u),onPaginationChange:y(d),onGlobalFilterChange:y(p),globalFilterFn:(t,l,c,S)=>{const m=K(t.getValue(l),c,{threshold:J.CONTAINS});return S(m),m.passed},onRowSelectionChange:y($),getCoreRowModel:W(),getSortedRowModel:X(),getFacetedUniqueValues:ee(),getPaginationRowModel:ae(),getFilteredRowModel:te()});return I(()=>R.getSelectedRowModel().rows,t=>{if(t){const l=[];t.forEach(c=>{l.push({scorecardId:c.original.id,supplierName:c.original.supplier})}),o.value=l}}),{instance:R}};f.components=Object.assign({AppTanStackTable:Z},f.components);var re=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("AppTanStackTable",{attrs:{table:e.instance}})},oe=[];const k={};var ne=w(f,re,oe,!1,le,null,null,null);function le(e){for(let s in k)this[s]=k[s]}const ce=function(){return ne.exports}(),v={};v.props={id:{key:"id",required:!0,type:String},value:{key:"value",required:!1,type:null},scorecards:{key:"scorecards",required:!0,type:Array}};v.setup=(e,s)=>{const a=e,r=s.emit;return{proxy:T(a,r)}};v.components=Object.assign({ConvertBatchScorecardsTable:ce},v.components);var ie=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("section",{staticClass:"grid gap-6"},[a("ConvertBatchScorecardsTable",{attrs:{id:e.id,scorecards:e.scorecards},model:{value:e.proxy.scorecards,callback:function(r){e.$set(e.proxy,"scorecards",r)},expression:"proxy.scorecards"}}),a("BaseSimpleCard",{staticClass:"divide-y"},[a("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center"},[a("span",{staticClass:"space-x-1"},[e._v(" File Name "),a("span",{staticClass:"text-red-500"},[e._v("*")])]),a("div",{staticClass:"flex flex-col lg:col-span-2"},[a("BaseInput",{attrs:{type:"text",required:"","aria-required":"true"},model:{value:e.proxy.fileName,callback:function(r){e.$set(e.proxy,"fileName",r)},expression:"proxy.fileName"}})],1)]),a("dl",{staticClass:"p-4"},[a("dt",{staticClass:"sr-only"},[e._v("File Name Display:")]),a("div",{staticClass:"rounded-md border bg-gray-100 p-2 shadow-inner"},[a("dd",{staticClass:"text-gray-500"},[e._v(e._s(e.proxy.fileName)+".zip")])])])],1)],1)},ue=[];const A={};var de=w(v,ie,ue,!1,pe,null,null,null);function pe(e){for(let s in A)this[s]=A[s]}const me=function(){return de.exports}(),x={};x.setup=(e,s)=>{const a=L("id"),r=B(!1),o=B(),i=se.list(a),h=b(()=>{var u,d,p;return!((u=o.value)!=null&&u.fileName)||!((p=(d=o.value)==null?void 0:d.scorecards)!=null&&p.length)}),n=O();async function C(){if(!!o.value){r.value=!0;try{await P.post(`${Q}/companies/${a.value}/batch/scorecards`,{fileName:o.value.fileName,supplierScorecardInfos:o.value.scorecards})}finally{r.value=!1}n.push(`/admin/companies/${a.value}/scorecards/batch/rating-service-2?expandZipView=true`)}}return{id:a,isLoading:r,fileZip:o,scorecards:i,isDisabled:h,convert:C}};x.components=Object.assign({BackButton:V,ConvertScorecardsInput:me,LoadingSpinner:j,DocumentDownloadSvg:M},x.components);var ge=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"space-y-6"},[a("div",{staticClass:"flex flex-col space-y-4 lg:flex-row lg:items-center lg:space-x-4 lg:space-y-0"},[a("BackButton"),a("div",{staticClass:"flex flex-col -space-y-1"},[a("BaseOverline",{staticClass:"uppercase text-gray-500"},[e._v("Bitsight")]),a("BaseTypography",{attrs:{variant:"h5"}},[e._v("Batch Conversion")])],1)],1),a("form",{staticClass:"space-y-6",on:{submit:function(r){return r.preventDefault(),e.convert.apply(null,arguments)}}},[a("BaseVueQuery",{attrs:{query:e.scorecards},scopedSlots:e._u([{key:"success",fn:function(r){var o=r.data;return[a("ConvertScorecardsInput",{attrs:{id:e.id,scorecards:o},model:{value:e.fileZip,callback:function(i){e.fileZip=i},expression:"fileZip"}})]}}])}),a("BaseButton",{staticClass:"space-x-2",attrs:{disabled:e.isDisabled}},[e.isLoading?a("LoadingSpinner"):[a("DocumentDownloadSvg",{staticClass:"w-4 xl:w-5"}),a("span",[e._v("Convert")])]],2)],1)])},fe=[];const D={};var ve=w(x,ge,fe,!1,_e,null,null,null);function _e(e){for(let s in D)this[s]=D[s]}const Be=function(){return ve.exports}();export{Be as default};
