import{br as K,n as $,d as c,aS as P,aP as z,aQ as U,an as G,b as _,az as J,aF as X}from"./index.9293fb8e.js";import{B as Y}from"./BasicConfirmModal.91d08209.js";import{D as Z}from"./DirectorySelect.0f226971.js";import{A as ee,T as te}from"./AppTanStackTable.2095cda7.js";import{c as se}from"./createOnChangeFn.907df15b.js";import{F as ae}from"./FileSaver.min.d0db0de9.js";import{u as ne}from"./createSimpleTable.4b85ff87.js";import{u as w}from"./useFilesDirectory.5493707b.js";import"./BasicModal.862f0867.js";import"./ToolTip.568c4984.js";import"./ObjectDisplay.eee3a998.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.829c0957.js";import"./chevron-up.736f4142.js";const y={};y.props={value:{key:"value",required:!1,type:String}};y.setup=(e,o)=>({});y.components=Object.assign({DateIsoStringDisplay:K},y.components);var le=function(){var e=this,o=e.$createElement,t=e._self._c||o;return e.value?t("div",{staticClass:"flex items-center space-x-1"},[t("DateIsoStringDisplay",{staticClass:"inline-flex items-center px-2 py-0.5 text-xs font-medium uppercase leading-4 tracking-widest",attrs:{value:e.value,format:"date"}})],1):e._e()},oe=[];const M={};var ie=$(y,le,oe,!1,re,null,null,null);function re(e){for(let o in M)this[o]=M[o]}const ce=function(){return ie.exports}(),g={};g.props={value:{key:"value",required:!0,type:Array}};g.setup=(e,o)=>{const t=e,l=o.emit,i=se(),d=c(()=>{const a=[];for(const r of t.value){const{key:n,lastUpdated:f}=r;if(!(n!=null&&n.endsWith(".pdf"))&&!(n!=null&&n.endsWith(".doc"))&&!(n!=null&&n.endsWith(".mp4")))continue;const u=n.split("/");u.length===2?a.push({key:n,lastUpdated:f}):a.push({key:u[1]+"/"+u[2],lastUpdated:f})}return a}),p=[i.accessor("key",{header:()=>"File Name",enableColumnFilter:!1}),i.accessor(a=>a==null?void 0:a.lastUpdated,{id:"lastUpdated",header:()=>"Last Updated",cell:a=>P(ce,{props:{value:a.getValue(),format:"date"}}),enableColumnFilter:!1}),i.display({id:"actions",header:"Actions",cell:({row:a})=>P(te,{props:{actions:[{id:"edit",to:`/admin/file-upload/document/${a.original.key}`},{id:"download",async action(){var u;const{data:r}=await z.get(`${U}/admin/files/directory/${a.original.key}`,{responseType:"blob"}),n=(u=a.original)==null?void 0:u.key,f=C(n);ae.exports.saveAs(r,f)}},{id:"archive",action(){l("archive",a.original)},isDisabled:c(()=>{const r=a.original.key.split("/");return!(r[0]=="financial-reports"||r[0]=="testFolder"||r[0]=="nested folder")})}]}})})];function C(a){const r=a==null?void 0:a.split("/");if(r)return r[1]}const S=ne(d,p);return{rows:d,instance:S}};g.components=Object.assign({AppTanStackTable:ee},g.components);var ue=function(){var e=this,o=e.$createElement,t=e._self._c||o;return e.rows?t("div",[t("AppTanStackTable",{attrs:{table:e.instance}})],1):e._e()},de=[];const q={};var pe=$(g,ue,de,!1,fe,null,null,null);function fe(e){for(let o in q)this[o]=q[o]}const me=function(){return pe.exports}(),D={};D.setup=(e,o)=>{const t=_(),l=_(!1),i=_(!1),d=_(),p=c(()=>l.value?t.value+"/"+l.value:t.value),C=c(()=>encodeURIComponent(p==null?void 0:p.value)),S=c(()=>w.list(C)),a=c(async()=>await z.post(`${U}/admin/files/directory/allFolders/files`,{nestedDirName:""}).then(s=>s.data)),r=c(()=>{var s;if(n.value)return((s=n==null?void 0:n.value)==null?void 0:s.length)>0}),n=c(()=>{const s=v.get(t.value);return[...new Set(s)]}),f=c(()=>{var s;return(s=d.value)==null?void 0:s.key.split("/")}),u=c(()=>{var s;return(s=f.value)==null?void 0:s[0]}),h=c(()=>{var s;return(s=f.value)==null?void 0:s[1]}),k=c(()=>t.value!==u.value?u.value?t.value+"/"+u.value:t.value:l.value?t.value+"/"+l.value:t.value),E=w.delete(k,h);J(p,s=>{s&&n.value.length===0?i.value=!0:i.value=!1});function R(s){s&&(d.value=s),F.value=!0}function V(s){return s.replaceAll("-"," ")}const v=new Map;function I(s){const b=[];return s&&s.forEach(Q=>{var B;const{key:W,lastUpdated:H}=Q,m=W.split("/");if((m==null?void 0:m.length)>2){const x=m[0],A=v==null?void 0:v.get(x),N=m[1];A?A.push(N):v.set(x,[N])}if(((B=m[1])==null?void 0:B.length)===0){const x=m[0];b.push({key:x,lastUpdated:H})}}),[...new Set(b)]}const L=X();async function O(){if(k.value&&h.value)await E.mutateAsync(),T(),L.success(`Archived ${h.value} successfully`);else throw new Error("Invalid Request");window.location.reload()}const F=_(!1);function T(){F.value=!1}return{directories:t,subDirectories:l,toggleTable:i,selected:d,directoryName:p,getdirectoriesFiles:S,getAllDirectories:a,childFoldersLength:r,allChildFolders:n,fileName:h,setPayload:R,sanitizedDirectory:V,allRootFolders:I,deleteDocument:O,isModalVisible:F,closeModal:T}};D.components=Object.assign({PlusSvg:G,DirectorySelect:Z,PagesDocumentsTable:me,BasicConfirmModal:Y},D.components);var ve=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("section",{staticClass:"space-y-2"},[t("div",[t("div",{staticClass:"mb-4 flex justify-between"},[t("BaseTypography",{staticClass:"px-1 pb-6",attrs:{component:"h2",variant:"h6"}},[e._v(" Pages Content Management ")]),t("div",[t("BaseButton",{staticClass:"space-x-1 space-y-2",attrs:{to:"/admin/file-upload/document/new"}},[t("PlusSvg",{staticClass:"mr-1 w-5 xl:w-5"}),e._v(" Document ")],1)],1)],1),t("BaseSimpleCard",{staticClass:"p-4"},[t("div",{staticClass:"divide-y divide-gray-300 border-t border-l border-r border-gray-300 bg-gray-100"},[t("BaseTypography",{staticClass:"p-4 text-gray-500",attrs:{variant:"subtitle3",component:"h3"}},[e._v(" Select Production Documents Directory "),t("span",{staticClass:"font-extrabold text-red-600"},[e._v(' (Note: All folders file change impact production environment except "TestFolder") ')])]),t("div",[t("BasePromise",{attrs:{promise:e.getAllDirectories},scopedSlots:e._u([{key:"success",fn:function(l){var i=l.result;return[t("DirectorySelect",{attrs:{options:e.allRootFolders(i)},model:{value:e.directories,callback:function(d){e.directories=d},expression:"directories"}})]}}])})],1),e.childFoldersLength?t("div",{staticClass:"p-4"},[t("BaseLabel",{staticClass:"flex flex-col pb-4 lg:grid lg:grid-cols-3 lg:items-center"},[t("div",{staticClass:"flex flex-row items-center capitalize"},[e._v(" Select Sub Directory: ")]),t("BaseSelect",{staticClass:"flex flex-col capitalize lg:col-span-2",model:{value:e.subDirectories,callback:function(l){e.subDirectories=l},expression:"subDirectories"}},[t("option",{domProps:{value:null}}),e._l(e.allChildFolders,function(l){return t("option",{key:l,domProps:{value:l}},[e._v(" "+e._s(e.sanitizedDirectory(l))+" ")])})],2)],1),t("BaseVueQuery",{attrs:{query:e.getdirectoriesFiles},scopedSlots:e._u([{key:"success",fn:function(l){var i=l.data;return[t("div",{staticClass:"flex flex-col space-y-12"},[t("PagesDocumentsTable",{attrs:{value:i},on:{archive:e.setPayload}})],1)]}}],null,!1,954134757)})],1):e._e()],1),e.toggleTable?t("div",{staticClass:"mt-4"},[t("BaseVueQuery",{attrs:{query:e.getdirectoriesFiles},scopedSlots:e._u([{key:"success",fn:function(l){var i=l.data;return[t("div",{staticClass:"flex flex-col space-y-12"},[t("PagesDocumentsTable",{attrs:{value:i,name:e.directoryName}})],1)]}}],null,!1,2185955263)})],1):e._e(),e.isModalVisible&&e.selected?t("BasicConfirmModal",{attrs:{name:e.fileName},on:{delete:e.deleteDocument,close:e.closeModal}}):e._e()],1)],1)])},_e=[];const j={};var ye=$(D,ve,_e,!1,ge,null,null,null);function ge(e){for(let o in j)this[o]=j[o]}const Me=function(){return ye.exports}();export{Me as default};
