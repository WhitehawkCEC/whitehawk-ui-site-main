import{R as L}from"./arrow-path.24b87f73.js";import{c as a,aS as T,n as O,L as j,aF as q,cF as D,cG as E,cH as w,cI as N,cJ as V,b$ as M,cK as G,cL as H,cM as Y}from"./index.35d3817e.js";import{A as J}from"./AppTanStackTable.da9ab01f.js";import{S as A,V as z,t as K,p as I,i as P,a as U,b as Q}from"./SyncStatusDisplay.00f9a3d4.js";import{c as W}from"./createOnChangeFn.d6b15ae1.js";import{u as X}from"./createSimpleTable.25b440af.js";import{l as Z}from"./lodash.fda2aa75.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.521df9fa.js";import"./check-circle.48e4a9f5.js";import"./chevron-up.736f4142.js";const g={};g.props={value:{key:"value",required:!0,type:Array}};g.setup=(e,n)=>{const s=e,p=a(()=>s.value),i=W(),y=[i.accessor("toBeSynced",{header:()=>"To Be Synced",cell:c=>T(A,{props:{value:c.getValue()}}),enableColumnFilter:!1}),i.group({id:"supplier",header:()=>"Supplier",columns:[i.accessor(c=>c.supplier.name,{id:"name",header:()=>"Name",enableColumnFilter:!1}),i.accessor(c=>c.supplier.domain,{id:"domain",header:()=>"Domain",enableColumnFilter:!1})]}),i.accessor("syncedFromBlackKite",{header:()=>"Synced From Black Kite?",cell:c=>T(A,{props:{value:c.getValue()}}),enableColumnFilter:!1}),i.accessor("syncedFromCyberOne",{header:()=>"Synced From CyberOne?",cell:c=>T(A,{props:{value:c.getValue()}}),enableColumnFilter:!1})];return{instance:X(p,y)}};g.components=Object.assign({AppTanStackTable:J},g.components);var ee=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("AppTanStackTable",{attrs:{table:e.instance}})},te=[];const $={};var se=O(g,ee,te,!1,ne,null,null,null);function ne(e){for(let n in $)this[n]=$[n]}const ae=function(){return se.exports}(),C={};C.props={accountId:{key:"accountId",required:!0,type:String},assets:{key:"assets",required:!0,type:Array},entities:{key:"entities",required:!0,type:Array},mostRecent:{key:"mostRecent",required:!0,type:null}};C.setup=(e,n)=>{const s=e,p=a(()=>s.accountId),i=a(()=>{const t=s.entities.filter(r=>r.domain);return K(t,P)}),y=a(()=>i.value.map(({domain:t})=>I(t))),_=a(()=>i.value.map(t=>({id:t.id.toString(),name:t.name,domain:I(t.domain)}))),c=a(()=>{const t=s.assets.filter(r=>r.domain);return K(t,U)}),f=a(()=>c.value.map(t=>I(t.domain))),v=a(()=>c.value.map(t=>({id:t.referenceId,name:t.name,domain:I(t.domain)}))),R=a(()=>Z.exports.uniqBy([..._.value,...v.value],"domain")),l=a(()=>R.value.map(t=>{var r,m;return{supplier:{blackKiteId:(r=_.value.find(b=>b.domain===t.domain))==null?void 0:r.id,cyberOneId:(m=v.value.find(b=>b.domain===t.domain))==null?void 0:m.id,name:t.name,domain:t.domain},syncedFromBlackKite:y.value.includes(t.domain),syncedFromCyberOne:f.value.includes(t.domain),toBeSynced:y.value.includes(t.domain)&&f.value.includes(t.domain)}}).sort((t,r)=>Number(r.toBeSynced)-Number(t.toBeSynced))),o=a(()=>{const t=[];return l.value.forEach(r=>{if(r.toBeSynced){const{blackKiteId:m,cyberOneId:b}=r.supplier;m&&b&&t.push({target:{oneofKind:"cyberOneAssetId",cyberOneAssetId:b},source:{oneofKind:"blackKiteEntityId",blackKiteEntityId:parseInt(m)}})}}),t}),u=q(),d=D.create(p);async function S(){var m;const t={syncType:E.SyncType.BLACK_KITE_TO_CYBER_ONE,entries:o.value},r=await d.mutateAsync(t);r&&u.success(`Successfully synced. Sync ID: ${(m=r.response.syncId)==null?void 0:m.value}`)}return{rows:l,mappings:o,syncCreate:d,createSync:S}};C.components=Object.assign({VrmSyncStatusDisplay:z,LoadingSpinner:j,SyncSvg:L,CyberRiskRatingSyncTable:ae},C.components);var ce=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("section",{staticClass:"space-y-6"},[s("div",{staticClass:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0"},[s("VrmSyncStatusDisplay",{attrs:{header:"Cyber Risk Rating Sync","sync-job":e.mostRecent}}),s("BaseButton",{staticClass:"space-x-1",attrs:{disabled:e.mappings.length===0,shape:"rectangle"},on:{click:e.createSync}},[e.syncCreate.isLoading.value?s("LoadingSpinner"):s("SyncSvg",{staticClass:"w-4 xl:w-5"}),s("span",[e._v("Sync")])],1)],1),s("CyberRiskRatingSyncTable",{attrs:{value:e.rows}})],1)},oe=[];const B={};var re=O(C,ce,oe,!1,ie,null,null,null);function ie(e){for(let n in B)this[n]=B[n]}const le=function(){return re.exports}(),k={};k.props={accountId:{key:"accountId",required:!0,type:String},syncType:{key:"syncType",required:!0,type:null},mappedEcosystem:{key:"mappedEcosystem",required:!1,type:Number}};k.setup=(e,n)=>{const s=e,p=a(()=>s.accountId),i=w.get(p),y=a(()=>i.data.value),_=N.get(p),c=a(()=>{var l;return(l=_.data.value)==null?void 0:l.mappedAssetId}),f=V.get(p),v=a(()=>f.data.value);return{syncStatus:a(()=>{var l,o,u,d,S,t;return{source:{mappedSource:s.mappedEcosystem,syncDate:(o=(l=y.value)==null?void 0:l.lastSynced)==null?void 0:o.value,syncedReports:(u=y.value)==null?void 0:u.reportsSynced},target:{mappedTarget:c.value,syncDate:(S=(d=v.value)==null?void 0:d.lastSynced)==null?void 0:S.value,syncedReports:(t=v.value)==null?void 0:t.reportsSynced}}})}};k.components=Object.assign({SyncStatusDisplay:Q},k.components);var ue=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("SyncStatusDisplay",{attrs:{"sync-status":e.syncStatus,"sync-type":e.syncType}})},pe=[];const x={};var ye=O(k,ue,pe,!1,de,null,null,null);function de(e){for(let n in x)this[n]=x[n]}const me=function(){return ye.exports}(),h={};h.setup=(e,n)=>{const s=M("id"),p=G.get(s),i=a(()=>{var o;return(o=p.data.value)==null?void 0:o.mappedEcosystemId}),y=H.list(s),_=a(()=>y.data.value||[]),c=Y.list(s),f=a(()=>c.data.value||[]),v=D.list(s),R=a(()=>{var o;return((o=v.data.value)==null?void 0:o.filter(u=>u.syncType===E.SyncType.BLACK_KITE_TO_CYBER_ONE))||[]}),l=a(()=>R.value.sort((o,u)=>{let d="",S="";return o.lastSynced&&o.lastSynced.value&&u.lastSynced&&u.lastSynced.value&&(d=o.lastSynced.value,S=u.lastSynced.value),d.localeCompare(S)})[0]||E.SyncJob.create());return{SyncType:E.SyncType,id:s,mappedEcosystem:i,entities:_,assets:f,mostRecent:l}};h.components=Object.assign({CyberRiskRatingSyncStatusDisplay:me,CyberRiskRatingSyncDisplay:le},h.components);var _e=function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("main",{staticClass:"space-y-6"},[s("CyberRiskRatingSyncStatusDisplay",{attrs:{"account-id":e.id,"sync-type":e.SyncType.BLACK_KITE_TO_CYBER_ONE,"mapped-ecosystem":e.mappedEcosystem}}),s("CyberRiskRatingSyncDisplay",{attrs:{"account-id":e.id,entities:e.entities,assets:e.assets,"most-recent":e.mostRecent}})],1)},ve=[];const F={};var Se=O(h,_e,ve,!1,fe,null,null,null);function fe(e){for(let n in F)this[n]=F[n]}const Ke=function(){return Se.exports}();export{Ke as default};
