import{cb as L,ca as m,cc as E,cd as F,ce as O,cf as A,aS as N,aD as H,cg as R,cF as G,cG as Y,bP as z,c as v,r as w,cH as V,aA as J,n as M,bY as b}from"./index.e8125a1f.js";import{L as K}from"./LicenseTypeMapQuantitiesInput.8f948780.js";import{m as Q}from"./message_pb.5caac0be.js";import{u as U}from"./useAccountSubscriptionProductLicenseBatches.9699c444.js";import{u as X,L as Z}from"./LicenseBatchUsageDisplay.7459efb1.js";import"./index.fadf790b.js";import"./DynamicForm.2e4a1588.js";import"./calendar.aad8910e.js";import"./identification.8410fcc9.js";import"./AggregateLicenseDisplay.1c617330.js";import"./DateRangeDisplay.e0275792.js";import"./IsoDateTimeDisplay.b7ccf304.js";var q={},W={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Service=t.CreateResponse=t.CreateRequest=void 0;const a=L,n=m,s=m,d=m,p=m,_=m,o=Q,u=E,f=F;class I extends _.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateRequest",[{no:1,name:"account_id",kind:"message",T:()=>f.Slug},{no:2,name:"subscription_id",kind:"message",T:()=>f.Slug},{no:3,name:"product_id",kind:"message",T:()=>u.Ulid},{no:4,name:"batch_id",kind:"message",T:()=>u.Ulid},{no:5,name:"quantities_diff",kind:"message",T:()=>o.LicenseTypeMapQuantities}])}create(e){const i={};return globalThis.Object.defineProperty(i,p.MESSAGE_TYPE,{enumerable:!1,value:this}),e!==void 0&&(0,d.reflectionMergePartial)(this,i,e),i}internalBinaryRead(e,i,c,r){let l=r!=null?r:this.create(),P=e.pos+i;for(;e.pos<P;){let[B,C]=e.tag();switch(B){case 1:l.accountId=f.Slug.internalBinaryRead(e,e.uint32(),c,l.accountId);break;case 2:l.subscriptionId=f.Slug.internalBinaryRead(e,e.uint32(),c,l.subscriptionId);break;case 3:l.productId=u.Ulid.internalBinaryRead(e,e.uint32(),c,l.productId);break;case 4:l.batchId=u.Ulid.internalBinaryRead(e,e.uint32(),c,l.batchId);break;case 5:l.quantitiesDiff=o.LicenseTypeMapQuantities.internalBinaryRead(e,e.uint32(),c,l.quantitiesDiff);break;default:let y=c.readUnknownField;if(y==="throw")throw new globalThis.Error(`Unknown field ${B} (wire type ${C}) for ${this.typeName}`);let x=e.skip(C);y!==!1&&(y===!0?s.UnknownFieldHandler.onRead:y)(this.typeName,l,B,C,x)}}return l}internalBinaryWrite(e,i,c){e.accountId&&f.Slug.internalBinaryWrite(e.accountId,i.tag(1,n.WireType.LengthDelimited).fork(),c).join(),e.subscriptionId&&f.Slug.internalBinaryWrite(e.subscriptionId,i.tag(2,n.WireType.LengthDelimited).fork(),c).join(),e.productId&&u.Ulid.internalBinaryWrite(e.productId,i.tag(3,n.WireType.LengthDelimited).fork(),c).join(),e.batchId&&u.Ulid.internalBinaryWrite(e.batchId,i.tag(4,n.WireType.LengthDelimited).fork(),c).join(),e.quantitiesDiff&&o.LicenseTypeMapQuantities.internalBinaryWrite(e.quantitiesDiff,i.tag(5,n.WireType.LengthDelimited).fork(),c).join();let r=c.writeUnknownFields;return r!==!1&&(r==!0?s.UnknownFieldHandler.onWrite:r)(this.typeName,e,i),i}}t.CreateRequest=new I;class S extends _.MessageType{constructor(){super("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.CreateResponse",[])}create(e){const i={};return globalThis.Object.defineProperty(i,p.MESSAGE_TYPE,{enumerable:!1,value:this}),e!==void 0&&(0,d.reflectionMergePartial)(this,i,e),i}internalBinaryRead(e,i,c,r){return r!=null?r:this.create()}internalBinaryWrite(e,i,c){let r=c.writeUnknownFields;return r!==!1&&(r==!0?s.UnknownFieldHandler.onWrite:r)(this.typeName,e,i),i}}t.CreateResponse=new S,t.Service=new a.ServiceType("whitehawk.proto.internal.client_portal.accounts.id.subscriptions.subscription_id.products.product_id.license_batches.batch_id.quantity_changes.v1.Service",[{name:"Create",options:{},I:t.CreateRequest,O:t.CreateResponse}])})(W);Object.defineProperty(q,"__esModule",{value:!0});var j=q.ServiceClient=void 0;const T=W,ee=L;class te{constructor(a){this._transport=a,this.typeName=T.Service.typeName,this.methods=T.Service.methods,this.options=T.Service.options}create(a,n){const s=this.methods[0],d=this._transport.mergeOptions(n);return(0,ee.stackIntercept)("unary",this._transport,s,d,a)}}j=q.ServiceClient=te;const ne=new j(O),ie={create(t,a,n,s){const d=A(),p=N();async function _(o){return await ne.create({accountId:{value:t.value},subscriptionId:{value:a.value},productId:{value:n.value},batchId:{value:s.value},...o},d.value)}return H(_,{onSuccess(){const o=[[R,"accounts",t,"subscriptions",a,"products",n,"license-batches"],[R,"accounts",t,"subscriptions",a,"products",n,"license-batches",s]];for(const u of o)p.invalidateQueries(u,{exact:!0})}})}},h={};h.props={accountId:{key:"accountId",required:!0,type:String},subscriptionId:{key:"subscriptionId",required:!0,type:String},productId:{key:"productId",required:!0,type:String},batchId:{key:"batchId",required:!0,type:String}};h.setup=(t,a)=>{const s=z(t),d=ie.create(s.accountId,s.subscriptionId,s.productId,s.batchId),p=U.read(s.accountId,s.subscriptionId,s.productId,s.batchId),_=v(()=>{var e,i;return(i=(e=p.data.value)==null?void 0:e.value)==null?void 0:i.counts}),o=w(V.LicenseTypeMapQuantities.create()),u=w(!1);J(()=>_.value,e=>{var i,c;!e||u.value||(o.value={annual:((i=e.annual)==null?void 0:i.quantity)||0,oneTime:((c=e.oneTime)==null?void 0:c.quantity)||0},u.value=!0)},{immediate:!0});const f=X(_,o),I=v(()=>({quantitiesDiff:f.value})),S=v(()=>f.value.annual!==0||f.value.oneTime!==0);async function k(){await d.mutateAsync(I.value)}return{currentState:p,quantitiesDesired:o,canSubmit:S,submit:k}};h.components=Object.assign({BaseVueQuery:G,LicenseTypeMapQuantitiesInput:K,BaseButton:Y},h.components);var se=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("BaseSimpleCard",{staticClass:"divide-y"},[n("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[t._v(" Edit Quantities ")]),n("form",{staticClass:"divide-y",on:{submit:function(s){return s.preventDefault(),t.submit.apply(null,arguments)}}},[n("BaseVueQuery",{attrs:{query:t.currentState},scopedSlots:t._u([{key:"success",fn:function(){return[n("LicenseTypeMapQuantitiesInput",{model:{value:t.quantitiesDesired,callback:function(s){t.quantitiesDesired=s},expression:"quantitiesDesired"}})]},proxy:!0}])}),n("div",{staticClass:"p-4"},[n("BaseButton",{staticClass:"w-full md:w-auto",attrs:{action:"primary",shape:"rectangle","display-type":"success",disabled:!t.canSubmit}},[t._v(" Change ")])],1)],1)],1)},ae=[];const $={};var ce=M(h,se,ae,!1,re,null,null,null);function re(t){for(let a in $)this[a]=$[a]}const ue=function(){return ce.exports}(),g={};g.setup=(t,a)=>{const n=b("id"),s=b("subscriptionId"),d=b("productId"),p=b("batchId"),_=U.read(n,s,d,p),o=v(()=>{var u;return((u=_.data.value)==null?void 0:u.value)||Q.LicenseBatchUsage.create()});return{id:n,subscriptionId:s,productId:d,batchId:p,licenseBatch:_,usage:o}};g.components=Object.assign({LicenseBatchUsageDisplay:Z,AccountSubscriptionBatchQuantitiesChange:ue},g.components);var oe=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("section",{staticClass:"flex flex-col space-y-4"},[n("BaseVueQuery",{attrs:{query:t.licenseBatch},scopedSlots:t._u([{key:"success",fn:function(){return[n("div",{staticClass:"flex flex-col space-y-4"},[n("LicenseBatchUsageDisplay",{attrs:{value:t.usage}})],1)]},proxy:!0}])}),n("AccountSubscriptionBatchQuantitiesChange",{attrs:{"account-id":t.id,"subscription-id":t.subscriptionId,"product-id":t.productId,"batch-id":t.batchId}})],1)},le=[];const D={};var de=M(g,oe,le,!1,pe,null,null,null);function pe(t){for(let a in D)this[a]=D[a]}const Ce=function(){return de.exports}();export{Ce as default};
