import{F as E}from"./FormButton.4d6b0feb.js";import{aB as M,n as C,ax as Q,d as c,bs as D,c7 as U,b as G,bG as q,aK as L,aP as z,aQ as K}from"./index.454062da.js";import{B as N,S as W}from"./StatusInput.c3084f67.js";import{A as Y}from"./AnalystSelect.0ee7b442.js";import{e as i}from"./attributeValue.ea53a720.js";import{s as F}from"./index.a885f488.js";import{u as H}from"./useBitsightCompanies.b71497cb.js";import{u as J}from"./useBatchScorecards.352a3e1c.js";import{u as X}from"./useUsers.1afafbd7.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";import"./ToolTip.b3716f9d.js";import"./ObjectDisplay.996997b8.js";import"./DynamicForm.34adc282.js";const x={};x.props={value:{key:"value",required:!1,type:Array},options:{key:"options",required:!0,type:Array}};x.setup=(t,n)=>{const e=t,s=n.emit;return{proxy:M(e,s)}};var Z=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center lg:gap-1"},[e("span",{staticClass:"after:ml-0.5 after:text-red-700 after:content-['*']"},[t._v(" Companies ")]),e("BaseSelect",{staticClass:"lg:col-span-2",attrs:{multiple:"",required:""},model:{value:t.proxy,callback:function(s){t.proxy=s},expression:"proxy"}},t._l(t.options,function(s){return e("option",{key:s.id,domProps:{value:s}},[t._v(" "+t._s(s.name)+" ("+t._s(s.domain)+") ")])}),0)],1)},tt=[];const w={};var et=C(x,Z,tt,!1,at,null,null,null);function at(t){for(let n in w)this[n]=w[n]}const st=function(){return et.exports}(),y={};y.props={value:{key:"value",required:!1,type:null},id:{key:"id",required:!0,type:String},users:{key:"users",required:!0,type:Array},companies:{key:"companies",required:!0,type:Array},bitsightCompanies:{key:"bitsightCompanies",required:!0,type:Array}};y.setup=(t,n)=>{const e=t,s=n.emit,l=Q(e,s),p=c(()=>e.companies.filter(a=>a.status==="ACTIVE")),m=c(()=>e.users.filter(a=>i(a,"email").includes("@whitehawk")).map(a=>({id:i(a,"sub"),name:i(a,"name"),title:i(a,"custom:title"),phone:i(a,"phone_number"),email:i(a,"email")})).sort((a,v)=>a.email.localeCompare(v.email))),d=c(()=>e.bitsightCompanies.map(a=>({id:a.data.guid,name:a.data.name,domain:a.data.primary_domain}))),h=F(c(()=>({year:l.value.status.year,quarter:l.value.status.quarter,state:l.value.status.state})));return{proxy:l,consumerOptions:p,analystOptions:m,bitsightCompanyOptions:d,status:h}};y.components=Object.assign({BatchCompanySelect:N,AnalystSelect:Y,StatusInput:W,BatchBitsightCompaniesSelect:st},y.components);var nt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("section",{staticClass:"flex flex-col divide-y"},[e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Buyer Information ")]),e("BatchCompanySelect",{attrs:{options:t.consumerOptions},model:{value:t.proxy.buyerCompany,callback:function(s){t.$set(t.proxy,"buyerCompany",s)},expression:"proxy.buyerCompany"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Analyst Information ")]),e("AnalystSelect",{attrs:{options:t.analystOptions},model:{value:t.proxy.analystInfo,callback:function(s){t.$set(t.proxy,"analystInfo",s)},expression:"proxy.analystInfo"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Status ")]),e("StatusInput",{model:{value:t.status,callback:function(s){t.status=s},expression:"status"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Select Companies ")]),e("BatchBitsightCompaniesSelect",{attrs:{options:t.bitsightCompanyOptions},model:{value:t.proxy.supplierInfos,callback:function(s){t.$set(t.proxy,"supplierInfos",s)},expression:"proxy.supplierInfos"}})],1)])},rt=[];const A={};var ot=C(y,nt,rt,!1,it,null,null,null);function it(t){for(let n in A)this[n]=A[n]}const lt=function(){return ot.exports}(),_={};_.setup=(t,n)=>{const e=U("id"),s=G(!1),l=[q.list(),H.list(e)],p=q.read(e),m=c(()=>p.data.value),d=X.list(),h=c(()=>{var o;return(o=d.data.value)==null?void 0:o.map(r=>({id:i(r,"sub"),email:i(r,"email"),name:i(r,"name"),phone:i(r,"phone_number"),title:i(r,"custom:title")})).find(r=>r.email==="consultingservices@whitehawk.com")}),a=F(c(()=>{const o=new Date,r=o.getUTCFullYear(),u=Math.ceil((o.getMonth()+1)/4);return{buyerCompany:m.value,analystInfo:h.value,yearQuarterValue:`${r}/${u}`,status:{year:r,quarter:"Q"+u,state:"IN_PROGRESS"},supplierInfos:[]}})),v=c(()=>!!(a.value&&a.value.buyerCompany&&a.value.analystInfo&&a.value.status&&a.value.yearQuarterValue&&a.value.supplierInfos.length>0)),R=J.create(e);async function T(){var u,f,b,g,B,S,$,I,k;s.value=!0;const o={id:e.value,buyerCompany:(u=a.value)==null?void 0:u.buyerCompany,analystInfo:(f=a.value)==null?void 0:f.analystInfo,status:{year:(b=a.value)==null?void 0:b.status.year,quarter:(g=a.value)==null?void 0:g.status.quarter,state:(B=a.value)==null?void 0:B.status.state},includeCmmc:(S=a.value)!=null&&S.includeCmmc?($=a.value)==null?void 0:$.includeCmmc:!0,template:(I=a.value)==null?void 0:I.template,supplierInfos:(k=a.value)==null?void 0:k.supplierInfos},r=await R.mutateAsync(o);r&&j(r.id)}const P=L();async function j(o){await V(o),s.value=!1,P.push(`/admin/companies/${e.value}/scorecards/batch/rating-service-1/${o}`)}async function V(o){let r=!0;do(await z.get(`${K}/companies/${e.value}/scorecards/docx/${o}/status`)).data.length===0?r=!1:await new Promise(f=>setTimeout(f,2e3));while(r)}return{id:e,queries:l,users:d,batch:a,isValidForm:v,create:T}};_.components=Object.assign({BackButton:D,BatchScorecardInput:lt,FormButton:E},_.components);var ct=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"space-y-6"},[e("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[e("BackButton"),e("div",{staticClass:"flex flex-col -space-y-1"},[e("BaseOverline",{staticClass:"uppercase text-gray-500"},[t._v("Bitsight")]),e("BaseTypography",{attrs:{variant:"h5"}},[t._v("Batch Scorecard")])],1)],1),e("BaseSimpleCard",[e("form",{staticClass:"divide-y",on:{submit:function(s){return s.preventDefault(),t.create.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:t.queries},scopedSlots:t._u([{key:"success",fn:function(s){var l=s[0],p=s[1];return[e("BatchScorecardInput",{attrs:{id:t.id,users:t.users.data.value||[],companies:l,"bitsight-companies":p},model:{value:t.batch,callback:function(m){t.batch=m},expression:"batch"}})]}}])}),e("FormButton",{attrs:{action:"create","is-valid-form":t.isValidForm}})],1)])],1)},ut=[];const O={};var pt=C(_,ct,ut,!1,mt,null,null,null);function mt(t){for(let n in O)this[n]=O[n]}const kt=function(){return pt.exports}();export{kt as default};
