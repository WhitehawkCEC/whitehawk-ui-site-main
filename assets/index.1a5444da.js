import{P as k}from"./ProgressBar.a76f20b2.js";import{c as S}from"./cloneDeep.319db0a0.js";import{_ as I}from"./_baseIsEqual.8c67324b.js";import{ah as j,aP as B,aQ as Q,aT as R,aD as A,b as v,d,az as x,n as $,c7 as P,aG as D,aK as E}from"./index.26316912.js";import{u as z}from"./useNewestQuestionnaireResponses.5621c1b2.js";import"./_Uint8Array.65afd8a5.js";import"./keys.52fb7443.js";import"./_baseAssignValue.2b841c57.js";import"./_copyArray.56331c81.js";const O={read(e){return j(["questionnaires",e],()=>B.get(`${Q}/questionnaires/${e}`).then(n=>n.data))}},M={create(){const e=R();async function n(t){const a=await B.post(`${Q}/questionnaire-responses`,t).then(u=>u.data);return e.invalidateQueries(["companies",v(t.company.id),"bundles"],{exact:!0}),a}return A(n)}};var F=I;function N(e,n){return F(e,n)}var U=N;const f={};f.props={value:{key:"value",required:!1,type:Array},questionnaire:{key:"questionnaire",required:!0,type:null},latest:{key:"latest",required:!1,type:Array}};f.setup=(e,n)=>{const t=e,a=n.emit,u=v(),o=d(()=>{if(t.latest){if(t.latest.length===0)return{};const s={};for(const m of t.latest){const{questionId:p,value:c}=m;s[p]=c}return s}}),i=d(()=>{const s={};for(const m of t.questionnaire.questions){const{id:p,answerSchema:c}=m;if(c.type==="array")s[p]=c.default||[];else{const q=c.default||c.minimum;q&&(s[p]=q)}}return s}),r=d(()=>{if(o.value)return o.value;if(!t.value)return{};const s={};for(const m of t.value){const{questionId:p,value:c}=m;s[p]=c}return s}),y=d(()=>({...i.value,...r.value}));x(()=>y.value,s=>{s&&(u.value=S(s))},{immediate:!0}),x(()=>u.value,s=>{if(!U(s,r.value)&&s){const m=Object.entries(s).map(([p,c])=>({questionId:p,value:c}));a("input",m)}},{deep:!0,immediate:!0});const l=v(0);function g(){l.value>0&&l.value--}function b(){l.value<t.questionnaire.questions.length-1&&l.value++}function h(s){return s.replace(/_/g," ")}return{changes:u,currentIndex:l,previous:g,next:b,subject:h}};f.components=Object.assign({ProgressBar:k},f.components);var G=function(){var e=this,n=e.$createElement,t=e._self._c||n;return e.changes?t("BaseSimpleCard",{staticClass:"overflow-hidden"},[t("div",{staticClass:"flex h-132 flex-col"},[t("ProgressBar",{staticClass:"h-2 bg-gray-200",attrs:{current:e.currentIndex,max:e.questionnaire.questions.length}}),t("div",{staticClass:"px-4 py-5 sm:py-8 sm:px-6"},e._l(e.questionnaire.questions,function(a,u){var o=a.id,i=a.answerSchema;return t("span",{key:o},[u===e.currentIndex?t("span",[t("BaseOverline",{staticClass:"mb-3 block uppercase text-gray-500"},[e._v(" Question "+e._s(u+1)+" of "+e._s(e.questionnaire.questions.length)+" ")]),t("BaseH5",{staticClass:"mb-4 capitalize"},[e._v(" "+e._s(e.subject(o))+" ")]),t("BaseP1",{staticClass:"text-gray-500"},[e._v(" "+e._s(i.title)+" ")]),t("hr",{staticClass:"my-6 border-gray-300"}),i.type==="integer"?[t("BaseInput",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{type:"number",required:""},model:{value:e.changes[o],callback:function(r){e.$set(e.changes,o,e._n(r))},expression:"changes[id]"}})]:i.type==="string"?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{required:""},model:{value:e.changes[o],callback:function(r){e.$set(e.changes,o,r)},expression:"changes[id]"}},e._l(i.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:i.type==="array"&&i.items&&"enum"in i.items?[t("BaseSelect",{staticClass:"mt-1 mb-4 w-full border-b border-gray-300 md:w-1/2",attrs:{multiple:"",size:i.items.enum?i.items.enum.length:0,required:""},model:{value:e.changes[o],callback:function(r){e.$set(e.changes,o,r)},expression:"changes[id]"}},e._l(i.items.enum,function(r){return t("option",{key:String(r)},[e._v(" "+e._s(r)+" ")])}),0)]:e._e()],2):e._e()])}),0),t("div",{staticClass:"mt-auto border-t border-gray-200 px-4 py-4 sm:px-6"},[e.currentIndex!=0?t("BaseButton",{attrs:{action:"secondary","display-type":"info"},on:{click:function(a){return a.preventDefault(),e.previous.apply(null,arguments)}}},[e._v(" Previous ")]):e._e(),e.currentIndex<e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"},on:{click:function(a){return a.preventDefault(),e.next.apply(null,arguments)}}},[e._v(" Next ")]):e._e(),e.currentIndex===e.questionnaire.questions.length-1?t("BaseButton",{staticClass:"float-right",attrs:{"display-type":"info"}},[e._v(" View Results ")]):e._e()],1)],1)]):e._e()},H=[];const w={};var K=$(f,G,H,!1,T,null,null,null);function T(e){for(let n in w)this[n]=w[n]}const J=function(){return K.exports}(),_={};_.setup=(e,n)=>{const t=P("id"),a=v(),u=z.get(t),o=d(()=>{var s;return(s=u.data.value)==null?void 0:s.answers}),i=O.read("main"),r=d(()=>i.data.value),y=D(),l=d(()=>y.company),g=E(),b=M.create();return{response:a,newest:o,main:r,submit:async()=>{if(l.value&&a.value){const s={questionnaireId:"main",company:{id:l.value.id,name:l.value.name},answers:a.value};await b.mutateAsync(s),g.push(`/client/companies/${encodeURIComponent(t.value)}/journey/cyber-risk-profile`)}}}};_.components=Object.assign({QuestionnaireSingleQuestion:J},_.components);var L=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("form",{staticClass:"pt-2",on:{submit:function(a){return a.preventDefault(),e.submit.apply(null,arguments)}}},[e.main?t("QuestionnaireSingleQuestion",{attrs:{questionnaire:e.main,latest:e.newest},model:{value:e.response,callback:function(a){e.response=a},expression:"response"}}):e._e()],1)])},W=[];const C={};var X=$(_,L,W,!1,Y,null,null,null);function Y(e){for(let n in C)this[n]=C[n]}const oe=function(){return X.exports}();export{oe as default};
