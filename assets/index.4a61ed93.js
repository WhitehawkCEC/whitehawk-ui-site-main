import{R as q}from"./arrow-path.24b87f73.js";import{c as a,aS as E,n as $,L as V,aZ as M,cF as x,cG as K,aF as G,cH as N,cI as H,cJ as J,b$ as Y,cK as z,cL as P,cM as U}from"./index.5a8760c9.js";import{A as Z}from"./AppTanStackTable.da136973.js";import{S as O,V as Q,t as B,p as R,i as W,a as X,b as ee}from"./SyncStatusDisplay.3457d294.js";import{c as te}from"./createOnChangeFn.b0bebc8b.js";import{u as se}from"./createSimpleTable.a92a77ea.js";import{l as ne}from"./lodash.088f1348.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.a00d97e1.js";import"./check-circle.48e4a9f5.js";import"./chevron-up.736f4142.js";const b={};b.props={value:{key:"value",required:!0,type:Array}};b.setup=(e,n)=>{const t=e,i=a(()=>t.value),o=te(),l=[o.accessor("toBeSynced",{header:()=>"To Be Synced",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1}),o.group({id:"supplier",header:()=>"Supplier",columns:[o.accessor(c=>c.supplier.name,{id:"name",header:()=>"Name",enableColumnFilter:!1}),o.accessor(c=>c.supplier.domain,{id:"domain",header:()=>"Domain",enableColumnFilter:!1})]}),o.accessor("syncedFromBlackKite",{header:()=>"Synced From Black Kite?",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1}),o.accessor("syncedFromCyberOne",{header:()=>"Synced From CyberOne?",cell:c=>E(O,{props:{value:c.getValue()}}),enableColumnFilter:!1})];return{instance:se(i,l)}};b.components=Object.assign({AppTanStackTable:Z},b.components);var ae=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("AppTanStackTable",{attrs:{table:e.instance}})},ce=[];const F={};var oe=$(b,ae,ce,!1,re,null,null,null);function re(e){for(let n in F)this[n]=F[n]}const ie=function(){return oe.exports}(),g={};g.props={accountId:{key:"accountId",required:!0,type:String},assets:{key:"assets",required:!0,type:Array},entities:{key:"entities",required:!0,type:Array}};g.setup=(e,n)=>{const t=e,i=a(()=>t.accountId),o=M(),l=x.read(i,o),d=a(()=>l.data.value||K.SyncJob.create()),c=a(()=>{const s=t.entities.filter(r=>r.domain);return B(s,W)}),m=a(()=>c.value.map(({domain:s})=>R(s))),u=a(()=>c.value.map(s=>({id:s.id.toString(),name:s.name,domain:R(s.domain)}))),A=a(()=>{const s=t.assets.filter(r=>r.domain);return B(s,X)}),p=a(()=>A.value.map(s=>R(s.domain))),v=a(()=>A.value.map(s=>({id:s.referenceId,name:s.name,domain:R(s.domain)}))),k=a(()=>ne.exports.uniqBy([...u.value,...v.value],"domain")),f=a(()=>k.value.map(s=>{var r,y;return{supplier:{blackKiteId:(r=u.value.find(_=>_.domain===s.domain))==null?void 0:r.id,cyberOneId:(y=v.value.find(_=>_.domain===s.domain))==null?void 0:y.id,name:s.name,domain:s.domain},syncedFromBlackKite:m.value.includes(s.domain),syncedFromCyberOne:p.value.includes(s.domain),toBeSynced:m.value.includes(s.domain)&&p.value.includes(s.domain)}})),S=a(()=>{const s=[];return f.value.forEach(r=>{if(r.toBeSynced){const{blackKiteId:y,cyberOneId:_}=r.supplier;y&&_&&s.push({target:{oneofKind:"cyberOneAssetId",cyberOneAssetId:_},source:{oneofKind:"blackKiteEntityId",blackKiteEntityId:parseInt(y)}})}}),s}),I=G(),T=x.create(i);async function w(){var y;const s={syncType:K.SyncType.BLACK_KITE_TO_CYBER_ONE,entries:S.value},r=await T.mutateAsync(s);r&&(o.value=(y=r.response.syncId)==null?void 0:y.value,I.success(`Sync ID: ${o.value}`))}return{sync:d,rows:f,mappings:S,syncCreate:T,createSync:w}};g.components=Object.assign({VrmSyncStatusDisplay:Q,LoadingSpinner:V,SyncSvg:q,CyberRiskRatingSyncTable:ie},g.components);var le=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",{staticClass:"space-y-6"},[t("div",{staticClass:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0"},[t("VrmSyncStatusDisplay",{attrs:{header:"Cyber Risk Rating Sync","sync-job":e.sync}}),t("BaseButton",{staticClass:"space-x-1",attrs:{disabled:e.mappings.length===0,shape:"rectangle"},on:{click:e.createSync}},[e.syncCreate.isLoading.value?t("LoadingSpinner"):t("SyncSvg",{staticClass:"w-4 xl:w-5"}),t("span",[e._v("Sync")])],1)],1),t("CyberRiskRatingSyncTable",{attrs:{value:e.rows}})],1)},ue=[];const D={};var pe=$(g,le,ue,!1,ye,null,null,null);function ye(e){for(let n in D)this[n]=D[n]}const de=function(){return pe.exports}(),C={};C.props={accountId:{key:"accountId",required:!0,type:String},syncType:{key:"syncType",required:!0,type:null},mappedEcosystem:{key:"mappedEcosystem",required:!1,type:Number}};C.setup=(e,n)=>{const t=e,i=a(()=>t.accountId),o=N.get(i),l=a(()=>o.data.value),d=H.get(i),c=a(()=>{var p;return(p=d.data.value)==null?void 0:p.mappedAssetId}),m=J.get(i),u=a(()=>m.data.value);return{syncStatus:a(()=>{var p,v,k,f,S,I;return{source:{mappedSource:t.mappedEcosystem,syncDate:(v=(p=l.value)==null?void 0:p.lastSynced)==null?void 0:v.value,syncedReports:(k=l.value)==null?void 0:k.reportsSynced},target:{mappedTarget:c.value,syncDate:(S=(f=u.value)==null?void 0:f.lastSynced)==null?void 0:S.value,syncedReports:(I=u.value)==null?void 0:I.reportsSynced}}})}};C.components=Object.assign({SyncStatusDisplay:ee},C.components);var me=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("SyncStatusDisplay",{attrs:{"sync-status":e.syncStatus,"sync-type":e.syncType}})},_e=[];const L={};var ve=$(C,me,_e,!1,fe,null,null,null);function fe(e){for(let n in L)this[n]=L[n]}const Se=function(){return ve.exports}(),h={};h.setup=(e,n)=>{const t=Y("id"),i=z.get(t),o=a(()=>{var u;return(u=i.data.value)==null?void 0:u.mappedEcosystemId}),l=P.list(t),d=a(()=>l.data.value||[]),c=U.list(t),m=a(()=>c.data.value||[]);return{SyncType:K.SyncType,id:t,mappedEcosystem:o,entities:d,assets:m}};h.components=Object.assign({CyberRiskRatingSyncStatusDisplay:Se,CyberRiskRatingSyncDisplay:de},h.components);var be=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("main",{staticClass:"space-y-6"},[t("CyberRiskRatingSyncStatusDisplay",{attrs:{"account-id":e.id,"sync-type":e.SyncType.BLACK_KITE_TO_CYBER_ONE,"mapped-ecosystem":e.mappedEcosystem}}),t("CyberRiskRatingSyncDisplay",{attrs:{"account-id":e.id,entities:e.entities,assets:e.assets}})],1)},ge=[];const j={};var Ce=$(h,be,ge,!1,ke,null,null,null);function ke(e){for(let n in j)this[n]=j[n]}const Fe=function(){return Ce.exports}();export{Fe as default};
