import{F as V}from"./FormButton.fbdb8656.js";import{aB as E,n as x,ay as D,c as y,r as C,aA as U,bs as G,b$ as L,bG as w,aI as N,aP as z,aQ as Y}from"./index.820be458.js";import{B as H}from"./BatchCompanySelect.927ec8ca.js";import{A as J}from"./AnalystSelect.2691d8dd.js";import{S as K}from"./StatusInput.c88d085f.js";import{e as u}from"./attributeValue.ea53a720.js";import{u as W}from"./useBitsightCompanies.c2d109c7.js";import{u as X}from"./useBatchScorecards.c41ce845.js";import{u as Z}from"./useUsers.cefda8ea.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";import"./ToolTip.d24bf38b.js";import"./exclamation-triangle.54812a62.js";import"./ObjectDisplay.7b316660.js";import"./DynamicForm.93d4a4dc.js";const b={};b.props={value:{key:"value",required:!1,type:Array},options:{key:"options",required:!0,type:Array}};b.setup=(t,s)=>{const e=t,a=s.emit;return{proxy:E(e,a)}};var tt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center lg:gap-1"},[e("span",{staticClass:"space-x-1"},[t._v(" Companies "),e("span",{staticClass:"text-red-500"},[t._v("*")])]),e("BaseSelect",{staticClass:"lg:col-span-2",attrs:{multiple:""},model:{value:t.proxy,callback:function(a){t.proxy=a},expression:"proxy"}},[e("option",{domProps:{value:null}}),t._l(t.options,function(a){return e("option",{key:a.id,domProps:{value:a}},[e("div",{staticClass:"flex space-x-2"},[e("span",{staticClass:"text-semibold"},[t._v(" "+t._s(a.name)+" ")]),e("span",{staticClass:"text-sm text-gray-500"},[t._v("("+t._s(a.domain)+")")])])])})],2)],1)},et=[];const A={};var at=x(b,tt,et,!1,st,null,null,null);function st(t){for(let s in A)this[s]=A[s]}const nt=function(){return at.exports}(),f={};f.props={value:{key:"value",required:!1,type:null},id:{key:"id",required:!0,type:String},users:{key:"users",required:!0,type:Array},companies:{key:"companies",required:!0,type:Array},bitsightCompanies:{key:"bitsightCompanies",required:!0,type:Array}};f.setup=(t,s)=>{const e=t,a=s.emit,l=D(e,a),v=y(()=>e.users.filter(n=>u(n,"email").includes("@whitehawk")).map(n=>({id:u(n,"sub"),name:u(n,"name"),title:u(n,"custom:title"),phone:u(n,"phone_number"),email:u(n,"email")})).sort((n,p)=>n.email.localeCompare(p.email))),d=y(()=>e.bitsightCompanies.map(n=>({id:n.data.guid,name:n.data.name,domain:n.data.primary_domain}))),c=C({year:l.value.status.year,quarter:l.value.status.quarter,state:l.value.status.state});return U(c,n=>{n&&(l.value.status.state=c.value.state,l.value.status.year=c.value.year,l.value.status.quarter=c.value.quarter)},{immediate:!0}),{proxy:l,analystOptions:v,bitsightCompanyOptions:d,status:c}};f.components=Object.assign({BatchCompanySelect:H,AnalystSelect:J,StatusInput:K,BatchBitsightCompaniesSelect:nt},f.components);var rt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"flex flex-col divide-y"},[e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Buyer Information ")]),e("BatchCompanySelect",{attrs:{options:t.companies},model:{value:t.proxy.buyerCompany,callback:function(a){t.$set(t.proxy,"buyerCompany",a)},expression:"proxy.buyerCompany"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Analyst Information ")]),e("AnalystSelect",{attrs:{options:t.analystOptions},model:{value:t.proxy.analystInfo,callback:function(a){t.$set(t.proxy,"analystInfo",a)},expression:"proxy.analystInfo"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Status ")]),e("StatusInput",{model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})],1),e("div",{staticClass:"divide-y"},[e("BaseTypography",{staticClass:"p-4",attrs:{variant:"subtitle3",component:"h3"}},[t._v(" Select Companies ")]),e("BatchBitsightCompaniesSelect",{attrs:{options:t.bitsightCompanyOptions},model:{value:t.proxy.supplierInfos,callback:function(a){t.$set(t.proxy,"supplierInfos",a)},expression:"proxy.supplierInfos"}})],1)])},ot=[];const F={};var it=x(f,rt,ot,!1,lt,null,null,null);function lt(t){for(let s in F)this[s]=F[s]}const ut=function(){return it.exports}(),h={};h.setup=(t,s)=>{const e=L("id"),a=C(!1),l=[w.list(),W.list(e)],v=w.read(e),d=y(()=>v.data.value),c=Z.list(),n=y(()=>{var i;return(i=c.data.value)==null?void 0:i.map(o=>({id:u(o,"sub"),email:u(o,"email"),name:u(o,"name"),phone:u(o,"phone_number"),title:u(o,"custom:title")})).find(o=>o.email==="consultingservices@whitehawk.com")}),p=C(),r=y({get(){if(p.value)return p.value;const i=new Date,o=i.getUTCFullYear(),m=Math.ceil((i.getMonth()+1)/4);return{buyerCompany:d.value,analystInfo:n.value,yearQuarterValue:`${o}/${m}`,status:{year:o,quarter:"Q"+m,state:"IN_PROGRESS"},supplierInfos:[]}},set(i){p.value=i}}),P=y(()=>!!(r.value&&r.value.buyerCompany&&r.value.analystInfo&&r.value.status&&r.value.yearQuarterValue&&r.value.supplierInfos.length>0)),R=X.create(e);async function T(){var m,_,g,B,$,S,I,k,q;a.value=!0;const i={id:e.value,buyerCompany:(m=r.value)==null?void 0:m.buyerCompany,analystInfo:(_=r.value)==null?void 0:_.analystInfo,status:{year:(g=r.value)==null?void 0:g.status.year,quarter:(B=r.value)==null?void 0:B.status.quarter,state:($=r.value)==null?void 0:$.status.state},includeCmmc:(S=r.value)!=null&&S.includeCmmc?(I=r.value)==null?void 0:I.includeCmmc:!0,template:(k=r.value)==null?void 0:k.template,supplierInfos:(q=r.value)==null?void 0:q.supplierInfos},o=await R.mutateAsync(i);o&&M(o.id)}const j=N();async function M(i){await Q(i),a.value=!1,j.push(`/admin/companies/${e.value}/scorecards/batch/rating-service-1/${i}`)}async function Q(i){let o=!0;do(await z.get(`${Y}/companies/${e.value}/scorecards/docx/${i}/status`)).data.length===0?o=!1:await new Promise(_=>setTimeout(_,2e3));while(o)}return{id:e,queries:l,users:c,batch:r,isValidForm:P,create:T}};h.components=Object.assign({BackButton:G,BatchScorecardInput:ut,FormButton:V},h.components);var ct=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[e("div",[e("BackButton",{attrs:{link:`/admin/companies/${t.id}/scorecards/batch/rating-service-1/`}})],1),e("BaseTypography",{attrs:{variant:"h5",component:"h2"}},[t._v(" Create New Batch ")])],1),e("BaseSimpleCard",[e("form",{staticClass:"divide-y",on:{submit:function(a){return a.preventDefault(),t.create.apply(null,arguments)}}},[e("BaseVueQueries",{attrs:{queries:t.queries},scopedSlots:t._u([{key:"success",fn:function(a){var l=a[0],v=a[1];return[e("BatchScorecardInput",{attrs:{id:t.id,users:t.users.data.value||[],companies:l,"bitsight-companies":v},model:{value:t.batch,callback:function(d){t.batch=d},expression:"batch"}})]}}])}),e("FormButton",{attrs:{action:"create","is-valid-form":t.isValidForm}})],1)])],1)},pt=[];const O={};var mt=x(h,ct,pt,!1,yt,null,null,null);function yt(t){for(let s in O)this[s]=O[s]}const wt=function(){return mt.exports}();export{wt as default};
