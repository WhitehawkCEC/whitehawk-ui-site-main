import{ap as x,bH as O,d as b,ab as E,aU as D,bu as j,a$ as p,n as $,bv as G,bI as H,bk as N,bJ as P}from"./index.fed79599.js";import{S as z}from"./StatisticDisplayCard.6f2255ed.js";import{C as W}from"./CognitoUserStatusDisplay.59a69b80.js";import{A as J}from"./AppTanStackTable.679440fb.js";import{u as Q,c as K,i as g,r as X,h as Y,g as Z,a as ee,f as te,e as ae,d as se,b as ne}from"./createOnChangeFn.819e788b.js";import{a as re}from"./attributeListToMap.bea9f70d.js";import{a as oe}from"./index.57d6fd2f.js";import{t as y}from"./index.4251469c.js";import{m as V}from"./multiSet.dcd15b85.js";import{u as ie}from"./useAllCompanyAccess.269f6368.js";import{u as le}from"./useUsers.33d29328.js";import"./magnifying-glass.b7cbe8fe.js";import"./TransitionExpand.d6b3e9de.js";import"./chevron-up.736f4142.js";function U(e,n){x(2,arguments);var a=y(e),l=y(n);return a.getTime()>l.getTime()}function B(e,n){x(2,arguments);var a=y(e),l=y(n);return a.getTime()<l.getTime()}function v(e,n){x(2,arguments);var a=O(n);return oe(e,-a)}const _=new Date,ce=[{text:"Within Last 30 Days",isValid(e){const n=v(_,30);return U(e,n)}},{text:"Within Last 60 Days",isValid(e){const n=v(_,60),a=v(_,30);return U(e,n)&&B(e,a)}},{text:"Longer than 90 Days",isValid(e){const n=v(_,90);return B(e,n)}}],d={};d.props={companies:{key:"companies",required:!0,type:Array},users:{key:"users",required:!0,type:Array},access:{key:"access",required:!0,type:Array}};d.setup=(e,n)=>{const a=e,l=b(()=>{const t=Array();return a.users.map(({UserStatus:s,Attributes:o})=>{const r=re(o||[]);t.push({userStatus:s||"",attributes:r})}),t.sort((s,o)=>{var r,i,m,f;return((i=(r=s.attributes)==null?void 0:r.email)!=null?i:"").localeCompare((f=(m=o.attributes)==null?void 0:m.email)!=null?f:"")})}),u=b(()=>{const t=new Map;for(const{company:s,user:o}of a.access){const r=o.id,i=t.get(r);i?i.push(s):t.set(r,[s])}for(const s of t.values())s.sort((o,r)=>o.name.localeCompare(r.name));return t}),h=b(()=>l.value.map(({userStatus:t,attributes:s})=>{var k;const o=s.sub||"",r=s.name||"",i=s.email||"",m=s["dev:custom:last_login"]||"",f=((k=u.value.get(o))==null?void 0:k.map(({name:w})=>w))||[],S=ce.find(w=>w.isValid(E(m)));return{id:o,name:r,status:t||"",email:i,lastLogin:m,companies:f,dateGroup:S==null?void 0:S.text}}).sort((t,s)=>t.name.localeCompare(s.name))),c=K(),I=[c.accessor("name",{header:()=>"Name",cell:t=>t.getValue()}),c.accessor("status",{header:()=>"Status",cell:t=>D(W,{props:{value:t.getValue()}})}),c.accessor("email",{header:()=>"Email",cell:t=>t.getValue()}),c.accessor("lastLogin",{header:()=>"Last Login",cell:t=>D(j,{props:{value:t.getValue()}}),filterFn(t,s,o){return t.original.dateGroup===o}}),c.accessor("companies",{header:()=>"Companies",cell:t=>t.getValue().join(", "),filterFn:"arrIncludes"})],F=p([]),R=p({pageIndex:0,pageSize:10}),T=p(""),M=p([]),A=p({});return{instance:Q({get data(){return h.value},columns:I,state:{get sorting(){return F.value},get pagination(){return R.value},get globalFilter(){return T.value},get columnFilters(){return M.value},get rowSelection(){return A.value}},onSortingChange:g(F),onPaginationChange:g(R),onColumnFiltersChange:g(M),onGlobalFilterChange:g(T),globalFilterFn:(t,s,o,r)=>{const i=X(t.getValue(s),o,{threshold:Y.CONTAINS});return r(i),i.passed},onRowSelectionChange:g(A),getCoreRowModel:Z(),getFacetedRowModel:ee(),getSortedRowModel:te(),getFacetedUniqueValues(t,s){const o=ne();return s==="lastLogin"?()=>{const r=t.getColumn(s).getFacetedRowModel();return V(r.flatRows.flatMap(i=>i.original.dateGroup?[i.original.dateGroup]:[]))}:s==="companies"?()=>{const r=t.getColumn(s).getFacetedRowModel();return V(r.flatRows.flatMap(i=>i.original.companies?i.original.companies:[]))}:o(t,s)},getPaginationRowModel:ae(),getFilteredRowModel:se()})}};d.components=Object.assign({AppTanStackTable:J},d.components);var ue=function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("AppTanStackTable",{attrs:{table:e.instance}})},me=[];const L={};var pe=$(d,ue,me,!1,ge,null,null,null);function ge(e){for(let n in L)this[n]=L[n]}const de=function(){return pe.exports}(),C={};C.setup=(e,n)=>{const a={title:"Total Companies",component:N},l={title:"Total Users",component:P},u=[le.list(),ie.list(),H.list()];return{companySummary:a,usersSummary:l,queries:u}};C.components=Object.assign({BackButton:G,StatisticDisplayCard:z,AdminCannedUsersTable:de},C.components);var fe=function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("section",{staticClass:"space-y-8"},[a("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-x-4 sm:space-y-0"},[a("BackButton",{attrs:{link:"/admin/reports"}}),a("div",{staticClass:"flex flex-col"},[a("BaseTypography",{attrs:{component:"h2",variant:"h5"}},[e._v("Users")]),a("BaseTypography",{staticClass:"uppercase text-gray-600",attrs:{variant:"overline"}},[e._v(" Canned Report ")])],1)],1),a("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(l){var u=l[0],h=l[1],c=l[2];return[a("div",{staticClass:"space-y-6"},[a("div",{staticClass:"grid gap-6 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4"},[a("StatisticDisplayCard",{attrs:{value:e.companySummary,number:c.length}}),a("StatisticDisplayCard",{attrs:{value:e.usersSummary,number:u.length}})],1),a("AdminCannedUsersTable",{attrs:{users:u,access:h,companies:c}})],1)]}}])})],1)},ve=[];const q={};var _e=$(C,fe,ve,!1,ye,null,null,null);function ye(e){for(let n in q)this[n]=q[n]}const Be=function(){return _e.exports}();export{Be as default};
