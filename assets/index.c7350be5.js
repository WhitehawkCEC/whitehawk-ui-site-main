import{F as C}from"./FormButton.2d693bfa.js";import{D as h}from"./DynamicForm.77906914.js";import{aA as b,c as m,b0 as d,n as x,c7 as q,bG as $,cM as D,r as F,aJ as R}from"./index.52b75f7e.js";import{l as k}from"./lodash.44dc6521.js";import{u as B}from"./useCompanyAccess.07bf49c0.js";import{u as S}from"./useUsers.74e69c55.js";import{e as E}from"./attributeValue.ea53a720.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";const i={};i.props={value:{key:"value",required:!1,type:null},companies:{key:"companies",required:!0,type:Array},companyAccess:{key:"companyAccess",required:!0,type:Array}};i.setup=(e,t)=>{const s=e,n=t.emit,c=b(s,n),u=[{text:"Read",value:"READ"},{text:"Write",value:"WRITE"},{text:"Admin",value:"ADMIN"}],a=m(()=>s.companyAccess.map(r=>r.company)),l=m(()=>s.companies.map(({id:r,name:o})=>({id:r,name:o}))),v=m(()=>k.exports.differenceBy(l.value,a.value,o=>o.id).map(o=>({text:o.name,value:o}))),y=[{name:"company",label:"Company",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...v.value]}}},{name:"permission",label:"Permission",component:{is:d,attrs:{required:!0,options:[{text:"",value:void 0},...u]}}}];return{proxy:c,schema:y}};i.components=Object.assign({DynamicForm:h},i.components);var I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DynamicForm",{attrs:{schema:e.schema},model:{value:e.proxy,callback:function(n){e.proxy=n},expression:"proxy"}})},g=[];const _={};var j=x(i,I,g,!1,M,null,null,null);function M(e){for(let t in _)this[t]=_[t]}const w=function(){return j.exports}(),p={};p.setup=(e,t)=>{const s=q("username"),n=[$.list(),D.list(s)],c=S.read(s),u=m(()=>c.data.value?{id:s.value,email:E(c.data.value,"email")}:void 0),a=F({company:void 0,user:u.value,permission:void 0}),l=R(),v=B.create();async function y(){var r,o;if(a.value&&a.value.company&&a.value.user&&a.value.permission){const A={company:a.value.company,user:a.value.user,permission:a.value.permission};await v.mutateAsync({id:(o=(r=a.value)==null?void 0:r.company)==null?void 0:o.id,body:A}),l.push(`/admin/users/${s.value}/companies`)}else throw new Error("Invalid request.")}return{queries:n,access:a,addCompany:y}};p.components=Object.assign({CompanyAccessInput:w,FormButton:C},p.components);var O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseSimpleCard",{staticClass:"divide-y"},[s("BaseTypography",{staticClass:"p-4",attrs:{component:"h2",variant:"subtitle3"}},[e._v(" Add Company ")]),s("form",{staticClass:"divide-y",on:{submit:function(n){return n.preventDefault(),e.addCompany.apply(null,arguments)}}},[s("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(n){var c=n[0],u=n[1];return[s("CompanyAccessInput",{attrs:{companies:c,"company-access":u},model:{value:e.access,callback:function(a){e.access=a},expression:"access"}})]}}])}),s("FormButton",{attrs:{action:"create"}})],1)],1)},P=[];const f={};var Q=x(p,O,P,!1,T,null,null,null);function T(e){for(let t in f)this[t]=f[t]}const L=function(){return Q.exports}();export{L as default};
