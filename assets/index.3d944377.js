import{F as se}from"./FormButton.017f7d0b.js";import{aB as A,n as _,d as u,df as p,b1 as w,ah as ae,aP as re,aQ as ne,dg as oe,ax as X,cp as le,dh as Q,L as ce,bs as ue,c7 as L,di as ie,c4 as pe,aF as de,aK as me,dj as ve}from"./index.805d8f35.js";import{S as ye}from"./arrow-path.5187a52b.js";import{T as Z}from"./ToolTip.925f2c17.js";import{O as ee}from"./ObjectDisplay.aeb51f3c.js";import{e as v}from"./attributeValue.ea53a720.js";import{D as fe}from"./DynamicForm.b38fb518.js";import{t as _e,a as xe,b as Se,c as ge}from"./index.c4cf9c2c.js";import{u as be}from"./useCompanyScorecardTemplates.22fc0214.js";import{u as he}from"./useScorecardTemplates.29f8ab9d.js";import{u as $e}from"./useBlackKiteEntities.25c43e9d.js";import{u as ke}from"./useUsers.924068fe.js";import{s as Ce}from"./index.2b4e61d0.js";import"./arrow-down-on-square.bf61cdc5.js";import"./trash.78f57a7a.js";const $={};$.props={value:{key:"value",required:!1,type:null},options:{key:"options",required:!0,type:Array}};$.setup=(e,a)=>{const t=e,s=a.emit;return{proxy:A(t,s)}};$.components=Object.assign({ToolTip:Z,ObjectDisplay:ee},$.components);var Ie=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center"},[t("div",{staticClass:"flex flex-row items-center space-x-1 after:content-['*'] after:ml-0.5 after:text-red-700"},[t("span",[e._v("Supplier")]),e.value?t("ToolTip",[t("ObjectDisplay",{attrs:{value:e.value}})],1):e._e()],1),t("div",{staticClass:"flex flex-col lg:col-span-2"},[t("BaseSelect",{model:{value:e.proxy,callback:function(s){e.proxy=s},expression:"proxy"}},e._l(e.options,function(s){return t("option",{key:s.id,domProps:{value:s}},[e._v(" "+e._s(s.name)+" ")])}),0)],1)])},Ee=[];const M={};var De=_($,Ie,Ee,!1,Ae,null,null,null);function Ae(e){for(let a in M)this[a]=M[a]}const Be=function(){return De.exports}(),k={};k.props={value:{key:"value",required:!1,type:null},entities:{key:"entities",required:!0,type:Array}};k.setup=(e,a)=>{const t=e,s=a.emit,r=A(t,s),o=u(()=>t.entities.map(n=>({id:n.CompanyId,name:n.CompanyName})).sort((n,d)=>n.name.localeCompare(d.name))||[]);return{proxy:r,options:o}};k.components=Object.assign({SupplierEntryInput:Be},k.components);var qe=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("SupplierEntryInput",{attrs:{options:e.options},model:{value:e.proxy,callback:function(s){e.proxy=s},expression:"proxy"}})},Oe=[];const J={};var Re=_(k,qe,Oe,!1,je,null,null,null);function je(e){for(let a in J)this[a]=J[a]}const Te=function(){return Re.exports}(),C={};C.props={value:{key:"value",required:!1,type:null},users:{key:"users",required:!0,type:Array}};C.setup=(e,a)=>{const t=e,s=a.emit,r=A(t,s),o=u(()=>t.users.map(n=>({id:{value:v(n,"sub")},name:v(n,"name")||"",title:v(n,"custom:title")||"",email:v(n,"email"),phone:v(n,"phone_number")||""})).sort((n,d)=>n.email.localeCompare(d.email)));return{proxy:r,options:o}};C.components=Object.assign({ToolTip:Z,ObjectDisplay:ee},C.components);var we=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center"},[t("div",{staticClass:"flex flex-row items-center space-x-1 after:content-['*'] after:ml-0.5 after:text-red-700"},[t("span",[e._v("Analyst")]),e.value?t("ToolTip",[t("ObjectDisplay",{attrs:{value:e.value}})],1):e._e()],1),t("BaseSelect",{staticClass:"lg:col-span-2",attrs:{required:""},model:{value:e.proxy,callback:function(s){e.proxy=s},expression:"proxy"}},e._l(e.options,function(s,r){return t("option",{key:r,domProps:{value:s}},[e._v(" "+e._s(s.email)+" ")])}),0)],1)},Qe=[];const G={};var Fe=_(C,we,Qe,!1,Ne,null,null,null);function Ne(e){for(let a in G)this[a]=G[a]}const Pe=function(){return Fe.exports}(),I={};I.props={value:{key:"value",required:!1,type:null}};I.setup=(e,a)=>{const t=e,s=a.emit,r=A(t,s),o=u(()=>new Date().getFullYear()),n=u(()=>new Array(10).fill(o.value).map((h,l)=>({value:o.value-5+l}))),d=u(()=>[{text:"In Progress",value:p.State.IN_PROGRESS},{text:"Products Needed",value:p.State.PRODUCTS_NEEDED},{text:"Ready for QA",value:p.State.READY_FOR_QA},{text:"Delivered",value:p.State.DELIVERED},{text:"Complete",value:p.State.COMPLETE}]),x=u(()=>[{text:"Q1",value:p.Quarter.Q1},{text:"Q2",value:p.Quarter.Q2},{text:"Q3",value:p.Quarter.Q3},{text:"Q4",value:p.Quarter.Q4},{text:"Other",value:p.Quarter.OTHER}]),S=[{name:"state",label:"State",component:{is:w,attrs:{required:!0,options:d.value}}},{name:"year",label:"Year",component:{is:w,attrs:{required:!0,options:n.value}}},{name:"quarter",label:"Quarter",component:{is:w,attrs:{required:!0,options:x.value}}}];return{proxy:r,schema:S}};I.components=Object.assign({DynamicForm:fe},I.components);var Ue=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("DynamicForm",{attrs:{schema:e.schema},model:{value:e.proxy,callback:function(s){e.proxy=s},expression:"proxy"}})},Ve=[];const K={};var Le=_(I,Ue,Ve,!1,Me,null,null,null);function Me(e){for(let a in K)this[a]=K[a]}const Je=function(){return Le.exports}(),Ge={get(){return ae(["random-bundle-solution"],()=>re.get(`${ne}/random-bundle-solution`).then(e=>e.data))}};function F(e){return e===void 0?oe.BundleSolutionEntry.create():{title:e.title,description:e.description,groups:Ke(e.groups)}}function Ke(e){return e.map(({category:a,main:t,option:s})=>({category:{id:{value:a.id},name:a.name},main:{id:{value:(t==null?void 0:t.id)||""},name:(t==null?void 0:t.name)||"",description:t==null?void 0:t.description,manufacturer:{id:{value:(t==null?void 0:t.manufacturer.id)||""},name:(t==null?void 0:t.manufacturer.name)||""},categories:Ye(t==null?void 0:t.categories)},option:{id:{value:(s==null?void 0:s.id)||""},name:(s==null?void 0:s.name)||"",description:s==null?void 0:s.description,manufacturer:{id:{value:(s==null?void 0:s.manufacturer.id)||""},name:(s==null?void 0:s.manufacturer.name)||""},categories:[]}}))}function Ye(e){if(e===void 0)throw new Error("Product Category is undefined");return e.map(({id:a,name:t})=>({id:{value:a},name:t}))}function ze(e){const a=[];for(const t of Object.values(e))a.push({domain:_e(t.displayValue),domainDisplayValue:t.displayValue,levels:He(t.levels)});return a}function He(e){const a=[];for(const[t,s]of Object.entries(e))a.push({level:xe(t),averageStarLevel:s.averageStarLevel});return a}const E={};E.props={id:{key:"id",required:!0,type:String},value:{key:"value",required:!1,type:null},users:{key:"users",required:!0,type:Array},entities:{key:"entities",required:!0,type:Array},products:{key:"products",required:!0,type:Array}};E.setup=(e,a)=>{const t=e,s=a.emit,r=X(t,s),o=u(()=>{var m,y;const l=[];return(m=r.value.supplier)!=null&&m.id||l.push("Select a supplier"),((y=r.value.status)==null?void 0:y.state)===p.State.DELIVERED&&l.push('The status of this scorecard has already been marked as "Delivered."'),{allowed:l.length===0,reasons:l}}),n=u(()=>t.id),d=u({get(){var l,m;return(m=(l=t.value)==null?void 0:l.supplier)==null?void 0:m.id},set(l){l&&r.value.supplier&&(r.value.supplier.id=l)}}),x=le.get(n,d),S=Ge.get();async function h(){if(x.data.value&&S.data.value){const{cmmcAnalysis:l,focusAreaOrder:m,ratingScoreDetails:y,reports:g,riskVectors:q}=x.data.value,{BASIC:O,BALANCED:R,ADVANCED:j}=S.data.value,[i,c,T]=m,f=[];for(const b of m)f.push(Se(b));const te=["NIST 800-53 R5","CIS CSC-20","CMMC 2.0","NIST 800-171"],P={};for(const b of g.compliance){const{StandardCode:V}=b;te.includes(V)&&(P[V]={report:b})}const U=[];for(const b of Object.values(q))U.push(b);r.value.cmmcAnalysis={entries:ze(l)},r.value.reports={summary:{json:JSON.parse(JSON.stringify(g.summary))},risk:{json:JSON.parse(JSON.stringify(g.risk))},compliance:{json:JSON.parse(JSON.stringify(g.compliance))}},r.value.ratingScore={description:y.description||""},r.value.riskVectors={values:U},r.value.focusAreaOrder={values:f},r.value.focusAreas={first:f[0]||Q.RiskVector.UNSPECIFIED,second:f[1]||Q.RiskVector.UNSPECIFIED,third:f[2]||Q.RiskVector.UNSPECIFIED},r.value.compliance=P,r.value.bundle={essential:F(O[i||""]),balanced:F(R[c||""]),premier:F(j[T||""])},await s("update-data")}}return{proxy:r,canUpdateData:o,updateData:h}};E.components=Object.assign({AnalystInput:Pe,SupplierInput:Te,RefreshSvg:ye,StatusInput:Je},E.components);var We=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("section",{staticClass:"flex flex-col divide-y"},[t("BaseTypography",{staticClass:"px-4 py-2",attrs:{component:"h3",variant:"subtitle2"}},[e._v(" Analyst Information ")]),t("AnalystInput",{attrs:{users:e.users},model:{value:e.proxy.analyst,callback:function(s){e.$set(e.proxy,"analyst",s)},expression:"proxy.analyst"}}),t("BaseTypography",{staticClass:"px-4 py-2",attrs:{component:"h3",variant:"subtitle2"}},[e._v(" Supplier Information ")]),t("SupplierInput",{attrs:{entities:e.entities},model:{value:e.proxy.supplier,callback:function(s){e.$set(e.proxy,"supplier",s)},expression:"proxy.supplier"}}),t("BaseTypography",{staticClass:"px-4 py-2",attrs:{component:"h3",variant:"subtitle2"}},[e._v(" Update Data ")]),e.canUpdateData.allowed?t("div",{staticClass:"p-4"},[t("BaseButton",{staticClass:"w-full space-x-2 lg:w-auto",attrs:{type:"button",disabled:!e.canUpdateData.allowed},on:{click:e.updateData}},[t("RefreshSvg",{staticClass:"-ml-1 w-4 xl:w-5"}),t("span",[e._v("Update")])],1)],1):t("div",[t("BaseAlert",{staticClass:"shadow-none rounded-none",attrs:{type:"warn"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Update Unavailable")]},proxy:!0},{key:"message",fn:function(){return[t("ul",{staticClass:"flex list-inside list-disc flex-col space-y-1"},e._l(e.canUpdateData.reasons,function(s){return t("li",{key:s},[e._v(" "+e._s(s)+" ")])}),0)]},proxy:!0}],null,!1,4159848379)})],1),t("pre",[e._v(e._s(e.proxy))]),t("StatusInput",{model:{value:e.proxy.status,callback:function(s){e.$set(e.proxy,"status",s)},expression:"proxy.status"}})],1)},Xe=[];const Y={};var Ze=_(E,We,Xe,!1,et,null,null,null);function et(e){for(let a in Y)this[a]=Y[a]}const tt=function(){return Ze.exports}(),N={};N.props={value:{key:"value",required:!1,type:null,default:void 0},templates:{key:"templates",required:!0,type:Array}};N.setup=(e,a)=>{const t=e,s=a.emit,r=A(t,s),o=u(()=>t.templates.map(({key:n})=>({value:n.split("/")[1]||""})));return{proxy:r,options:o}};var st=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("BaseLabel",{staticClass:"flex flex-col p-4 lg:grid lg:grid-cols-3 lg:items-center"},[t("span",{staticClass:"after:content-['*'] after:ml-0.5 after:text-red-700"},[e._v(" Template ")]),t("BaseSelect",{staticClass:"flex flex-col lg:col-span-2",model:{value:e.proxy,callback:function(s){e.proxy=s},expression:"proxy"}},e._l(e.options,function(s,r){return t("option",{key:r,domProps:{value:s}},[e._v(" "+e._s(s.value)+" ")])}),0)],1)},at=[];const z={};var rt=_(N,st,at,!1,nt,null,null,null);function nt(e){for(let a in z)this[a]=z[a]}const ot=function(){return rt.exports}(),D={};D.props={id:{key:"id",required:!0,type:String},subId:{key:"subId",required:!0,type:String},value:{key:"value",required:!1,type:null},users:{key:"users",required:!0,type:Array},entities:{key:"entities",required:!0,type:Array},products:{key:"products",required:!0,type:Array},templates:{key:"templates",required:!0,type:Array}};D.setup=(e,a)=>{const t=e,s=a.emit;return{proxy:X(t,s)}};D.components=Object.assign({TemplateInput:ot,DataInput:tt},D.components);var lt=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"flex flex-col divide-y"},[t("BaseTypography",{staticClass:"px-4 py-2",attrs:{component:"h3",variant:"subtitle2"}},[e._v(" Scorecard Template ")]),t("TemplateInput",{attrs:{templates:e.templates},model:{value:e.proxy.template,callback:function(s){e.$set(e.proxy,"template",s)},expression:"proxy.template"}}),t("DataInput",{attrs:{id:e.id,"sub-id":e.subId,users:e.users,entities:e.entities,products:e.products},model:{value:e.proxy.data,callback:function(s){e.$set(e.proxy,"data",s)},expression:"proxy.data"}})],1)},ct=[];const H={};var ut=_(D,lt,ct,!1,it,null,null,null);function it(e){for(let a in H)this[a]=H[a]}const pt=function(){return ut.exports}(),B={};B.setup=(e,a)=>{const t=L("id"),s=L("subscriptionId"),r=[ie.list(),he.list(),$e.list(t)],o=ke.list(),n=pe.read(t),d=be.get(t),x=u(()=>{if(n.data.value){const{id:i,name:c}=n.data.value;return{company:i,name:c}}}),S=u(()=>{var i;return(i=o.data.value)==null?void 0:i.map(c=>({id:{value:v(c,"sub")},name:v(c,"name")||"",title:v(c,"custom:title")||"",email:v(c,"email"),phone:v(c,"phone_number")||""})).find(c=>c.email==="consultingservices@whitehawk.com")}),h=new Date,l=h.getUTCFullYear(),m=`Q${Math.ceil((h.getMonth()+1)/4)}`,y=Ce(u(()=>{var i;return{template:{value:((i=d.data.value)==null?void 0:i.split("/")[1])||""},data:{buyer:{company:x.value},analyst:S.value,status:{state:p.State.IN_PROGRESS,year:l,quarter:ge(m)}}}})),g=u(()=>Boolean(o.data.value&&n.data.value)),q=de(),O=me(),R=ve.create(t,s);async function j(){var i,c;if(y.value){const T={scorecardInput:{oneofKind:"bk",bk:y.value}},{response:f}=await R.mutateAsync(T);f.scorecardId&&(q.success("Successfully created scorecard."),O.push(`/admin/companies/${t.value}/subscriptions/${s.value}/integrations/2/entities/${(c=(i=y.value.data)==null?void 0:i.supplier)==null?void 0:c.id}/scorecards/in-depth/${f.scorecardId}`))}}return{accountId:t,subscriptionId:s,queries:r,users:o,scorecard:y,ready:g,createScorecard:j}};B.components=Object.assign({LoadingSpinner:ce,BackButton:ue,ScorecardInput:pt,FormButton:se},B.components);var dt=function(){var e=this,a=e.$createElement,t=e._self._c||a;return e.ready?t("section",{staticClass:"space-y-6"},[t("div",{staticClass:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4"},[t("BackButton"),t("BaseTypography",{attrs:{variant:"h5",component:"h2"}},[e._v(" Create Scorecard ")])],1),t("BaseSimpleCard",[t("form",{staticClass:"divide-y",on:{submit:function(s){return s.preventDefault(),e.createScorecard.apply(null,arguments)}}},[t("BaseVueQueries",{attrs:{queries:e.queries},scopedSlots:e._u([{key:"success",fn:function(s){var r=s[0],o=s[1],n=s[2];return[t("ScorecardInput",{attrs:{id:e.accountId,"sub-id":e.subscriptionId,users:e.users.data.value||[],entities:n,products:r,templates:o},model:{value:e.scorecard,callback:function(d){e.scorecard=d},expression:"scorecard"}})]}}])}),t("FormButton",{attrs:{action:"create","is-valid-form":!1}})],1)])],1):t("LoadingSpinner")},mt=[];const W={};var vt=_(B,dt,mt,!1,yt,null,null,null);function yt(e){for(let a in W)this[a]=W[a]}const qt=function(){return vt.exports}();export{qt as default};
